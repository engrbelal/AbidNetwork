<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Processing Login...</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <style>
        body { font-family: sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; background-color: #f0f2f5; text-align: center; }
        .container { padding: 20px; }
        h1 { color: #333; }
        p { color: #666; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>লগইন প্রক্রিয়া চলছে...</h1>
        <p>অনুগ্রহ করে অপেক্ষা করুন। আপনাকে স্বয়ংক্রিয়ভাবে অ্যাপে ফিরিয়ে নেওয়া হবে।</p>
        <div class="loader"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCloFLoT6-EGCqvuHXdehVmsQowzlCl6w4",
            authDomain: "dutymanagerapp.firebaseapp.com",
            projectId: "dutymanagerapp",
            storageBucket: "dutymanagerapp.appspot.com",
            messagingSenderId: "700577418205",
            appId: "1:700577418205:web:1d9713f6f05944eb56c434"
        };

        try {
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const provider = new firebase.auth.GoogleAuthProvider();

            auth.signInWithPopup(provider)
                .then((result) => {
                    // সফলভাবে লগইন হলে, ID Token সংগ্রহ করা
                    return result.user.getIdToken();
                })
                .then((idToken) => {
                    // ID Token দিয়ে অ্যাপের কাস্টম URL-এ রিডাইরেক্ট করা
                    const customUrl = `com.belal.dutymanager://login-success?token=${idToken}`;
                    window.location.href = customUrl;
                })
                .catch((error) => {
                    // কোনো সমস্যা হলে, অ্যাপে এরর বার্তা পাঠানো
                    const customUrl = `com.belal.dutymanager://login-failed?error=${encodeURIComponent(error.message)}`;
                    window.location.href = customUrl;
                });
        } catch (e) {
            const customUrl = `com.belal.dutymanager://login-failed?error=${encodeURIComponent(e.message)}`;
            window.location.href = customUrl;
        }
    </script>
</body>
</html>
