<!DOCTYPE html>
<html lang="bn">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Abid Network</title>
<!-- Favicon using logo.png -->
<link rel="icon" href="/AbidNetwork/logo.png" type="image/png">
<link rel="apple-touch-icon" href="/AbidNetwork/logo.png">
  <style>
    :root {
      --primary-color: #4A5568;
      --secondary-color: #5A67D8;
      --accent-color: #805AD5;
      --background-color: #F7FAFC;
      --text-color: #2D3748;
      --header-gradient-start: #5A67D8;
      --header-gradient-end: #805AD5;
      --menu-bg: #2D3748;
      --menu-text-color: #E2E8F0;
      --menu-active-bg: #5A67D8;
      --card-bg: #FFFFFF;
      --button-bg: #5A67D8;
      --button-hover-bg: #434190;
      --delete-btn-bg: #E53E3E;
      --reset-btn-bg: #c53030;
      --shadow-color: rgba(0, 0, 0, 0.07);
      --paid-color: #38A169;
      --unpaid-color: #DD6B20;
      --advance-color: #3182CE;
      --free-color: #319795;
      --pending-color: #9F7AEA;
      --border-color: #E2E8F0;
    }

    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;600&display=swap');

    body {
      font-family: 'Noto Sans Bengali', sans-serif;
      font-size: 14px;
      margin: 0;
      background-color: var(--background-color);
      color: var(--text-color);
      display: flex;
    }

    .sidebar {
      width: 220px;
      background-color: var(--menu-bg);
      color: var(--menu-text-color);
      position: fixed;
      height: 100%;
      left: -220px;
      transition: left 0.3s ease-in-out;
      z-index: 1002;
      display: flex;
      flex-direction: column;
      box-shadow: 2px 0 5px var(--shadow-color);
    }

    .sidebar.active {
      left: 0;
    }

    .sidebar-header {
      padding: 12px 18px;
      text-align: center;
      background: linear-gradient(90deg, #1a202c, #2d3748);
      display: flex;
      align-items: center;
      gap: 10px;
      height: 40px;
    }

    .sidebar-title {
      color: white;
      font-weight: 500;
      font-size: 18px;
      margin: 0;
    }

    .sidebar-logo {
      color: #90cdf4;
    }

    .sidebar-menu {
      list-style: none;
      padding: 0;
      margin: 18px 0;
      flex-grow: 1;
    }

    .sidebar-menu li a {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 18px;
      color: var(--menu-text-color);
      text-decoration: none;
      transition: all 0.2s;
      border-left: 4px solid transparent;
      font-size: 14px;
    }

    .sidebar-menu li a:hover {
      background-color: var(--primary-color);
      padding-left: 22px;
    }

    .sidebar-menu li a.active {
      background-color: var(--menu-active-bg);
      border-left: 4px solid white;
      font-weight: 600;
    }

    .main-content {
      margin-left: 0;
      width: 100%;
      transition: margin-left 0.3s ease-in-out;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .page-container {
      flex-grow: 1;
    }

    .page {
      display: none;
      padding: 12px;
    }

    .page.active {
      display: block;
    }

    .header {
      background: linear-gradient(90deg, var(--header-gradient-start), var(--header-gradient-end));
      padding: 8px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 999;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .menu-toggle {
      font-size: 22px;
      cursor: pointer;
      background: none;
      border: none;
      color: white;
    }

    .header-title {
      font-size: 20px;
      font-weight: 600;
      color: white;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .header-logo {
      font-size: 24px;
    }

    #page-title {
      font-size: 15px;
      color: white;
      font-weight: 500;
      text-align: right;
    }

    .card {
      background-color: var(--card-bg);
      border-radius: 8px;
      padding: 18px;
      margin-bottom: 18px;
      box-shadow: 0 4px 12px var(--shadow-color);
    }

    .card h2 {
      margin-top: 0;
      border-bottom: 2px solid var(--secondary-color);
      padding-bottom: 8px;
      color: var(--primary-color);
      font-size: 17px;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .unpaid-count {
      font-size: 12px;
      color: var(--unpaid-color);
      font-weight: 500;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px 18px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group.hidden {
      display: none;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      font-size: 13px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 8px;
      border: 1px solid #CBD5E0;
      border-radius: 5px;
      box-sizing: border-box;
      font-size: 13px;
    }

    .form-group-checkbox {
      flex-direction: row;
      align-items: center;
    }

    .form-group-checkbox input {
      width: auto;
      margin-right: 8px;
      transform: scale(1.0);
    }

    .btn {
      padding: 8px 18px;
      border: none;
      border-radius: 5px;
      color: white;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .btn-submit {
      background-color: var(--button-bg);
    }

    .btn-delete {
      background-color: var(--delete-btn-bg);
      padding: 5px 10px;
    }

    .table-container {
      overflow-x: auto;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      font-size: 13px;
    }

    .data-table th,
    .data-table td {
      border: 1px solid #E2E8F0;
      padding: 7px 9px;
      text-align: left;
      white-space: nowrap;
    }

    .data-table th {
      background-color: var(--primary-color);
      color: white;
      font-weight: 600;
    }

    .data-table tr:nth-child(even) {
      background-color: #F7FAFC;
    }

    .data-table .customer-name-link {
      cursor: pointer;
      color: var(--secondary-color);
      font-weight: 600;
      text-decoration: underline;
    }

    .status-paid {
      color: var(--paid-color);
      font-weight: 600;
    }

    .status-unpaid {
      color: var(--unpaid-color);
      font-weight: 600;
    }

    .status-advance {
      color: var(--advance-color);
      font-weight: 600;
    }

    .status-free {
      color: var(--free-color);
      font-weight: 600;
    }

    .status-pending {
      color: var(--pending-color);
      font-weight: 600;
    }

    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1001;
      display: none;
    }

    .action-btn {
      padding: 4px 8px !important;
      font-size: 12px !important;
      margin-right: 4px;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
    }

    .summary-item {
      background-color: #EDF2F7;
      padding: 12px;
      border-radius: 8px;
      border-left: 4px solid var(--secondary-color);
    }

    .summary-item h3 {
      margin: 0 0 6px 0;
      font-size: 13px;
      color: var(--primary-color);
    }

    .summary-item p {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }

    .total-customer-summary {
      background: linear-gradient(90deg, #805AD5, #5A67D8);
      color: white;
      text-align: center;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 18px;
    }

    /* About Page Styles */
    .about-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .about-info-card {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px var(--shadow-color);
      border-left: 4px solid var(--secondary-color);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .about-info-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    }

    .info-item {
      margin-bottom: 10px;
      padding: 8px 0;
      border-bottom: 1px solid #f0f0f0;
    }

    .info-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }

    .info-item strong {
      color: var(--primary-color);
      display: inline-block;
      min-width: 120px;
    }

    .user-guide-section {
      margin-bottom: 15px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
      transition: box-shadow 0.2s ease;
    }

    .user-guide-section:hover {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .guide-header {
      background: var(--primary-color);
      color: white;
      padding: 15px 20px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background-color 0.3s ease;
      user-select: none;
    }

    .guide-header:hover {
      background: var(--secondary-color);
    }

    .guide-header:active {
      background: var(--accent-color);
    }

    .guide-content {
      padding: 0 20px;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease, padding 0.4s ease;
      background: var(--card-bg);
    }

    .guide-content.expanded {
      max-height: none;
      padding: 20px;
    }

    .guide-content h4 {
      color: var(--secondary-color);
      margin: 15px 0 8px 0;
      font-size: 16px;
      font-weight: 600;
    }

    .guide-content h4:first-child {
      margin-top: 0;
    }

    .guide-content p {
      margin: 8px 0;
      line-height: 1.6;
      color: var(--text-color);
    }

    .guide-content ul,
    .guide-content ol {
      margin: 10px 0;
      padding-left: 20px;
    }

    .guide-content li {
      margin: 6px 0;
      line-height: 1.5;
      color: var(--text-color);
    }

    .guide-content li strong {
      color: var(--primary-color);
    }

    .expand-icon {
      transition: transform 0.3s ease;
      font-size: 14px;
      font-weight: bold;
    }

    .expanded .expand-icon {
      transform: rotate(180deg);
    }

    #user-guide-btn {
      transition: all 0.3s ease;
    }

    #user-guide-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(90, 103, 216, 0.3);
    }

    /* Mobile Responsive for About Page */
    @media (max-width: 768px) {
      .about-info-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .about-info-card {
        padding: 15px;
      }

      .guide-header {
        padding: 12px 15px;
        font-size: 14px;
      }

      .guide-content.expanded {
        padding: 15px;
        max-height: none;
      }

      .info-item strong {
        min-width: 100px;
        font-size: 13px;
      }
    }

    @media (max-width: 480px) {
      .about-info-card h3 {
        font-size: 16px !important;
      }

      .guide-header span {
        font-size: 13px;
      }

      .guide-content h4 {
        font-size: 14px;
      }

      .info-item {
        padding: 6px 0;
      }
    }

    .total-customer-summary h2 {
      margin: 0;
      font-size: 17px;
    }

    .total-customer-summary p {
      margin: 4px 0 0;
      font-size: 22px;
      font-weight: bold;
    }

    .footer {
      text-align: center;
      padding: 10px;
      /* ‡¶™‡ßç‡¶Ø‡¶æ‡¶°‡¶ø‡¶Ç ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶®‡ßç‡¶Ø ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã ‡¶Ü‡¶∞‡¶ì ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø */
      background-color: #2D3748;
      /* ‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ */
      color: #A0AEC0;
      /* ‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ */
      font-size: 11px;
      /* ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶®‡ßç‡¶Ø ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã */
      margin-top: auto;
      page-break-before: avoid;
      border-top: 1px solid #4A5568;
      /* ‡¶â‡¶™‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶¨‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã */
    }

    .dashboard-summary-grid {
      display: grid !important;
      grid-template-columns: repeat(2, 1fr) !important;
      gap: 12px !important;
      max-width: 500px !important;
      margin: 0 auto !important;
    }

    .dashboard-summary-grid .summary-item {
      background-color: #EDF2F7;
      padding: 12px;
      border-radius: 8px;
      border-left: 4px solid var(--secondary-color);
      text-align: center;
    }

    .dashboard-summary-grid {
      display: grid !important;
      grid-template-columns: repeat(2, 1fr) !important;
      grid-template-rows: repeat(2, 1fr) !important;
      gap: 15px !important;
      max-width: 500px !important;
      margin: 0 auto !important;
    }

    .dashboard-summary-card {
      background: #f8f9fa !important;
      border: 1px solid #dee2e6 !important;
      border-radius: 8px !important;
      padding: 15px !important;
      text-align: center !important;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
      border-left: 4px solid var(--secondary-color) !important;
      transition: transform 0.2s ease, box-shadow 0.2s ease !important;
    }

    .dashboard-summary-card:hover {
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15) !important;
    }

    /* Thematic colors for dashboard cards */
    .dashboard-summary-card.total-customers {
      border-left: 4px solid #3182CE !important;
      background: linear-gradient(135deg, #EBF8FF 0%, #BEE3F8 100%) !important;
    }

    .dashboard-summary-card.total-bill {
      border-left: 4px solid #805AD5 !important;
      background: linear-gradient(135deg, #FAF5FF 0%, #E9D8FD 100%) !important;
    }

    .dashboard-summary-card.total-paid {
      border-left: 4px solid #38A169 !important;
      background: linear-gradient(135deg, #F0FFF4 0%, #C6F6D5 100%) !important;
    }

    .dashboard-summary-card.total-unpaid {
      border-left: 4px solid #DD6B20 !important;
      background: linear-gradient(135deg, #FFFAF0 0%, #FEEBC8 100%) !important;
    }

    .dashboard-summary-card h3 {
      font-size: 15px !important;
      margin: 0 0 8px 0 !important;
      color: #495057 !important;
    }

    .dashboard-summary-card p {
      font-size: 22px !important;
      font-weight: bold !important;
      margin: 0 !important;
      color: var(--primary-color) !important;
    }

    /* Activity Grid Styles */
    .activity-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 15px;
      max-height: 400px;
      overflow-y: auto;
      padding: 5px;
    }

    .activity-card {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      border-left: 4px solid var(--activity-color, #4A5568);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .activity-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    .activity-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--activity-color, #4A5568), transparent);
      opacity: 0.3;
    }

    .activity-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .activity-icon {
      font-size: 18px;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: rgba(74, 85, 104, 0.1);
    }

    .activity-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--primary-color);
      margin: 0;
      flex: 1;
    }

    .activity-time {
      font-size: 11px;
      color: #718096;
      background: #F7FAFC;
      padding: 2px 6px;
      border-radius: 10px;
    }

    .activity-description {
      font-size: 13px;
      color: #4A5568;
      margin: 8px 0 0 0;
      line-height: 1.4;
    }

    .activity-metadata {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    .activity-tag {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 8px;
      background: #EDF2F7;
      color: #4A5568;
    }

    /* Activity type specific colors */
    .activity-card.customer-added {
      --activity-color: #38A169;
    }

    .activity-card.bill-created {
      --activity-color: #3182CE;
    }

    .activity-card.bill-paid {
      --activity-color: #38A169;
    }

    .activity-card.isp-payment {
      --activity-color: #805AD5;
    }

    .activity-card.router-added {
      --activity-color: #DD6B20;
    }

    .activity-card.advance-deposit {
      --activity-color: #319795;
    }

    .activity-card.due-adjustment {
      --activity-color: #E53E3E;
    }

    .activity-card.data-import {
      --activity-color: #3182CE;
    }

    .activity-card.data-backup {
      --activity-color: #4A5568;
    }

    .activity-card.location-added {
      --activity-color: #D69E2E;
    }

    .activity-card.report-generated {
      --activity-color: #805AD5;
    }

    .no-activities {
      text-align: center;
      padding: 40px 20px;
      color: #718096;
    }

    .no-activities p {
      margin: 0;
      font-size: 14px;
    }

    @media (max-width: 768px) {
      .dashboard-summary-grid {
        gap: 10px !important;
        max-width: 100% !important;
        margin: 0 !important;
      }

      .dashboard-summary-card {
        padding: 12px !important;
      }

      .dashboard-summary-card h3 {
        font-size: 13px !important;
      }

      .dashboard-summary-card p {
        font-size: 18px !important;
      }

      .profile-info-grid {
        grid-template-columns: repeat(1, 1fr);
        gap: 10px;
      }

      .profile-info-item {
        padding: 12px;
      }
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1003;
      padding: 15px;
      box-sizing: border-box;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .modal.active {
      display: flex;
      opacity: 1;
    }

    .modal-content {
      background: white;
      padding: 25px;
      border-radius: 12px;
      width: 90%;
      max-width: 450px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
      transform: scale(0.95);
      transition: transform 0.3s ease;
      max-height: 90vh;
      overflow-y: auto;
      /* Added for mobile responsiveness */
    }

    .modal.active .modal-content {
      transform: scale(1);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #E2E8F0;
      padding-bottom: 10px;
      margin-bottom: 15px;
    }

    .modal-header h2 {
      font-size: 18px;
      margin: 0;
    }

    .modal-close {
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      background: none;
      border: none;
    }

    .modal-body p {
      margin: 0 0 10px 0;
      font-size: 14px;
    }

    .modal-body .form-group {
      margin-bottom: 15px;
    }

    .note-tags {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    .note-tag {
      background-color: #E2E8F0;
      color: var(--primary-color);
      padding: 4px 10px;
      border-radius: 15px;
      font-size: 12px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .note-tag:hover {
      background-color: #CBD5E0;
    }

    .adjustment-list {
      list-style: none;
      padding: 0;
      max-height: 150px;
      overflow-y: auto;
      border: 1px solid #E2E8F0;
      border-radius: 5px;
      margin-top: 15px;
    }

    .adjustment-list li {
      padding: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #E2E8F0;
    }

    .adjustment-list li:last-child {
      border-bottom: none;
    }

    .adjustment-info {
      font-size: 13px;
    }

    .location-list {
      list-style: none;
      padding: 0;
      margin-top: 15px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      max-height: 250px;
      overflow-y: auto;
    }

    .location-list li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      border-bottom: 1px solid var(--border-color);
    }

    .location-list li:last-child {
      border-bottom: none;
    }

    .location-list .location-name {
      font-weight: 500;
    }

    .location-list .actions button {
      font-size: 11px;
      padding: 4px 8px;
    }

    .router-form-container {
      display: none;
      padding-top: 20px;
    }

    .router-form-container.active {
      display: block;
    }

    .router-form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .router-form-grid .form-group.full-width {
      grid-column: 1 / -1;
    }

    .router-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 15px;
    }

    .router-item {
      background-color: var(--card-bg);
      border-radius: 10px;
      box-shadow: 0 4px 12px var(--shadow-color);
      padding: 15px 20px;
      display: flex;
      align-items: center;
      transition: transform 0.2s, box-shadow 0.2s, border-left-color 0.2s;
      border-left: 5px solid transparent;
    }

    .router-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      border-left: 5px solid var(--secondary-color);
    }

    .router-item-content {
      flex-grow: 1;
      display: flex;
      align-items: center;
      cursor: pointer;
    }

    .router-item-content img {
      width: 40px;
      height: 40px;
      margin-right: 20px;
    }

    .router-info {
      flex-grow: 1;
    }

    .router-info .name {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-color);
    }

    .router-info .model {
      font-size: 13px;
      color: #718096;
      margin-top: 2px;
    }

    .router-info .customer-count {
      font-size: 12px;
      color: var(--paid-color);
      font-weight: 500;
      margin-top: 5px;
    }

    .router-delete-btn {
      background: none;
      border: none;
      color: #A0AEC0;
      font-size: 22px;
      font-weight: bold;
      cursor: pointer;
      padding: 5px 10px;
      border-radius: 50%;
      transition: color 0.2s, background-color 0.2s;
    }

    .router-delete-btn:hover {
      color: var(--delete-btn-bg);
      background-color: #FED7D7;
    }

    .router-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1005;
      padding: 15px;
      box-sizing: border-box;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .router-modal-overlay.active {
      display: flex;
      opacity: 1;
    }

    .router-modal-content {
      background: white;
      padding: 25px;
      border-radius: 12px;
      width: 90%;
      max-width: 450px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
      transform: scale(0.95);
      transition: transform 0.3s ease;
      max-height: 90vh;
      overflow-y: auto;
      /* Added for mobile responsiveness */
    }

    .router-modal-overlay.active .router-modal-content {
      transform: scale(1);
    }

    .router-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 10px;
      margin-bottom: 20px;
    }

    .router-modal-header h2 {
      font-size: 20px;
      margin: 0;
      color: var(--secondary-color);
    }

    .router-modal-close {
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      background: none;
      border: none;
      color: #A0AEC0;
      transition: color 0.2s;
    }

    .router-modal-close:hover {
      color: var(--text-color);
    }

    .router-modal-body table {
      width: 100%;
      text-align: left;
      border-collapse: collapse;
    }

    .router-modal-body th,
    .router-modal-body td {
      padding: 10px 4px;
      border-bottom: 1px solid #F7FAFC;
    }

    .router-modal-body th {
      width: 140px;
      font-weight: 500;
      color: #718096;
      font-size: 13px;
    }

    .router-modal-body td {
      font-weight: 600;
      font-size: 14px;
    }

    .access-btn {
      display: block;
      margin-top: 25px;
      padding: 12px;
      background-color: var(--secondary-color);
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      text-align: center;
      transition: background-color 0.2s;
    }

    .access-btn:hover {
      background-color: #434190;
    }

    .page-controls {
      display: flex;
      gap: 15px;
      margin-bottom: 18px;
      flex-wrap: wrap;
      align-items: center;
    }

    .search-box {
      flex-grow: 1;
      position: relative;
      max-width: 100%;
      /* Ensure it doesn't overflow on small screens */
    }

    .search-box input {
      width: 100%;
      padding: 8px 12px 8px 35px;
      border: 1px solid #CBD5E0;
      border-radius: 5px;
      font-size: 14px;
      box-sizing: border-box;
      /* Include padding and border in the element's total width and height */
    }

    .search-box::before {
      content: 'üîç';
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #A0AEC0;
    }

    .filter-buttons {
      display: flex;
      gap: 10px;
    }

    .filter-btn {
      background-color: #EDF2F7;
      color: var(--text-color);
      border: 1px solid #E2E8F0;
    }

    .filter-btn.active {
      background-color: var(--secondary-color);
      color: white;
      border-color: var(--secondary-color);
    }

    /* UPDATED Styles for Customer Profile Modal (v4.1) */
    #customerProfileModal.modal {
      max-width: 550px;
      z-index: 1004;
    }

    .profile-modal-body {
      max-height: 80vh;
      overflow-y: auto;
      padding: 5px 15px 5px 5px;
    }

    .profile-header {
      text-align: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
    }

    .profile-header h3 {
      margin: 0 0 5px 0;
      font-size: 24px;
      color: var(--primary-color);
    }

    .profile-header p {
      margin: 0;
      color: #718096;
      font-size: 13px;
    }

    .profile-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .profile-info-item {
      background: var(--card-bg);
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 4px 12px var(--shadow-color);
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      font-size: 12px;
    }

    .profile-info-item strong {
      color: var(--primary-color);
      margin-bottom: 3px;
      font-size: 11px;
    }

    .profile-info-item span {
      font-weight: 600;
      color: var(--text-color);
      font-size: 13px;
    }

    .edit-btn {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      margin-left: 10px;
    }

    .edit-btn:hover {
      background: #2563eb;
    }

    .router-edit-btn {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 10px;
      position: absolute;
      top: 5px;
      right: 5px;
      z-index: 10;
    }

    .router-edit-btn:hover {
      background: #2563eb;
    }

    .router-item {
      position: relative;
      padding: 15px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #f9f9f9;
    }

    .isp-bill-item {
      position: relative;
      padding: 15px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #f9f9f9;
    }

    @media (max-width: 768px) {
      .summary-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }

      .summary-item {
        padding: 15px;
      }

      .summary-item h3 {
        font-size: 14px;
      }

      .summary-item p {
        font-size: 18px;
      }
    }

    #profile-financial-status-item span {
      padding: 4px 10px;
      border-radius: 15px;
      color: white;
    }

    .profile-section-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--primary-color);
      border-bottom: 2px solid var(--border-color);
      padding-bottom: 8px;
      margin-top: 25px;
      margin-bottom: 15px;
    }

    .profile-billing-history {
      list-style: none;
      padding: 0;
    }

    .profile-billing-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 10px;
      border-radius: 6px;
      margin-bottom: 8px;
      background-color: #EDF2F7;
      transition: background-color 0.2s;
    }

    .profile-billing-item:hover {
      background-color: #E2E8F0;
    }

    .profile-billing-item .month {
      font-weight: 600;
    }

    .profile-billing-item .amount {
      font-size: 15px;
    }

    @media (max-width: 768px) {
      .sidebar {
        left: -220px;
      }

      .sidebar.active {
        left: 0;
      }

      .main-content {
        margin-left: 0;
      }

      /* .header-title span { display: none; } */
      /* Removed this line */
    }

    @media (max-width: 600px) {
      .router-form-grid {
        grid-template-columns: 1fr;
      }

      .page-controls {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
      }

      .filter-buttons {
        justify-content: center;
      }

      .profile-header h3 {
        font-size: 20px;
      }

      .profile-info-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .page {
        padding: 8px;
      }

      .card {
        padding: 15px;
      }

      .router-modal-content {
        padding: 20px;
      }

      .router-modal-header h2 {
        font-size: 18px;
      }

      .router-modal-body th {
        width: 110px;
      }

      .router-form-container {
        padding: 10px;
      }

      .router-form-grid {
        gap: 10px;
      }

      .form-group {
        margin-bottom: 10px;
      }
    }

    @media (max-width: 375px) {

      .router-modal-body th,
      .router-modal-body td {
        font-size: 13px;
        padding: 8px 2px;
      }
    }

    /* Payment Modal Styles */
    .payment-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1004;
      padding: 15px;
      box-sizing: border-box;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .payment-modal.active {
      display: flex;
      opacity: 1;
    }

    .payment-modal-content {
      background: white;
      padding: 25px;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
      transform: scale(0.95);
      transition: transform 0.3s ease;
      max-height: 90vh;
      overflow-y: auto;
    }

    .payment-modal.active .payment-modal-content {
      transform: scale(1);
    }

    .payment-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #E2E8F0;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }

    .payment-modal-header h2 {
      font-size: 18px;
      margin: 0;
      color: var(--primary-color);
    }

    .payment-modal-close {
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      background: none;
      border: none;
      color: #A0AEC0;
      transition: color 0.2s;
    }

    .payment-modal-close:hover {
      color: var(--text-color);
    }

    .payment-modal-body {
      margin-bottom: 20px;
    }

    .payment-info {
      background: #F7FAFC;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid var(--secondary-color);
    }

    .payment-info h4 {
      margin: 0 0 8px 0;
      color: var(--primary-color);
      font-size: 14px;
    }

    .payment-info p {
      margin: 4px 0;
      font-size: 13px;
      color: var(--text-color);
    }

    .payment-amount-input {
      margin-bottom: 20px;
    }

    .payment-amount-input label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--primary-color);
      font-size: 14px;
    }

    .payment-amount-input input {
      width: 100%;
      padding: 12px;
      border: 2px solid #E2E8F0;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      text-align: center;
      box-sizing: border-box;
      transition: border-color 0.2s;
    }

    .payment-amount-input input:focus {
      outline: none;
      border-color: var(--secondary-color);
    }

    .payment-buttons {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .payment-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .payment-btn-submit {
      background-color: var(--button-bg);
      color: white;
    }

    .payment-btn-submit:hover {
      background-color: var(--button-hover-bg);
      transform: translateY(-1px);
    }

    .payment-btn-cancel {
      background-color: #E2E8F0;
      color: var(--text-color);
    }

    .payment-btn-cancel:hover {
      background-color: #CBD5E0;
    }

    /* Status styles for partially paid bills */
    .status-partially-paid {
      color: var(--pending-color);
      font-weight: 600;
    }

    /* Adjust button in customer profile */
    .profile-adjust-btn {
      background-color: var(--accent-color);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 15px;
    }

    .profile-adjust-btn:hover {
      background-color: #6B46C1;
      transform: translateY(-1px);
    }

    /* Payment History Styles */
    .payment-history-section {
      margin-top: 20px;
      border-top: 1px solid #E2E8F0;
      padding-top: 20px;
    }

    .payment-history-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .payment-history-list {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #E2E8F0;
      border-radius: 6px;
      background: #F7FAFC;
    }

    .payment-history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      border-bottom: 1px solid #E2E8F0;
      font-size: 13px;
    }

    .payment-history-item:last-child {
      border-bottom: none;
    }

    .payment-history-item:hover {
      background: #EDF2F7;
    }

    .payment-history-date {
      color: #718096;
      font-size: 12px;
    }

    .payment-history-amount {
      font-weight: 600;
      color: var(--paid-color);
    }

    .payment-history-empty {
      text-align: center;
      padding: 20px;
      color: #A0AEC0;
      font-style: italic;
    }

    /* ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡¶ø‡¶Æ‡ßç‡¶™‡¶≤ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
    .simple-status-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 6px 14px;
      border: none;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 80px;
      /* ‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶• */
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .simple-status-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }

    .simple-status-btn svg {
      width: 16px;
      height: 16px;
    }

    /* ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ ‡¶∞‡¶ô (‡¶∏‡¶¨‡ßÅ‡¶ú) */
    .btn-is-active {
      background-color: #28a745;
      color: white;
    }

    /* ‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ ‡¶∞‡¶ô (‡¶≤‡¶æ‡¶≤) */
    .btn-is-inactive {
      background-color: #E53E3E;
      color: white;
    }

    .profile-window {
      background-color: white;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 380px;
      padding: 25px;
    }

    .profile-header {
      text-align: center;
      margin-bottom: 25px;
    }

    .profile-header h2 {
      font-size: 22px;
      font-weight: 600;
      color: #333;
      margin: 0;
    }

    .profile-info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 12px;
    }

    .profile-info-item {
      background-color: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      -webkit-tap-highlight-color: transparent;
    }

    .profile-info-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      background-color: #ffffff;
    }

    .profile-info-item:active {
      transform: translateY(0);
      background-color: #e9ecef;
    }

    .profile-info-item strong {
      color: #6c757d;
      font-size: 11px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .profile-info-item span {
      color: #212529;
      font-size: 13px;
      font-weight: 600;
    }

    .full-width-item {
      grid-column: 1 / -1;
    }

    .icon {
      font-size: 14px;
    }

    .billing-history-section {
      margin-top: 25px;
      border-top: 1px solid #e9ecef;
      padding-top: 20px;
    }

    .billing-history-section h3 {
      font-size: 16px;
      font-weight: 600;
      color: #343a40;
      margin: 0 0 15px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .billing-history-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .billing-history-item {
      background-color: #f8f9fa;
      border-radius: 8px;
      padding: 8px 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-left: 4px solid;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      -webkit-tap-highlight-color: transparent;
    }

    .billing-history-item:hover {
      transform: scale(1.03);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      background-color: #ffffff;
    }

    .billing-history-item:active {
      transform: scale(0.98);
      background-color: #e9ecef;
    }

    .item-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .item-info .month {
      font-weight: 600;
      font-size: 14px;
      color: #495057;
    }

    .item-info .details {
      font-size: 11px;
      color: #6c757d;
    }

    .item-status {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }

    .item-status .status {
      font-weight: 600;
      font-size: 12px;
    }

    .item-status .due {
      font-size: 11px;
      font-weight: 600;
      color: #dc3545;
    }

    .status-paid {
      color: #28a745;
      border-color: #28a745;
    }

    .status-unpaid {
      color: #dc3545;
      border-color: #dc3545;
    }

    .status-partially-paid {
      color: #ffc107;
      border-color: #ffc107;
    }

    .status-partially-paid .status {
      color: #b58900;
    }

  </style>
</head>

<body>
  <div id="overlay"></div>
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <img id="sidebar-company-logo" src="" alt="Company Logo" style="height: 28px; margin-right: 8px; display: none;">
      <h2 class="sidebar-title" id="sidebar-company-name">‡¶Æ‡ßá‡¶®‡ßÅ</h2>
    </div>
    <ul class="sidebar-menu">
      <li><a href="#" class="menu-item active" data-page="dashboard"><svg xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z" />
          </svg><span>‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</span></a></li>
      <li><a href="#" class="menu-item" data-page="add_customer"><svg xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path
              d="M8 12a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0 2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zm0 3c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4zm10-9V7h-2v3h-3v2h3v3h2v-3h3v-2h-3z" />
          </svg><span>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Ø‡ßã‡¶ó</span></a></li>
      <li><a href="#" class="menu-item" data-page="customers"><svg xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path
              d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
          </svg><span>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</span></a></li>
      <li><a href="#" class="menu-item" data-page="billing"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            width="20" height="20" fill="currentColor">
            <path
              d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z" />
          </svg><span>‡¶¨‡¶ø‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</span></a></li>
      <li><a href="#" class="menu-item" data-page="isp_bill"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            width="20" height="20" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9V8h2v8zm4 0h-2V8h2v8z" />
          </svg><span>‡¶Ü‡¶á‡¶è‡¶∏‡¶™‡¶ø ‡¶¨‡¶ø‡¶≤</span></a></li>
      <li><a href="#" class="menu-item" data-page="reports"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            width="20" height="20" fill="currentColor">
            <path
              d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" />
          </svg><span>‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</span></a></li>
      <li><a href="#" class="menu-item" data-page="advance"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            width="20" height="20" fill="currentColor">
            <path d="M12.01 21.49L23.64 7c-.45-.34-4.93-4-11.64-4C5.28 3 .81 6.66.36 7l11.63 14.49.01.01.01-.01z" />
          </svg><span>‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞</span></a></li>
      <li><a href="#" class="menu-item" data-page="settings"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            width="20" height="20" fill="currentColor">
            <path
              d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17-.59-1.69-.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69-.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23-.09.49 0 .61.22l2-3.46c.12-.22.07.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z" />
          </svg><span>‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</span></a></li>
      <li><a href="#" class="menu-item" data-page="about"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            width="20" height="20" fill="currentColor">
            <path
              d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z" />
          </svg><span>About</span></a></li>
    </ul>
  </div>

  <div class="main-content" id="main-content">
    <header class="header">
      <div class="header-left">
        <button class="menu-toggle" id="menu-toggle">‚ò∞</button>
        <h1 class="header-title"><img id="header-company-logo" src="/AbidNetwork/logo.png" alt="Company Logo"
            style="height: 28px; margin-right: 8px;"><span id="header-company-name">Abid Network</span></h1>
      </div>
      <h2 id="page-title">‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h2>
    </header>

    <div class="page-container">
      <main class="page active" id="dashboard">
        <div class="card">
          <h2>‡¶ö‡¶≤‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂</h2>
          <div id="dashboard-summary" class="dashboard-summary-grid">
            <div class="dashboard-summary-card total-customers">
              <h3>‡¶Æ‡ßã‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï</h3>
              <p id="db-total-customers">0</p>
            </div>
            <div class="dashboard-summary-card total-bill">
              <h3>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶≤</h3>
              <p id="db-total-bill">‡ß≥0</p>
            </div>
            <div class="dashboard-summary-card total-paid">
              <h3>‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º</h3>
              <p id="db-total-paid">‡ß≥0</p>
            </div>
            <div class="dashboard-summary-card total-unpaid">
              <h3>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ</h3>
              <p id="db-total-unpaid">‡ß≥0</p>
            </div>
          </div>
        </div>
        <!-- ‚òÖ‚òÖ‚òÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ø‡¶≤ ‡¶∞‡¶ø‡¶Æ‡¶æ‡¶á‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶¨‡¶ï‡ßç‡¶∏‡ßá‡¶∞ ‡¶ï‡ßã‡¶° (‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®) ‚òÖ‚òÖ‚òÖ -->
        <div id="bill-reminder-notification"
          style="display: none; background: linear-gradient(135deg, #FFF3CD 0%, #FCE4EC 100%); border: 1px solid #F0AD4E; border-radius: 6px; padding: 10px; margin-bottom: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
          <div style="display: flex; align-items: center; gap: 8px;">
            <!-- ‡¶Ü‡¶á‡¶ï‡¶® -->
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="#E53E3E"
              style="flex-shrink: 0;">
              <path
                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" />
            </svg>
            <!-- ‡¶≤‡ßá‡¶ñ‡¶æ -->
            <div id="bill-reminder-content-wrapper" style="flex-grow: 1;">
              <!-- ‡¶∞‡¶ø‡¶Æ‡¶æ‡¶á‡¶®‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡ßç‡¶¨‡ßü‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶∏‡¶¨‡ßá -->
            </div>
            <!-- ‡¶¨‡¶æ‡¶ü‡¶® -->
            <button id="view-due-bills-btn" class="btn btn-delete"
              style="font-size: 11px; padding: 4px 8px; flex-shrink: 0;">‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
          </div>
        </div>

        <!-- Dashboard Backup Notification -->
        <div id="dashboard-backup-reminder-notification"
          style="display: none; background: linear-gradient(135deg, #FFF3CD 0%, #FCE4EC 100%); border: 1px solid #F0AD4E; border-radius: 6px; padding: 10px; margin-bottom: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
          <div style="display: flex; align-items: center; gap: 8px;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="#F57C00"
              style="flex-shrink: 0;">
              <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z" />
            </svg>
            <div style="flex-grow: 1;">
              <h4 style="margin: 0 0 3px 0; color: #E65100; font-size: 13px; font-weight: 600;">‡¶°‡ßá‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶∏‡ßÅ‡¶™‡¶æ‡¶∞‡¶ø‡¶∂
              </h4>
              <p style="margin: 0; color: #BF360C; font-size: 11px; line-height: 1.3;">‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶°‡ßá‡¶ü‡¶æ ‡¶Ø‡ßã‡¶ó
                ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§ ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶°‡ßá‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡ßÅ‡¶™‡¶æ‡¶∞‡¶ø‡¶∂ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§</p>
            </div>
            <button onclick="hideDashboardBackupReminder()"
              style="background: none; border: none; color: #E65100; font-size: 16px; cursor: pointer; padding: 3px; line-height: 1;">√ó</button>
          </div>
        </div>

        <div class="card">
          <h2 style="display: flex; justify-content: space-between; align-items: center;">
            <span>‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</span>
            <button id="clear-activity-log-btn" class="btn btn-delete" style="font-size: 12px; padding: 5px 10px;">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="currentColor"
                style="vertical-align: middle; margin-right: 4px;">
                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
              </svg>
              ‡¶≤‡¶ó ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®
            </button>
          </h2>
          <div id="recent-activities" class="activity-grid">
            <!-- Activities will be dynamically loaded here -->
          </div>
          <div id="no-activities" class="no-activities" style="display: none;">
            <p>‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§</p>
          </div><!-- ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶° ‡¶∂‡ßÅ‡¶∞‡ßÅ -->
          <div id="activity-loader" style="text-align: center; margin-top: 20px; display: none;">
            <button class="btn btn-submit" id="load-more-activities-btn">‡¶Ü‡¶∞‡ßã ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
          </div>
          <!-- ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶° ‡¶∂‡ßá‡¶∑ -->
        </div>
      </main>

      <main class="page" id="add_customer">
        <div class="card" id="customer-form-card">
          <h2 id="customer-form-title">‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
          <form id="customerForm">
            <input type="hidden" id="customerId">
            <div class="form-grid">
              <div class="form-group"><label for="customerName">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="customerName"
                  required></div>
              <div class="form-group"><label for="customerPhone">‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label><input type="text"
                  id="customerPhone"></div>
              <div class="form-group"><label for="customerHouse">‡¶¨‡¶æ‡ßú‡¶ø</label><select id="customerHouse"
                  required></select></div>
              <div class="form-group"><label for="customerBill">‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶¨‡¶ø‡¶≤</label><select id="customerBill"
                  required></select></div>
              <div class="form-group hidden" id="customBillGroup"><label for="customBillAmount">‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶¨‡¶ø‡¶≤
                  ‡¶¨‡¶∏‡¶æ‡¶®</label><input type="number" id="customBillAmount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£"></div>
              <div class="form-group"><label for="connectionDate">‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label><input type="date"
                  id="connectionDate" required></div>
              <div class="form-group form-group-checkbox" style="align-self: center;"><input type="checkbox"
                  id="isFreeUser"><label for="isFreeUser">‡¶´‡ßç‡¶∞‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞?</label></div>
            </div>
            <div class="form-group" style="margin-top: 15px;">
              <label for="macAddress">MAC ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
              <!-- ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶° (‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶æ‡¶®) -->
              <div class="mac-input-container" id="customerMacContainer"></div>

            </div>
            <div style="text-align: right; margin-top: 18px;">
              <button type="button" class="btn btn-delete" id="customer-cancel-btn"
                style="display: none; margin-right: 10px;">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
              <button type="submit" class="btn btn-submit" id="customer-submit-btn">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
          </form>
        </div>
      </main>
      <main class="page" id="customers">
        <div class="total-customer-summary">
          <h2>‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï</h2>
          <p id="total-customer-count">0</p>
        </div>
        <div class="page-controls">
          <div class="search-box">
            <input type="text" id="customer-search-input" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶´‡ßã‡¶® ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...">
          </div>
        </div>

        <div id="customer-list-by-house"></div>
      </main>

      <main class="page" id="billing">
        <div class="card">
          <h2>‡¶¨‡¶ø‡¶≤ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
          <div class="form-grid" style="align-items: flex-end;">
            <div class="form-group"><label for="generateMonth">‡¶Æ‡¶æ‡¶∏</label><select id="generateMonth"></select></div>
            <div class="form-group"><label for="generateYear">‡¶¨‡¶õ‡¶∞</label><select id="generateYear"></select></div>
            <div class="form-group"><label for="generateForCustomer">‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label><select
                id="generateForCustomer"></select></div>
            <div style="display: flex; gap: 10px;">
              <button id="generateBillsBtn" class="btn btn-submit">‡¶¨‡¶ø‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
              <button id="delete-month-bills-btn" class="btn btn-delete">‡¶∏‡¶¨ ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
            </div>
          </div>
        </div>
        <div class="page-controls">
          <div class="search-box">
            <input type="text" id="billing-search-input" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...">
          </div>
          <div class="filter-buttons" id="customer-list-filters">
          </div>
        </div>
        <div id="billing-list-by-house"></div>
      </main>

      <main class="page" id="isp_bill">
        <div class="card">
          <h2>‡¶Ü‡¶á‡¶è‡¶∏‡¶™‡¶ø ‡¶¨‡¶ø‡¶≤ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
          <form id="ispBillForm">
            <div class="form-grid">
              <div class="form-group"><label for="ispMonth">‡¶Æ‡¶æ‡¶∏</label><select id="ispMonth"></select></div>
              <div class="form-group"><label for="ispYear">‡¶¨‡¶õ‡¶∞</label><select id="ispYear"></select></div>
              <div class="form-group"><label for="ispAmount">‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</label><input type="number" id="ispAmount"
                  value="900" required></div>
              <div class="form-group"><label for="ispPayDate">‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label><input type="date" id="ispPayDate"
                  required></div>
            </div>
            <div style="text-align: right; margin-top: 18px;"><button type="submit" class="btn btn-submit">‡¶¨‡¶ø‡¶≤ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß
                ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>
          </form>
        </div>
        <div class="card">
          <h2>‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶ï‡¶∞‡¶æ ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ <button id="delete-all-isp-history-btn" class="btn btn-delete"
              style="font-size: 11px; padding: 4px 8px; float: right;">‡¶∏‡¶¨ ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button></h2>
          <div class="table-container">
            <table class="data-table" id="ispHistoryTable">
              <thead>
                <tr>
                  <th>‡¶Æ‡¶æ‡¶∏/‡¶¨‡¶õ‡¶∞</th>
                  <th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
                  <th>‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                  <th>‡¶è‡¶ï‡¶∂‡¶®</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </main>

      <main class="page" id="reports">
        <div class="card">
          <h2>‡¶®‡ßá‡¶ü‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h2>
          <div class="form-grid" style="margin-bottom: 18px;">
            <div class="form-group"><label for="reportMonth">‡¶Æ‡¶æ‡¶∏</label><select id="reportMonth"></select></div>
            <div class="form-group"><label for="reportYear">‡¶¨‡¶õ‡¶∞</label><select id="reportYear"></select></div>
            <div class="form-group" style="display: flex; align-items: end;">
              <button class="btn btn-submit" id="printReportPdfBtn"
                style="background-color: #E53E3E; color: white; font-size: 14px; padding: 10px 20px;">
                üìÑ ‡¶™‡¶ø‡¶°‡¶ø‡¶è‡¶´ ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
              </button>
            </div>
            <div class="form-group">
              <label for="customerBillingHistorySelect">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶¨‡¶ø‡¶≤‡¶ø‡¶Ç ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</label>
              <select id="customerBillingHistorySelect"></select>
            </div>
            <div class="form-group" style="display: flex; align-items: end;">
              <button class="btn btn-submit" id="downloadCustomerBillingHistoryBtn"
                style="background-color: #3182CE; color: white; font-size: 14px; padding: 10px 20px;">
                ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
              </button>
            </div>
          </div>
          <hr>
          <div id="report-summary-total" style="margin-bottom: 25px;">
            <h3>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂</h3>
            <div class="summary-grid">
              <div class="summary-item">
                <h3>‡¶Æ‡ßã‡¶ü ‡¶Ü‡ßü</h3>
                <p id="total-revenue">‡ß≥0</p>
              </div>
              <div class="summary-item">
                <h3>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ï‡ßá‡ßü‡¶æ</h3>
                <p id="total-dues">‡ß≥0</p>
              </div>
              <div class="summary-item" style="border-color: var(--delete-btn-bg);">
                <h3>‡¶Ü‡¶á‡¶è‡¶∏‡¶™‡¶ø ‡¶¨‡¶ø‡¶≤</h3>
                <p id="isp-paid-amount">‡ß≥0</p>
              </div>
              <div class="summary-item" style="border-color: var(--paid-color);">
                <h3>‡¶®‡¶ø‡¶ü ‡¶Ü‡ßü</h3>
                <p id="net-income">‡ß≥0</p>
              </div>
            </div>
          </div>
          <div id="report-summary-by-house">
            <h3>‡¶¨‡¶æ‡ßú‡¶ø ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h3>
            <div id="house-reports-container" class="summary-grid"></div>
          </div>
        </div>
      </main>

      <main class="page" id="advance">
        <div class="card">
          <h2>‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
          <button class="btn btn-submit" id="toggleRouterFormBtn" style="margin-bottom: 15px;">‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó
            ‡¶ï‡¶∞‡ßÅ‡¶®</button>
          <div class="router-form-container" id="routerFormContainer">
            <form id="routerForm">
              <input type="hidden" id="routerId">
              <div class="router-form-grid">
                <div class="form-group"><label for="routerName">‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="routerName"
                    required></div>
                <div class="form-group"><label for="routerModel">‡¶Æ‡¶°‡ßá‡¶≤</label><input type="text" id="routerModel"
                    required></div>
                <div class="form-group"><label for="routerIp">‡¶Ü‡¶á‡¶™‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏</label><input type="text" id="routerIp"
                    required></div>
                <div class="form-group">
                  <label for="routerMacAddress">‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ï ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏</label>
                  <!-- ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶° (‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶´‡¶∞‡ßç‡¶Æ‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø) -->
                  <div class="mac-input-container" id="routerMacContainer"></div>

                </div>
                <div class="form-group">
                  <label for="routerDistanceFeet">‡¶Æ‡ßá‡¶á‡¶® ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶¶‡ßÇ‡¶∞‡¶§‡ßç‡¶¨ (‡¶´‡¶ø‡¶ü)</label>
                  <input type="number" id="routerDistanceFeet" placeholder="‡¶´‡¶ø‡¶ü‡ßá ‡¶¶‡ßÇ‡¶∞‡¶§‡ßç‡¶¨ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
                  <small style="color: #666; font-size: 12px;">‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞‡ßá ‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞‡¶ø‡¶§ ‡¶π‡¶¨‡ßá</small>
                </div>
                <div class="form-group">
                  <label for="routerDistanceMeters">‡¶¶‡ßÇ‡¶∞‡¶§‡ßç‡¶¨ (‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞)</label>
                  <input type="number" id="routerDistanceMeters" step="0.01" readonly>
                </div>
                <div class="form-group"><label for="routerPowerSpec">‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡ßç‡¶™‡ßá‡¶∏‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®</label><input type="text"
                    id="routerPowerSpec" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 12V 1.5A"></div>
                <div class="form-group"><label for="routerPassword">‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label><input type="text"
                    id="routerPassword" placeholder="‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°"></div>
                <div class="form-group"><label for="routerImage">‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø</label><input type="file" id="routerImage"
                    accept="image/*"><small style="color: #666; font-size: 12px;">‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï: ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶°
                    ‡¶ï‡¶∞‡ßÅ‡¶®</small></div>
                <div class="form-group full-width"><label for="routerLocationSelect">‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®</label><select
                    id="routerLocationSelect" required></select></div>
              </div>
              <div style="text-align: right; margin-top: 15px;"><button type="submit" class="btn btn-submit">‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó
                  ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>
            </form>
          </div>
          <div class="router-list" id="router-list"></div>
        </div>
      </main>
      <main class="page" id="settings">
        <div class="card">
          <h2>‡¶ì‡¶Ø‡¶º‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶®</h2>
          <div class="form-grid" style="margin-bottom: 20px;">
            <div class="form-group">
              <label for="websiteName">‡¶ì‡¶Ø‡¶º‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
              <input type="text" id="websiteName" placeholder="Abid Network" class="form-control">
              <button class="btn btn-submit" id="updateWebsiteNameBtn"
                style="margin-top: 8px; font-size: 12px; padding: 6px 12px;">‡¶®‡¶æ‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
            <div class="form-group">
              <label for="websiteLogo">‡¶ì‡¶Ø‡¶º‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü‡ßá‡¶∞ ‡¶≤‡ßã‡¶ó‡ßã</label>
              <input type="file" id="websiteLogo" accept="image/*" class="form-control">
              <button class="btn btn-submit" id="updateWebsiteLogoBtn"
                style="margin-top: 8px; font-size: 12px; padding: 6px 12px;">‡¶≤‡ßã‡¶ó‡ßã ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
              <small style="color: #666; font-size: 12px; display: block; margin-top: 4px;">‡¶∏‡ßÅ‡¶™‡¶æ‡¶∞‡¶ø‡¶∂: 40x40 ‡¶™‡¶ø‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶¨‡¶æ
                ‡¶§‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶õ‡¶æ‡¶ï‡¶æ‡¶õ‡¶ø ‡¶∏‡¶æ‡¶á‡¶ú‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</small>
            </div>
          </div>
          <hr style="margin: 20px 0;">
        </div>
        <div class="card">
          <h2>‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
          <form id="locationForm" style="display: flex; gap: 10px; margin-bottom: 15px;">
            <input type="text" id="newLocationName" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶æ‡¶°‡¶º‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" class="form-control"
              style="flex-grow: 1; padding: 8px; border: 1px solid #CBD5E0; border-radius: 5px;" required>
            <button type="submit" class="btn btn-submit">‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
          </form>
          <ul class="location-list" id="locationList"></ul>
        </div>
        <div class="card">
          <h2>‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
          <div id="backup-reminder-notification"
            style="display: none; background: linear-gradient(135deg, #FFF3CD 0%, #FCE4EC 100%); border: 1px solid #F0AD4E; border-radius: 8px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <div style="display: flex; align-items: center; gap: 12px;">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="#F57C00"
                style="flex-shrink: 0;">
                <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z" />
              </svg>
              <div style="flex-grow: 1;">
                <h4 style="margin: 0 0 5px 0; color: #E65100; font-size: 16px;">‡¶°‡ßá‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶∏‡ßÅ‡¶™‡¶æ‡¶∞‡¶ø‡¶∂</h4>
                <p style="margin: 0; color: #BF360C; font-size: 14px;">‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶°‡ßá‡¶ü‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§ ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ‡¶∞
                  ‡¶ú‡¶®‡ßç‡¶Ø ‡¶°‡ßá‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡ßÅ‡¶™‡¶æ‡¶∞‡¶ø‡¶∂ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§</p>
              </div>
              <button onclick="hideBackupReminder()"
                style="background: none; border: none; color: #E65100; font-size: 18px; cursor: pointer; padding: 5px;">√ó</button>
            </div>
          </div>
          <p>‡¶è‡¶ñ‡¶æ‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶®‡¶ø‡¶§‡ßá (‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü) ‡¶è‡¶¨‡¶Ç ‡¶™‡ßÅ‡¶®‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡¶æ‡¶∞ (‡¶á‡¶Æ‡¶™‡ßã‡¶∞‡ßç‡¶ü) ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§</p>
          <div
            style="background: #F8F9FA; border-radius: 8px; padding: 15px; margin-bottom: 20px; border-left: 4px solid #17A2B8;">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="#17A2B8">
                <path
                  d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z" />
              </svg>
              <strong style="color: #17A2B8; font-size: 14px;">‡¶∂‡ßá‡¶∑ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶§‡¶•‡ßç‡¶Ø</strong>
            </div>
            <div style="color: #495057; font-size: 14px;">
              <strong>‡¶∂‡ßá‡¶∑ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü:</strong> <span id="last-export-date">‡¶ï‡¶ñ‡¶®‡ßã ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø</span>
            </div>
          </div>
          <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
            <button id="export-data-btn" class="btn btn-submit">‡¶°‡ßá‡¶ü‡¶æ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® (JSON)</button>
            <input type="file" id="import-file-input" accept=".json" style="display: none;">
            <button id="import-data-btn" class="btn btn-submit" style="background-color: #2B6CB0;">‡¶°‡ßá‡¶ü‡¶æ ‡¶á‡¶Æ‡¶™‡ßã‡¶∞‡ßç‡¶ü
              ‡¶ï‡¶∞‡ßÅ‡¶®</button>
          </div>
          <div class="settings-section" style="margin-top: 30px;">
            <h2>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</h2>
            <p>‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ: ‡¶è‡¶á ‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡•§ ‡¶è‡¶á ‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶´‡ßá‡¶∞‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§</p>
            <button id="reset-app-btn" class="btn" style="background-color: var(--reset-btn-bg);">‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü
              ‡¶ï‡¶∞‡ßÅ‡¶®</button>
          </div>
        </div>
      </main>

      <main class="page" id="about">
        <div class="card">
          <h2>‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶§‡¶•‡ßç‡¶Ø</h2>
          <div class="about-info-grid">
            <div class="about-info-card">
              <h3 style="margin: 0 0 15px 0; color: var(--secondary-color); font-size: 18px;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"
                  style="vertical-align: middle; margin-right: 8px;">
                  <path
                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z" />
                </svg>
                ‡¶∏‡¶Ç‡¶∏‡ßç‡¶ï‡¶∞‡¶£ ‡¶§‡¶•‡ßç‡¶Ø
              </h3>
              <div class="info-item">
                <strong>‡¶∏‡¶Ç‡¶∏‡ßç‡¶ï‡¶∞‡¶£:</strong> <span id="system-version">v4.2.0</span>
              </div>
              <div class="info-item">
                <strong>‡¶∂‡ßá‡¶∑ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü:</strong> <span id="last-update-date">‡ß®‡ß™ ‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á ‡ß®‡ß¶‡ß®‡ß´</span>
              </div>
              <div class="info-item">
                <strong>‡¶¨‡¶ø‡¶≤‡ßç‡¶°:</strong> <span>Stable Release</span>
              </div>
              <div class="info-item" style="margin-top: 15px;">
                <button class="changelog-btn" onclick="showChangeLog()"
                  style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 14px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px; width: 100%; justify-content: center;">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"
                    fill="currentColor">
                    <path
                      d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z" />
                  </svg>
                  Change Log
                </button>
              </div>
            </div>

            <div class="about-info-card">
              <h3 style="margin: 0 0 15px 0; color: var(--secondary-color); font-size: 18px;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"
                  style="vertical-align: middle; margin-right: 8px;">
                  <path
                    d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" />
                </svg>
                ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó
              </h3>
              <div class="info-item">
                <strong>‡¶á‡¶Æ‡ßá‡¶á‡¶≤:</strong> <span>engr.mdbelal@gmail.com</span>
              </div>
              <div class="info-item">
                <strong>‡¶´‡ßã‡¶®:</strong> <span>‡ß¶‡ßß‡ß¨‡ß©‡ß©‡ß©‡ß¨‡ß´‡ß™‡ß©‡ß≠</span>
              </div>
              <div class="info-item">
                <strong>‡¶ì‡¶Ø‡¶º‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü:</strong> <span>www.abidnetwork.com</span>
              </div>
            </div>

            <div class="about-info-card">
              <h3 style="margin: 0 0 15px 0; color: var(--secondary-color); font-size: 18px;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"
                  style="vertical-align: middle; margin-right: 8px;">
                  <path
                    d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
                </svg>
                ‡¶°‡ßá‡¶≠‡¶≤‡¶™‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ü‡¶ø‡¶Æ
              </h3>
              <div class="info-item">
                <strong>‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶°‡ßá‡¶≠‡¶≤‡¶™‡¶æ‡¶∞:</strong> <span>Abid Network Team</span>
              </div>
              <div class="info-item">
                <strong>‡¶™‡ßç‡¶∞‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø:</strong> <span>HTML5, CSS3, JavaScript</span>
              </div>
              <div class="info-item">
                <strong>‡¶≤‡¶æ‡¶á‡¶∏‡ßá‡¶®‡ßç‡¶∏:</strong> <span>Proprietary Software</span>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <h2 style="display: flex; align-items: center; justify-content: space-between;">
            <span>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ó‡¶æ‡¶á‡¶°</span>
            <button class="btn btn-submit" id="user-guide-btn" style="font-size: 14px; padding: 8px 16px;">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor"
                style="vertical-align: middle; margin-right: 5px;">
                <path
                  d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" />
              </svg>
              ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ó‡¶æ‡¶á‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
            </button>
          </h2>

          <div id="user-guide-container" style="display: none;">
            <div class="user-guide-section">
              <div class="guide-header" onclick="toggleGuideSection('dashboard-guide')">
                <span>
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor"
                    style="vertical-align: middle; margin-right: 8px;">
                    <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z" />
                  </svg>
                  ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°
                </span>
                <span class="expand-icon">‚ñº</span>
              </div>
              <div class="guide-content" id="dashboard-guide">
                <h4>‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø:</h4>
                <p>‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡ßá‡¶∞ ‡¶∏‡¶æ‡¶Æ‡¶ó‡ßç‡¶∞‡¶ø‡¶ï ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ ‡¶è‡¶ï ‡¶®‡¶ú‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡•§</p>

                <h4>‡¶´‡¶ø‡¶ö‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßÇ‡¶π:</h4>
                <ul>
                  <li><strong>‡¶Æ‡ßã‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï:</strong> ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡ßá ‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶ø‡¶§ ‡¶∏‡¶ï‡¶≤ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ</li>
                  <li><strong>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶≤:</strong> ‡¶ö‡¶≤‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</li>
                  <li><strong>‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º:</strong> ‡¶ö‡¶≤‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏‡ßá ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§ ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</li>
                  <li><strong>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ:</strong> ‡¶ö‡¶≤‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶Ö‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§ ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</li>
                </ul>

                <h4>‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞:</h4>
                <p>‡¶≤‡¶ó‡¶á‡¶®‡ßá‡¶∞ ‡¶™‡¶∞ ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡•§ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶ö‡¶≤‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶§‡¶•‡ßç‡¶Ø ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá
                  ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º‡•§</p>
              </div>
            </div>

            <div class="user-guide-section">
              <div class="guide-header" onclick="toggleGuideSection('add-customer-guide')">
                <span>
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor"
                    style="vertical-align: middle; margin-right: 8px;">
                    <path
                      d="M8 12a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0 2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zm0 3c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4zm10-9V7h-2v3h-3v2h3v3h2v-3h3v-2h-3z" />
                  </svg>
                  ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Ø‡ßã‡¶ó
                </span>
                <span class="expand-icon">‚ñº</span>
              </div>
              <div class="guide-content" id="add-customer-guide">
                <h4>‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø:</h4>
                <p>‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡•§</p>

                <h4>‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßÄ‡¶Ø‡¶º ‡¶§‡¶•‡ßç‡¶Ø:</h4>
                <ul>
                  <li><strong>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ:</strong> ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡¶æ‡¶Æ (‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï)</li>
                  <li><strong>‡¶¨‡¶æ‡¶°‡¶º‡¶ø:</strong> ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® (‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï)</li>
                  <li><strong>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶¨‡¶ø‡¶≤:</strong> ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¨‡¶ø‡¶≤ ‡¶¨‡¶æ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï)</li>
                  <li><strong>‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</strong> ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ (‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï)</li>
                </ul>

                <h4>‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø:</h4>
                <ul>
                  <li><strong>‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</strong> ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø</li>
                  <li><strong>MAC ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏:</strong> ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶∂‡¶®‡¶æ‡¶ï‡ßç‡¶§‡¶ï‡¶∞‡¶£‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø</li>
                  <li><strong>‡¶´‡ßç‡¶∞‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞:</strong> ‡¶¨‡¶ø‡¶®‡¶æ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø‡ßá ‡¶∏‡ßá‡¶¨‡¶æ ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø</li>
                </ul>

                <h4>‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞:</h4>
                <p><strong>MAC ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü:</strong> ‡ß¨‡¶ü‡¶ø ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶´‡¶ø‡¶≤‡ßç‡¶°‡ßá MAC ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§ ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ
                  ‡¶´‡¶ø‡¶≤‡ßç‡¶°‡ßá ‡¶ö‡¶≤‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§</p>
              </div>
            </div>

            <div class="user-guide-section">
              <div class="guide-header" onclick="toggleGuideSection('customer-list-guide')">
                <span>
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor"
                    style="vertical-align: middle; margin-right: 8px;">
                    <path
                      d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
                  </svg>
                  ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ
                </span>
                <span class="expand-icon">‚ñº</span>
              </div>
              <div class="guide-content" id="customer-list-guide">
                <h4>‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø:</h4>
                <p>‡¶∏‡¶ï‡¶≤ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ, ‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú ‡¶ï‡¶∞‡¶æ‡•§</p>

                <h4>‡¶´‡¶ø‡¶ö‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßÇ‡¶π:</h4>
                <ul>
                  <li><strong>‡¶¨‡¶æ‡¶°‡¶º‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™‡¶ø‡¶Ç:</strong> ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤‡ßá</li>
                  <li><strong>‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®:</strong> ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ</li>
                  <li><strong>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶¶‡ßá‡¶ñ‡¶æ:</strong> Paid, Unpaid, Advance, Free</li>
                  <li><strong>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤:</strong> ‡¶®‡¶æ‡¶Æ‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¶‡ßá‡¶ñ‡¶æ</li>
                </ul>

                <h4>‡¶è‡¶ï‡¶∂‡¶® ‡¶¨‡¶æ‡¶ü‡¶®:</h4>
                <ul>
                  <li><strong>Edit:</strong> ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</li>
                  <li><strong>Del:</strong> ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ (‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá)</li>
                </ul>

                <h4>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶¨‡¶∞‡ßç‡¶£‡¶®‡¶æ:</h4>
                <ul>
                  <li><strong>Paid (‡¶∏‡¶¨‡ßÅ‡¶ú):</strong> ‡¶ö‡¶≤‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶¨‡¶ø‡¶≤ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§</li>
                  <li><strong>Unpaid (‡¶ï‡¶Æ‡¶≤‡¶æ):</strong> ‡¶¨‡¶ø‡¶≤ ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ ‡¶∞‡¶Ø‡¶º‡ßá‡¶õ‡ßá</li>
                  <li><strong>Advance (‡¶®‡ßÄ‡¶≤):</strong> ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡¶Ø‡¶º‡ßá‡¶õ‡ßá</li>
                  <li><strong>Free (‡¶ü‡¶ø‡¶≤):</strong> ‡¶¨‡¶ø‡¶®‡¶æ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø‡ßá ‡¶∏‡ßá‡¶¨‡¶æ</li>
                </ul>
              </div>
            </div>

            <div class="user-guide-section">
              <div class="guide-header" onclick="toggleGuideSection('billing-guide')">
                <span>
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor"
                    style="vertical-align: middle; margin-right: 8px;">
                    <path
                      d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z" />
                  </svg>
                  ‡¶¨‡¶ø‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ
                </span>
                <span class="expand-icon">‚ñº</span>
              </div>
              <div class="guide-content" id="billing-guide">
                <h4>‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø:</h4>
                <p>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶¨‡¶ø‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø, ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ú‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡•§</p>

                <h4>‡¶¨‡¶ø‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ:</h4>
                <ol>
                  <li>‡¶Æ‡¶æ‡¶∏ ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶õ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                  <li>‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶¨‡¶æ ‡¶∏‡¶ï‡¶≤ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                  <li>"‡¶¨‡¶ø‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®" ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                  <li>‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá</li>
                </ol>

                <h4>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü:</h4>
                <ul>
                  <li><strong>Paid/Unpaid ‡¶¨‡¶æ‡¶ü‡¶®:</strong> ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ü‡¶ó‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                  <li><strong>Adjust ‡¶¨‡¶æ‡¶ü‡¶®:</strong> ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ ‡¶¨‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                  <li><strong>Del ‡¶¨‡¶æ‡¶ü‡¶®:</strong> ‡¶¨‡¶ø‡¶≤ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®</li>
                </ul>

                <h4>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ú‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ:</h4>
                <ul>
                  <li><strong>‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ ‡¶Ø‡ßã‡¶ó:</strong> ‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡¶æ ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ</li>
                  <li><strong>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶ú‡¶Æ‡¶æ:</strong> ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶°</li>
                  <li><strong>‡¶®‡ßã‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ:</strong> ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶â‡¶≤‡ßç‡¶≤‡ßá‡¶ñ ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                </ul>

                <h4>‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶®:</h4>
                <ul>
                  <li><strong>‡¶∏‡¶ï‡¶≤ ‡¶¨‡¶ø‡¶≤:</strong> ‡¶∏‡¶¨ ‡¶¨‡¶ø‡¶≤ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</li>
                  <li><strong>‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ:</strong> ‡¶Ö‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§ ‡¶¨‡¶ø‡¶≤ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</li>
                </ul>
              </div>
            </div>

            <div class="user-guide-section">
              <div class="guide-header" onclick="toggleGuideSection('isp-bill-guide')">
                <span>
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor"
                    style="vertical-align: middle; margin-right: 8px;">
                    <path
                      d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9V8h2v8zm4 0h-2V8h2v8z" />
                  </svg>
                  ‡¶Ü‡¶á‡¶è‡¶∏‡¶™‡¶ø ‡¶¨‡¶ø‡¶≤
                </span>
                <span class="expand-icon">‚ñº</span>
              </div>
              <div class="guide-content" id="isp-bill-guide">
                <h4>‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø:</h4>
                <p>‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡ßá‡¶¨‡¶æ ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶®‡¶ï‡¶æ‡¶∞‡ßÄ (ISP) ‡¶ï‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶∞‡¶æ‡¶ñ‡¶æ‡•§</p>

                <h4>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ:</h4>
                <ol>
                  <li>‡¶Æ‡¶æ‡¶∏ ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶õ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                  <li>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡ßØ‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ)</li>
                  <li>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                  <li>"‡¶¨‡¶ø‡¶≤ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®" ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                </ol>

                <h4>‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶¨‡ßà‡¶∂‡¶ø‡¶∑‡ßç‡¶ü‡ßç‡¶Ø:</h4>
                <ul>
                  <li><strong>‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∞‡ßã‡¶ß:</strong> ‡¶è‡¶ï‡¶á ‡¶Æ‡¶æ‡¶∏‡ßá ‡¶¶‡ßÅ‡¶á‡¶¨‡¶æ‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ</li>
                  <li><strong>‡¶è‡¶°‡¶ø‡¶ü ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ:</strong> ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶Ç‡¶∂‡ßã‡¶ß‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá</li>
                  <li><strong>‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç:</strong> ‡¶∏‡¶ï‡¶≤ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶°</li>
                </ul>

                <h4>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø:</h4>
                <ul>
                  <li>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</li>
                  <li>Edit ‡¶è‡¶¨‡¶Ç Delete ‡¶Ö‡¶™‡¶∂‡¶®</li>
                  <li>‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ‡¶∞ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ</li>
                </ul>
              </div>
            </div>

            <div class="user-guide-section">
              <div class="guide-header" onclick="toggleGuideSection('reports-guide')">
                <span>
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor"
                    style="vertical-align: middle; margin-right: 8px;">
                    <path
                      d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" />
                  </svg>
                  ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü
                </span>
                <span class="expand-icon">‚ñº</span>
              </div>
              <div class="guide-content" id="reports-guide">
                <h4>‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø:</h4>
                <p>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶Ü‡¶∞‡ßç‡¶•‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ‡•§</p>

                <h4>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü:</h4>
                <ul>
                  <li><strong>‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º:</strong> ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§ ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</li>
                  <li><strong>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ:</strong> ‡¶Ö‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§ ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</li>
                  <li><strong>‡¶Ü‡¶á‡¶è‡¶∏‡¶™‡¶ø ‡¶¨‡¶ø‡¶≤:</strong> ISP ‡¶ï‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü</li>
                  <li><strong>‡¶®‡¶ø‡¶ü ‡¶Ü‡¶Ø‡¶º:</strong> ‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º - ‡¶Ü‡¶á‡¶è‡¶∏‡¶™‡¶ø ‡¶¨‡¶ø‡¶≤</li>
                </ul>

                <h4>‡¶¨‡¶æ‡¶°‡¶º‡¶ø-‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü:</h4>
                <p>‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶Ü‡¶Ø‡¶º‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡•§</p>

                <h4>PDF ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü:</h4>
                <ul>
                  <li>‡¶™‡ßç‡¶∞‡ßã‡¶´‡ßá‡¶∂‡¶®‡¶æ‡¶≤ ‡¶≤‡ßá‡¶Ü‡¶â‡¶ü</li>
                  <li>‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø ‡¶¨‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶ø‡¶Ç</li>
                  <li>‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü-‡¶Ö‡¶™‡ßç‡¶ü‡¶ø‡¶Æ‡¶æ‡¶á‡¶ú‡¶° ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®</li>
                </ul>

                <h4>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶¨‡¶ø‡¶≤‡¶ø‡¶Ç ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø:</h4>
                <ul>
                  <li>‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶¨‡¶ø‡¶≤‡¶ø‡¶Ç ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</li>
                  <li>PDF ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ</li>
                  <li>‡¶Æ‡¶æ‡¶∏ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã ‡¶§‡¶•‡ßç‡¶Ø</li>
                </ul>
              </div>
            </div>

            <div class="user-guide-section">
              <div class="guide-header" onclick="toggleGuideSection('router-guide')">
                <span>
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor"
                    style="vertical-align: middle; margin-right: 8px;">
                    <path
                      d="M12.01 21.49L23.64 7c-.45-.34-4.93-4-11.64-4C5.28 3 .81 6.66.36 7l11.63 14.49.01.01.01-.01z" />
                  </svg>
                  ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü
                </span>
                <span class="expand-icon">‚ñº</span>
              </div>
              <div class="guide-content" id="router-guide">
                <h4>‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø:</h4>
                <p>‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú ‡¶ï‡¶∞‡¶æ‡•§</p>

                <h4>‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø:</h4>
                <ul>
                  <li><strong>‡¶®‡¶æ‡¶Æ:</strong> ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶ö‡¶ø‡¶§‡¶ø‡¶Æ‡ßÇ‡¶≤‡¶ï ‡¶®‡¶æ‡¶Æ</li>
                  <li><strong>‡¶Æ‡¶°‡ßá‡¶≤:</strong> ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Æ‡¶°‡ßá‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</li>
                  <li><strong>IP ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏:</strong> ‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï IP</li>
                  <li><strong>MAC ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏:</strong> ‡¶π‡¶æ‡¶∞‡ßç‡¶°‡¶ì‡¶Ø‡¶º‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</li>
                  <li><strong>‡¶¶‡ßÇ‡¶∞‡¶§‡ßç‡¶¨:</strong> ‡¶Æ‡ßá‡¶á‡¶® ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶¶‡ßÇ‡¶∞‡¶§‡ßç‡¶¨</li>
                  <li><strong>‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡ßç‡¶™‡ßá‡¶ï:</strong> ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡ßÅ‡ßé ‡¶∏‡¶∞‡¶¨‡¶∞‡¶æ‡¶π‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø</li>
                  <li><strong>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°:</strong> ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</li>
                  <li><strong>‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®:</strong> ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶®</li>
                </ul>

                <h4>‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞:</h4>
                <ul>
                  <li><strong>‡¶¶‡ßÇ‡¶∞‡¶§‡ßç‡¶¨ ‡¶ï‡¶®‡¶≠‡¶æ‡¶∞‡ßç‡¶ü‡¶æ‡¶∞:</strong> ‡¶´‡¶ø‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞‡ßá ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞</li>
                  <li><strong>‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶°:</strong> ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</li>
                  <li><strong>‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏:</strong> IP ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏</li>
                  <li><strong>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü:</strong> ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ</li>
                </ul>

                <h4>‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü:</h4>
                <ul>
                  <li>‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</li>
                  <li>Edit ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶∂‡ßã‡¶ß‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                  <li>Delete ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</li>
                </ul>
              </div>
            </div>

            <div class="user-guide-section">
              <div class="guide-header" onclick="toggleGuideSection('settings-guide')">
                <span>
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor"
                    style="vertical-align: middle; margin-right: 8px;">
                    <path
                      d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17-.59-1.69-.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69-.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23-.09.49 0 .61.22l2-3.46c.12-.22.07.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z" />
                  </svg>
                  ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏
                </span>
                <span class="expand-icon">‚ñº</span>
              </div>
              <div class="guide-content" id="settings-guide">
                <h4>‡¶ì‡¶Ø‡¶º‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶®:</h4>
                <ul>
                  <li><strong>‡¶®‡¶æ‡¶Æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®:</strong> ‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                  <li><strong>‡¶≤‡ßã‡¶ó‡ßã ‡¶Ü‡¶™‡¶≤‡ßã‡¶°:</strong> ‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø‡¶∞ ‡¶≤‡ßã‡¶ó‡ßã ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® (‡ß™‡ß¶x‡ß™‡ß¶ ‡¶™‡¶ø‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶∏‡ßÅ‡¶™‡¶æ‡¶∞‡¶ø‡¶∂)</li>
                  <li><strong>‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü:</strong> ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá</li>
                </ul>

                <h4>‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü:</h4>
                <ul>
                  <li><strong>‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®:</strong> ‡¶¨‡¶æ‡¶°‡¶º‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                  <li><strong>‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶è‡¶°‡¶ø‡¶ü:</strong> ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® ‡¶®‡¶æ‡¶Æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                  <li><strong>‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü:</strong> ‡¶Ö‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡ßÉ‡¶§ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</li>
                  <li><strong>‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶æ:</strong> ‡¶Æ‡ßÇ‡¶≤ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Æ‡ßÅ‡¶õ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ</li>
                </ul>

                <h4>‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü:</h4>
                <ul>
                  <li><strong>‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü:</strong> ‡¶∏‡¶ï‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ JSON ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü‡ßá ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</li>
                  <li><strong>‡¶á‡¶Æ‡¶™‡ßã‡¶∞‡ßç‡¶ü:</strong> ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡ßÅ‡¶®‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡¶æ‡¶∞</li>
                  <li><strong>‡¶∞‡¶ø‡¶∏‡ßá‡¶ü:</strong> ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü (‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá)</li>
                </ul>

                <h4>‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶ü‡¶ø‡¶™‡¶∏:</h4>
                <ul>
                  <li>‡¶®‡¶ø‡¶Ø‡¶º‡¶Æ‡¶ø‡¶§ ‡¶°‡ßá‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶®‡¶ø‡¶®</li>
                  <li>‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡ßá‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                  <li>‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶¶‡ßÅ‡¶á‡¶¨‡¶æ‡¶∞ ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
    <footer class="footer">
      Copyright &copy; <span id="footer-year"></span> Abid Network. All Rights Reserved.
    </footer>
  </div>
  <div class="modal" id="adjustmentModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="adjustment-form-title">‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ú‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
        <button class="modal-close" id="adjustment-modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <p><strong>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï:</strong> <span id="modal-customer-name-adj"></span></p>
        <form id="adjustmentForm">
          <input type="hidden" id="adjustmentBillId">
          <input type="hidden" id="adjustmentId">
          <div class="form-group">
            <label for="adjustmentAmount">‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</label>
            <input type="number" id="adjustmentAmount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" required>
          </div>
          <div class="form-group">
            <label for="adjustmentType">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶ß‡¶∞‡¶®</label>
            <select id="adjustmentType">
              <option value="due">‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó</option>
              <option value="advance">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ</option>
            </select>
          </div>
          <div class="form-group">
            <label for="adjustmentNotes">‡¶®‡ßã‡¶ü</label>
            <input type="text" id="adjustmentNotes" placeholder="‡¶®‡ßã‡¶ü ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® ‡¶¨‡¶æ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶ó ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®">
            <div class="note-tags">
              <span class="note-tag" data-note="‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ">‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ</span>
              <span class="note-tag" data-note="‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü</span>
            </div>
          </div>
          <div style="text-align: right; margin-top: 20px;">
            <button type="button" class="btn btn-delete" id="adjustment-cancel-btn"
              style="display: none; margin-right: 10px;">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
            <button type="submit" class="btn btn-submit" id="adjustment-submit-btn">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
          </div>
        </form>
        <hr style="margin: 20px 0;">
        <h3>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ú‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h3>
        <ul class="adjustment-list" id="adjustment-list"></ul>
      </div>
    </div>
  </div>
  <div class="modal" id="ispEditModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>‡¶Ü‡¶á‡¶è‡¶∏‡¶™‡¶ø ‡¶¨‡¶ø‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
        <button class="modal-close" id="isp-edit-modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="ispEditForm">
          <input type="hidden" id="ispEditId">
          <div class="form-group">
            <label for="ispEditMonth">‡¶Æ‡¶æ‡¶∏</label>
            <select id="ispEditMonth"></select>
          </div>
          <div class="form-group">
            <label for="ispEditYear">‡¶¨‡¶õ‡¶∞</label>
            <select id="ispEditYear"></select>
          </div>
          <div class="form-group">
            <label for="ispEditAmount">‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</label>
            <input type="number" id="ispEditAmount" required>
          </div>
      </div>
      <div class="form-group">
        <label for="ispEditPayDate">‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
        <input type="date" id="ispEditPayDate" required>
      </div>
      <div style="text-align: right; margin-top: 20px;">
        <button type="submit" class="btn btn-submit">‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      </div>
      </form>
    </div>
  </div>
  </div>
  <div class="router-modal-overlay" id="routerModal">
    <div class="router-modal-content">
      <div class="router-modal-header">
        <h2 id="modal-title"></h2><button class="router-modal-close" id="routerModalCloseBtn">&times;</button>
      </div>
      <div class="router-modal-body">
        <div id="modal-router-image-container" style="text-align: center; margin-bottom: 15px; display: none;">
          <img id="modal-router-image"
            style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 1px solid #E2E8F0;"
            alt="‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø">
        </div>
        <p><strong>‡¶Æ‡¶°‡ßá‡¶≤:</strong> <span id="modal-model"></span></p>
        <p><strong>‡¶Ü‡¶á‡¶™‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏:</strong> <span id="modal-ip"></span></p>
        <p><strong>‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ï ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏:</strong> <span id="modal-mac-address"></span></p>
        <p><strong>‡¶¶‡ßÇ‡¶∞‡¶§‡ßç‡¶¨:</strong> <span id="modal-distance"></span> ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞</p>
        <p><strong>‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡ßç‡¶™‡ßá‡¶∏‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®:</strong> <span id="modal-power-spec"></span></p>
        <p><strong>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°:</strong> <span id="modal-password"></span></p>
        <p><strong>‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®:</strong> <span id="modal-location"></span></p>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
          <a href="#" id="modal-access-link" class="access-btn" target="_blank" style="flex: 1;">‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏
            ‡¶ï‡¶∞‡ßÅ‡¶®</a>
          <button id="modal-edit-router-btn" class="btn btn-submit"
            style="display: block; margin-top: 25px; padding: 12px; background-color: var(--secondary-color); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; text-align: center; transition: background-color 0.2s; border: none; box-sizing: content-box; width: auto; min-width: 60px;">Edit</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal" id="locationEditModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
        <button class="modal-close" id="location-edit-modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="locationEditForm">
          <input type="hidden" id="locationEditOldName">
          <div class="form-group">
            <label for="locationEditNewName">‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡¶æ‡¶Æ</label>
            <input type="text" id="locationEditNewName" required>
          </div>
          <div style="text-align: right; margin-top: 20px;">
            <button type="submit" class="btn btn-submit">‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <!-- Customer Profile Modal (UPDATED for v4.1) -->
  <div class="modal" id="customerProfileModal">
    <div class="modal-content profile-window">
      <div class="profile-header">
        <h2 id="profile-customer-name"></h2>
        <div id="profile-action-buttons" style="margin-top: 10px;"></div>
      </div>

      <div class="profile-info-grid">
        <div class="profile-info-item"><strong><span class="icon">üìû</span> ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</strong><span
            id="profile-phone"></span></div>
        <div class="profile-info-item"><strong><span class="icon">üè†</span> ‡¶¨‡¶æ‡ßú‡¶ø</strong><span
            id="profile-house"></span></div>
        <div class="profile-info-item"><strong><span class="icon">üí∞</span> ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶¨‡¶ø‡¶≤</strong><span
            id="profile-bill"></span></div>
        <div class="profile-info-item"><strong><span class="icon">üìÖ</span> ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</strong><span
            id="profile-connection-date"></span></div>
        <div class="profile-info-item full-width-item"><strong><span class="icon">üíª</span> MAC Address</strong><span
            id="profile-mac"></span></div>
        <div class="profile-info-item full-width-item" id="profile-status-container">
          <strong><span id="profile-status-icon" class="icon"></span> ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</strong>
          <span id="profile-status-text"></span>
        </div>
      </div>

      <div class="billing-history-section">
        <h3><span class="icon">üìú</span> ‡¶¨‡¶ø‡¶≤‡¶ø‡¶Ç ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h3>
        <ul class="billing-history-list" id="profile-billing-history">
        </ul>
      </div>

      <button class="modal-close" id="customer-profile-modal-close"
        style="position: absolute; top: 15px; right: 15px; font-size: 24px; background: none; border: none; cursor: pointer;">&times;</button>
    </div>
  </div>

  <script>
    function toBengaliNumber(engNumber) {
      if (engNumber === null || engNumber === undefined) return '';
      const engStr = String(engNumber);
      const bengaliDigits = ['‡ß¶', '‡ßß', '‡ß®', '‡ß©', '‡ß™', '‡ß´', '‡ß¨', '‡ß≠', '‡ßÆ', '‡ßØ'];
      let bengaliStr = '';
      for (let i = 0; i < engStr.length; i++) {
        const char = engStr[i];
        if (char >= '0' && char <= '9') {
          bengaliStr += bengaliDigits[parseInt(char)];
        } else {
          bengaliStr += char;
        }
      }
      return bengaliStr;
    }

    async function saveDb() {
    try {
        // ‡¶è‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶è‡¶ñ‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá ‡¶®‡¶æ‡•§
        // ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ Firebase-‡¶è ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶¨‡•§
        console.log("‡¶°‡ßá‡¶ü‡¶æ ‡¶è‡¶ñ‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø Firebase-‡¶è ‡¶∏‡ßá‡¶≠ ‡¶π‡¶¨‡ßá‡•§");
    } catch (error) {
        console.error("Firebase-‡¶è ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá:", error);
    }
}


    // Global variable to track which bill the payment modal is opened for
    let currentPaymentBillId = null;

    // Global database variable
    let db = {
      customers: [],
      bills: [],
      ispPayments: [],
      routers: [],
      locations: []
    };
    // Global database variable
    // ‡¶®‡¶§‡ßÅ‡¶® ‡¶≠‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤ ‡¶∂‡ßÅ‡¶∞‡ßÅ
    let displayedActivitiesCount = 0;
    const ACTIVITIES_PER_PAGE = 10; // ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¨‡¶æ‡¶∞ ‡ßß‡ß¶‡¶ü‡¶ø ‡¶ï‡¶∞‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá
    // ‡¶®‡¶§‡ßÅ‡¶® ‡¶≠‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤ ‡¶∂‡ßá‡¶∑

    /**
     * ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶∞‡¶æ‡¶ñ‡ßá ‡¶è‡¶¨‡¶Ç ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßá‡•§
     * @param {string} billId - ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø‡•§
     * @param {number} receivedAmount - ‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§ ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£‡•§
     */
    // ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø logPayment ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡ßá‡¶∞ ‡¶†‡¶ø‡¶ï ‡¶â‡¶™‡¶∞‡ßá ‡¶¨‡¶∏‡¶¨‡ßá

    document.addEventListener('DOMContentLoaded', () => {
      setupMacInput('customerMacContainer');
      setupMacInput('routerMacContainer');
      updateLastExportDate();
      let customerToEditId = null;
      const DATABASE_KEY = 'abidNetworkDb_v41'; // Version updated to 4.1
      const LAST_PAGE_KEY = 'abidNetworkLastPage';

      const defaultLocations = [
        '‡¶¨‡¶æ‡ßú‡¶ø‡ßß‡¶É ‡¶Æ‡ßá‡¶á‡¶® ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞', '‡¶¨‡¶æ‡ßú‡¶ø‡ß®‡¶É ‡¶¨‡ßã‡¶∞‡¶π‡¶æ‡¶®‡ßá‡¶∞ ‡¶¨‡¶æ‡¶∏‡¶æ', '‡¶¨‡¶æ‡ßú‡¶ø‡ß©‡¶É ‡¶ü‡¶ø‡¶®‡¶∂‡ßá‡¶°',
        '‡¶¨‡¶æ‡ßú‡¶ø‡ß™‡¶É ‡¶™‡¶ø‡¶õ‡¶®‡ßá‡¶∞ ‡¶¨‡¶æ‡¶∏‡¶æ', '‡¶¨‡¶æ‡ßú‡¶ø‡ß´‡¶É ‡¶ó‡ßã‡¶≤‡¶æ‡¶™‡ßá‡¶∞ ‡¶¨‡¶æ‡¶∏‡¶æ'
      ];
      const defaultBillAmounts = [150, 170, 'other'];
      const months = ['‡¶ú‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶∞‡¶ø', '‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡ßü‡¶æ‡¶∞‡¶ø', '‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö', '‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤', '‡¶Æ‡ßá', '‡¶ú‡ßÅ‡¶®', '‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á', '‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü', '‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞',
        '‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞', '‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞', '‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞'
      ];
      const years = Array.from({
        length: 10
      }, (_, i) => new Date().getFullYear() - 5 + i);

      // Load data from localStorage and update global db
      const localDb = JSON.parse(localStorage.getItem(DATABASE_KEY)) || {
        customers: [],
        bills: [],
        ispPayments: [],
        routers: [],
        locations: defaultLocations.slice()
      };

      // Update global db with loaded data
      db.customers = localDb.customers;
      db.bills = localDb.bills;
      db.ispPayments = localDb.ispPayments;
      db.routers = localDb.routers;
      db.locations = localDb.locations;

      function toBengaliNumber(engNumber) {
        if (engNumber === null || engNumber === undefined) return '';
        const engStr = String(engNumber);
        const bengaliDigits = ['‡ß¶', '‡ßß', '‡ß®', '‡ß©', '‡ß™', '‡ß´', '‡ß¨', '‡ß≠', '‡ßÆ', '‡ßØ'];
        let bengaliStr = '';
        for (let i = 0; i < engStr.length; i++) {
          const char = engStr[i];
          if (char >= '0' && char <= '9') {
            bengaliStr += bengaliDigits[parseInt(char)];
          } else {
            bengaliStr += char;
          }
        }
        return bengaliStr;
      }

      function migrateDb(data) {
        // This function can be expanded for future migrations
        if (!data.routers) data.routers = [];
        if (!data.locations || data.locations.length === 0) {
          data.locations = [...defaultLocations];
        }

        if (data.customers) {
          data.customers.forEach(c => {
            if (c.macAddress && Array.isArray(c.macAddress)) {
              c.macAddress = c.macAddress.join(':');
            }
            if (c.advanceBalance === undefined) {
              c.advanceBalance = 0;
            }
          });
        }

        if (data.bills) {
          data.bills.forEach(b => {
            // ‡¶Ø‡¶¶‡¶ø ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶π‡ßü ‡¶è‡¶¨‡¶Ç ‡¶è‡¶á ‡¶§‡¶•‡ßç‡¶Ø‡¶ó‡ßÅ‡¶≤‡ßã ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá
            if (b.status === undefined) {
              b.status = b.isPaid ? 'paid' : 'unpaid';
            }
            if (b.paidAmount === undefined) {
              b.paidAmount = b.isPaid ? b.totalAmount : 0;
            }
            if (b.remainingDue === undefined) {
              b.remainingDue = b.isPaid ? 0 : b.totalAmount;
            }
            if (b.paymentHistory === undefined) {
              b.paymentHistory = [];
            }
            if (b.adjustments === undefined) {
              b.adjustments = [];
            }
            if (b.advanceUsed === undefined) {
              b.advanceUsed = 0;
            }
          });
        }

        return data;
      }

      // Activity Management System
      const ACTIVITY_STORAGE_KEY = 'abidNetworkActivities_v1';
      const MAX_ACTIVITIES = 50;

      // Activity types and their configurations
      const ACTIVITY_TYPES = {
        'customer_added': {
          title: '‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Ø‡ßã‡¶ó',
          icon: 'üë§',
          className: 'customer-added'
        },
        'customer_deleted': {
          title: '‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ',
          icon: 'üóëÔ∏è',
          className: 'customer-deleted'
        },
        'bill_created': {
          title: '‡¶¨‡¶ø‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø',
          icon: 'üìÑ',
          className: 'bill-created'
        },
        'bill_deleted': {
          title: '‡¶¨‡¶ø‡¶≤ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ',
          icon: 'üóëÔ∏è',
          className: 'bill-deleted'
        },
        'bill_paid': {
          title: '‡¶¨‡¶ø‡¶≤ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß',
          icon: 'üí∞',
          className: 'bill-paid'
        },
        'bill_status_paid': {
          title: '‡¶¨‡¶ø‡¶≤ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§',
          icon: '‚úÖ',
          className: 'bill-paid'
        },
        'payment_history': {
          title: '‡¶Ü‡¶Ç‡¶∂‡¶ø‡¶ï ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü',
          icon: 'üí≥',
          className: 'payment-history'
        },
        'isp_payment': {
          title: '‡¶Ü‡¶á‡¶è‡¶∏‡¶™‡¶ø ‡¶¨‡¶ø‡¶≤ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß',
          icon: 'üåê',
          className: 'isp-payment'
        },
        'isp_payment_deleted': {
          title: '‡¶Ü‡¶á‡¶è‡¶∏‡¶™‡¶ø ‡¶¨‡¶ø‡¶≤ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ',
          icon: 'üóëÔ∏è',
          className: 'isp-payment-deleted'
        },
        'router_added': {
          title: '‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó',
          icon: 'üì°',
          className: 'router-added'
        },
        'router_deleted': {
          title: '‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ',
          icon: 'üóëÔ∏è',
          className: 'router-deleted'
        },
        'advance_deposit': {
          title: '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶ú‡¶Æ‡¶æ',
          icon: 'üí≥',
          className: 'advance-deposit'
        },
        'due_adjustment': {
          title: '‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ ‡¶∏‡¶Æ‡¶®‡ßç‡¶¨‡¶Ø‡¶º',
          icon: '‚ö†Ô∏è',
          className: 'due-adjustment'
        },
        'adjustment_updated': {
          title: '‡¶∏‡¶Æ‡¶®‡ßç‡¶¨‡¶Ø‡¶º ‡¶Ü‡¶™‡¶°‡ßá‡¶ü',
          icon: '‚úèÔ∏è',
          className: 'due-adjustment'
        },
        'adjustment_deleted': {
          title: '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ú‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ',
          icon: 'üóëÔ∏è',
          className: 'adjustment-deleted'
        },
        'data_import': {
          title: '‡¶°‡¶æ‡¶ü‡¶æ ‡¶á‡¶Æ‡¶™‡ßã‡¶∞‡ßç‡¶ü',
          icon: 'üì•',
          className: 'data-import'
        },
        'data_backup': {
          title: '‡¶°‡¶æ‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™',
          icon: 'üíæ',
          className: 'data-backup'
        },
        'location_added': {
          title: '‡¶¨‡¶æ‡¶°‡¶º‡¶ø ‡¶Ø‡ßã‡¶ó',
          icon: 'üè†',
          className: 'location-added'
        },
        'location_deleted': {
          title: '‡¶¨‡¶æ‡¶°‡¶º‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ',
          icon: 'üóëÔ∏è',
          className: 'location-deleted'
        },
        'month_bills_deleted': {
          title: '‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∏‡¶¨ ‡¶¨‡¶ø‡¶≤ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ',
          icon: 'üóëÔ∏è',
          className: 'month-bills-deleted'
        },
        'all_isp_history_deleted': {
          title: '‡¶∏‡¶¨ ‡¶Ü‡¶á‡¶è‡¶∏‡¶™‡¶ø ‡¶¨‡¶ø‡¶≤ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ',
          icon: 'üóëÔ∏è',
          className: 'all-isp-history-deleted'
        },
        'discount_applied': { 
          title: '‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶õ‡¶æ‡ßú',    
          icon: 'üè∑Ô∏è',
          className: 'due-adjustment'
        },
        'report_generated': {
          title: '‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø',
          icon: 'üñ®Ô∏è',
          className: 'report-generated'
        }
      };

      // Load activities from localStorage
      function loadActivities() {
        try {
          const stored = localStorage.getItem(ACTIVITY_STORAGE_KEY);
          return stored ? JSON.parse(stored) : [];
        } catch (error) {
          console.error('Error loading activities:', error);
          return [];
        }
      }

      // Save activities to localStorage
      function saveActivities(activities) {
        try {
          // Keep only the latest MAX_ACTIVITIES
          const trimmedActivities = activities.slice(0, MAX_ACTIVITIES);
          localStorage.setItem(ACTIVITY_STORAGE_KEY, JSON.stringify(trimmedActivities));
        } catch (error) {
          console.error('Error saving activities:', error);
        }
      }

      // Add new activity
      function addActivity(type, description, metadata = {}) {
        const activities = loadActivities();
        const activity = {
          id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
          type: type,
          title: ACTIVITY_TYPES[type]?.title || '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ',
          description: description,
          timestamp: new Date().toISOString(),
          metadata: metadata
        };

        activities.unshift(activity); // Add to beginning
        saveActivities(activities);

        // Update dashboard if currently visible
        if (document.getElementById('dashboard').classList.contains('active')) {
          renderRecentActivities();
        }
      }

      // Format time for display
      function formatActivityTime(timestamp) {
        const now = new Date();
        const activityTime = new Date(timestamp);
        const diffInMinutes = Math.floor((now - activityTime) / (1000 * 60));

        if (diffInMinutes < 1) return '‡¶è‡¶ñ‡¶®‡¶á';
        if (diffInMinutes < 60) return `${toBengaliNumber(diffInMinutes)} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶Ü‡¶ó‡ßá`;

        const diffInHours = Math.floor(diffInMinutes / 60);
        if (diffInHours < 24) return `${toBengaliNumber(diffInHours)} ‡¶ò‡¶®‡ßç‡¶ü‡¶æ ‡¶Ü‡¶ó‡ßá`;

        const diffInDays = Math.floor(diffInHours / 24);
        if (diffInDays < 7) return `${toBengaliNumber(diffInDays)} ‡¶¶‡¶ø‡¶® ‡¶Ü‡¶ó‡ßá`;

        // For older activities, show date
        const options = {
          day: 'numeric',
          month: 'long'
        };
        return activityTime.toLocaleDateString('bn-BD', options);
      }

      // Render recent activities

      function renderRecentActivities(loadMore = false) {
        const clearLogBtn = document.getElementById('clear-activity-log-btn');
        const allActivities = loadActivities();
        const container = document.getElementById('recent-activities');
        const noActivitiesDiv = document.getElementById('no-activities');
        const loaderDiv = document.getElementById('activity-loader');
        const loadMoreBtn = document.getElementById('load-more-activities-btn');

        if (!container) return;

        if (!loadMore) {
          // ‡¶Ø‡¶¶‡¶ø ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶π‡ßü, ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
          container.innerHTML = '';
          displayedActivitiesCount = 0;
        }

        if (allActivities.length === 0) {
          container.style.display = 'none';
          noActivitiesDiv.style.display = 'block';
          loaderDiv.style.display = 'none';
          if (clearLogBtn) clearLogBtn.style.display = 'none'; // <-- ‡¶è‡¶á ‡¶≤‡¶æ‡¶á‡¶®‡¶ü‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
          return;
        }

        // ‡¶Ø‡¶¶‡¶ø ‡¶≤‡¶ó ‡¶•‡¶æ‡¶ï‡ßá, ‡¶§‡¶¨‡ßá ‡¶¨‡¶æ‡¶ü‡¶®‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá
        if (clearLogBtn) clearLogBtn.style.display = 'inline-flex';

        container.style.display = 'grid';
        noActivitiesDiv.style.display = 'none';

        const startIndex = displayedActivitiesCount;
        const endIndex = startIndex + ACTIVITIES_PER_PAGE;
        const activitiesToRender = allActivities.slice(startIndex, endIndex);

        let newActivitiesHtml = activitiesToRender.map(activity => {
          const config = ACTIVITY_TYPES[activity.type] || ACTIVITY_TYPES['data_backup'];
          const timeStr = formatActivityTime(activity.timestamp);

          let metadataHtml = '';
          if (activity.metadata) {
            const tags = [];
            if (activity.metadata.customerName) tags.push(activity.metadata.customerName);
            if (activity.metadata.amount) tags.push(`‡ß≥${toBengaliNumber(activity.metadata.amount)}`);
            if (activity.metadata.location) tags.push(activity.metadata.location);
            if (activity.metadata.month !== undefined && activity.metadata.year !== undefined) {
              const monthName = months[activity.metadata.month];
              tags.push(`${monthName} ${toBengaliNumber(activity.metadata.year)}`);
            }

            if (tags.length > 0) {
              metadataHtml = `<div class="activity-metadata">${tags.map(tag =>
                    `<span class="activity-tag">${tag}</span>`
                ).join('')}</div>`;
            }
          }

          return `
            <div class="activity-card ${config.className}">
                <div class="activity-header">
                    <div class="activity-icon">${config.icon}</div>
                    <h3 class="activity-title">${config.title}</h3>
                    <span class="activity-time">${timeStr}</span>
                </div>
                <p class="activity-description">${activity.description}</p>
                ${metadataHtml}
            </div>
        `;
        }).join('');

        container.insertAdjacentHTML('beforeend', newActivitiesHtml);
        displayedActivitiesCount += activitiesToRender.length;

        // "‡¶Ü‡¶∞‡ßã ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®" ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ ‡¶®‡¶ø‡ßü‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£
        if (displayedActivitiesCount < allActivities.length) {
          loaderDiv.style.display = 'block';
        } else {
          loaderDiv.style.display = 'none';
        }
      }

      function saveDb() {
        localStorage.setItem(DATABASE_KEY, JSON.stringify(db));
      }

// ‡¶™‡ßÅ‡¶∞‡¶®‡ßã loadDb() ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶¨‡¶∏‡¶æ‡¶®
    async function loadDb() {
    try {
        console.log("Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...");
        
        const customersCol = collection(firestore, 'customers');
        const billsCol = collection(firestore, 'bills');
        const ispPaymentsCol = collection(firestore, 'ispPayments');
        const routersCol = collection(firestore, 'routers');
        const locationsCol = collection(firestore, 'locations');
        const activitiesCol = collection(firestore, 'activities');

        const [customerSnapshot, billSnapshot, ispPaymentSnapshot, routerSnapshot, locationSnapshot, activitySnapshot] = await Promise.all([
            getDocs(customersCol),
            getDocs(billsCol),
            getDocs(ispPaymentsCol),
            getDocs(routersCol),
            getDocs(locationsCol),
            getDocs(activitiesCol)
        ]);

        db.customers = customerSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        db.bills = billSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        db.ispPayments = ispPaymentSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        db.routers = routerSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        
        const locationsData = locationSnapshot.docs.map(doc => doc.data());
        if (locationsData.length > 0) {
            db.locations = locationsData[0].names || [];
        } else {
            db.locations = defaultLocations.slice();
        }

        const activitiesData = activitySnapshot.docs.map(doc => doc.data());
        if (activitiesData.length > 0) {
            saveActivities(activitiesData[0].log || []);
        }

        console.log("‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
        
    } catch (error) {
        console.error("Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá:", error);
        alert("‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶•‡ßá‡¶ï‡ßá ‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
    }
}


      const sidebar = document.getElementById('sidebar');
      const menuToggle = document.getElementById('menu-toggle');
      const overlay = document.getElementById('overlay');
      const pageTitle = document.getElementById('page-title');

      menuToggle.addEventListener('click', () => {
        sidebar.classList.toggle('active');
        overlay.style.display = sidebar.classList.contains('active') ? 'block' : 'none';
      });

      overlay.addEventListener('click', () => {
        sidebar.classList.remove('active');
        overlay.style.display = 'none';
      });

      function switchPage(pageId, isInitialLoad = false) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        const page = document.getElementById(pageId);
        if (page) page.classList.add('active');

        document.querySelectorAll('.menu-item').forEach(item => {
          item.classList.remove('active');
          if (item.dataset.page === pageId) {
            item.classList.add('active');
            let titleText = item.querySelector('span').textContent;
            if (pageId === 'advance') titleText = '‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü';
            pageTitle.textContent = titleText;
          }
        });

        if (!isInitialLoad) localStorage.setItem(LAST_PAGE_KEY, pageId);

        sidebar.classList.remove('active');
        overlay.style.display = 'none';

        if (pageId === 'add_customer') {
          initializeCustomerForm();

          if (customerToEditId) {
            const customer = db.customers.find(c => c.id === customerToEditId);
            if (customer) {
              customerIdInput.value = customer.id;
              customerNameInput.value = customer.name;
              customerPhoneInput.value = customer.phone;
              customerHouseInput.value = customer.house;

              if (defaultBillAmounts.includes(customer.monthlyBill)) {
                customerBillInput.value = customer.monthlyBill;
              } else {
                customerBillInput.value = 'other';
                customBillAmountInput.value = customer.monthlyBill;
              }

              connectionDateInput.value = customer.connectionDate;
              isFreeUserInput.checked = customer.isFree;

              customerFormTitle.textContent = '‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®';
              customerSubmitBtn.textContent = '‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®';
              customerCancelBtn.style.display = 'inline-block';

              customerBillInput.dispatchEvent(new Event('change'));
              isFreeUserInput.dispatchEvent(new Event('change'));
              setMacAddress('customerMacContainer', customer.macAddress);
            }
            customerToEditId = null;
          }
        }

        if (pageId === 'dashboard') renderDashboard();
        if (pageId === 'customers') renderCustomerListPage();
        if (pageId === 'billing') renderBillingPage();
        if (pageId === 'isp_bill') renderIspBillPage();
        if (pageId === 'reports') renderReportPage();
        if (pageId === 'advance') renderAdvancePage();
        if (pageId === 'settings') renderSettingsPage();
        if (pageId === 'about') renderAboutPage();
      }

      // About page functions
      function renderAboutPage() {
        // About page is static HTML, no dynamic rendering needed
        // Initialize user guide functionality
        initializeAboutPage();
      }

      function initializeAboutPage() {
        const userGuideBtn = document.getElementById('user-guide-btn');
        const userGuideContainer = document.getElementById('user-guide-container');

        if (userGuideBtn && userGuideContainer) {
          // Remove any existing event listeners to prevent duplicates
          userGuideBtn.replaceWith(userGuideBtn.cloneNode(true));
          const newUserGuideBtn = document.getElementById('user-guide-btn');

          newUserGuideBtn.addEventListener('click', function() {
            if (userGuideContainer.style.display === 'none' || userGuideContainer.style.display === '') {
              userGuideContainer.style.display = 'block';
              newUserGuideBtn.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" style="vertical-align: middle; margin-right: 5px;">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            ‡¶ó‡¶æ‡¶á‡¶° ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®
                        `;
            } else {
              userGuideContainer.style.display = 'none';
              newUserGuideBtn.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" style="vertical-align: middle; margin-right: 5px;">
                                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                            </svg>
                            ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ó‡¶æ‡¶á‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                        `;
            }
          });
        }
      }

      window.toggleGuideSection = function(sectionId) {
        const content = document.getElementById(sectionId);
        if (!content) return;

        const header = content.previousElementSibling;
        const icon = header ? header.querySelector('.expand-icon') : null;

        if (content.classList.contains('expanded')) {
          content.classList.remove('expanded');
          if (header) header.classList.remove('expanded');
          if (icon) icon.textContent = '‚ñº';
        } else {
          content.classList.add('expanded');
          if (header) header.classList.add('expanded');
          if (icon) icon.textContent = '‚ñ≤';
        }
      }

      function renderAdvancePage() {
        const routerListContainer = document.getElementById('router-list');
        const routerModal = document.getElementById('routerModal');
        const modalCloseBtn = document.getElementById('routerModalCloseBtn');
        const routerForm = document.getElementById('routerForm');
        const toggleFormBtn = document.getElementById('toggleRouterFormBtn');
        const formContainer = document.getElementById('routerFormContainer');

        function saveAndRenderRouters() {
          saveDb();
          renderRouters();
        }

        function renderRouters() {
          routerListContainer.innerHTML = '';
          const filteredRouters = db.routers;

          if (filteredRouters.length === 0) {
            routerListContainer.innerHTML =
              '<p style="text-align:center; color:#718096;">‡¶ï‡ßã‡¶®‡ßã ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§</p>';
            return;
          }
          filteredRouters.forEach(router => {
            const customerCount = db.customers.filter(c => c.house === router.location).length;
            const item = document.createElement('div');
            item.className = 'router-item';
            item.innerHTML = `
                        <div class="router-item-content" data-router-id="${router.id}">
                            <img src="https://i.ibb.co/Lz0dGqC/router-icon.png" alt="Router Icon">
                            <div class="router-info">
                                <div class="name">${router.name}</div>
                                <div class="model">${router.model}</div>
                                <div class="customer-count">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï: ${toBengaliNumber(customerCount)} ‡¶ú‡¶®</div>
                            </div>
                        </div>
                        <button class="router-delete-btn" data-router-id="${router.id}">&times;</button>
                    `;
            routerListContainer.appendChild(item);
          });
        }

        // Add feet to meters conversion
        document.getElementById('routerDistanceFeet').addEventListener('input', function() {
          const feet = parseFloat(this.value) || 0;
          const meters = (feet * 0.3048).toFixed(2);
          document.getElementById('routerDistanceMeters').value = meters;
        });

        populateDropdown('routerLocationSelect', db.locations, {
          isBengali: false
        });
        toggleFormBtn.onclick = () => {
          formContainer.classList.toggle('active');
          toggleFormBtn.textContent = formContainer.classList.contains('active') ? '‡¶´‡¶∞‡ßç‡¶Æ ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®' :
            '‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®';
        };

        // ‚òÖ‚òÖ‚òÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶ï‡ßã‡¶° (‡¶∏‡¶´‡¶≤‡¶§‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶∏‡¶π) ‚òÖ‚òÖ‚òÖ
// ‡¶™‡ßÅ‡¶∞‡¶®‡ßã routerForm.onsubmit ‡¶¨‡ßç‡¶≤‡¶ï‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶¨‡¶∏‡¶æ‡¶®
// ‡¶™‡ßÅ‡¶∞‡¶®‡ßã routerForm.onsubmit ‡¶¨‡ßç‡¶≤‡¶ï‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶†‡¶ø‡¶ï ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶¨‡¶∏‡¶æ‡¶®
routerForm.onsubmit = (e) => {
    e.preventDefault();
    const imageFile = document.getElementById('routerImage').files[0];
    let imageDataUrl = null;

    const processRouter = async () => {
        const routerId = document.getElementById('routerId').value;
        const routerData = {
            name: document.getElementById('routerName').value,
            model: document.getElementById('routerModel').value,
            ip: document.getElementById('routerIp').value,
            macAddress: getMacAddress('routerMacContainer'),
            distanceFeet: parseFloat(document.getElementById('routerDistanceFeet').value) || 0,
            distanceMeters: parseFloat(document.getElementById('routerDistanceMeters').value) || 0,
            powerSpec: document.getElementById('routerPowerSpec').value,
            password: document.getElementById('routerPassword').value,
            location: document.getElementById('routerLocationSelect').value,
            image: imageDataUrl
        };

        try {
            if (routerId) {
                // ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
                const routerRef = doc(firestore, "routers", routerId);
                // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Ø‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡¶ö‡ßç‡¶õ‡ßá, ‡¶∏‡ßá‡¶ü‡¶æ‡¶á ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá
                await updateDoc(routerRef, routerData);

                // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                const routerIndex = db.routers.findIndex(r => r.id == routerId);
                if (routerIndex > -1) {
                    // ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶°‡ßá‡¶ü‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
                    db.routers[routerIndex] = { ...db.routers[routerIndex], ...routerData };
                }
                alert(`‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ "${routerData.name}"-‡¶è‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);

            } else {
                // ‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
                const newId = Date.now().toString(); // *** ‡¶Æ‡ßÇ‡¶≤ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ***
                const newRouter = { id: newId, ...routerData };
                await setDoc(doc(firestore, "routers", newRouter.id), newRouter);
                
                // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                db.routers.push(newRouter);

                addActivity('router_added', `${routerData.name} ‡¶®‡¶æ‡¶Æ‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, {
                    routerName: routerData.name,
                    location: routerData.location,
                    model: routerData.model,
                    ip: routerData.ip
                });
                alert(`‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ "${routerData.name}" ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
            }

            // saveAndRenderRouters() ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶è‡¶ñ‡¶® ‡¶∂‡ßÅ‡¶ß‡ßÅ UI ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡¶¨‡ßá
            renderRouters(); 
            routerForm.reset();
            document.getElementById('routerId').value = '';
            formContainer.classList.remove('active');
            toggleFormBtn.textContent = '‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®';

        } catch (error) {
            console.error("Firebase-‡¶è ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶∏‡ßá‡¶≠/‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ", error);
            alert("‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§ ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§");
        }
    };

    if (imageFile) {
        const reader = new FileReader();
        reader.onload = (e) => {
            imageDataUrl = e.target.result;
            processRouter();
        };
        reader.readAsDataURL(imageFile);
    } else {
        const routerId = document.getElementById('routerId').value;
        if (routerId) {
            const existingRouter = db.routers.find(r => r.id == routerId);
            if (existingRouter) {
                imageDataUrl = existingRouter.image;
            }
        }
        processRouter();
    }
};

        // ‚òÖ‚òÖ‚òÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶ ‡¶ï‡ßã‡¶° (‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶∏‡¶π) ‚òÖ‚òÖ‚òÖ
        routerListContainer.onclick = (e) => {
          // ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®
          if (e.target.classList.contains('router-delete-btn')) {
            const routerId = e.target.dataset.routerId;
            const router = db.routers.find(r => r.id == routerId);
            if (!router) return;

            // ‚òÖ‚òÖ‚òÖ ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‚òÖ‚òÖ‚òÖ
            if (confirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá "${router.name}" ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`)) {
              const routerName = router.name;

              db.routers = db.routers.filter(r => r.id != routerId);

              addActivity('router_deleted', `‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${routerName}`, {
                routerName: routerName,
                routerId: routerId
              });

              saveAndRenderRouters();
              alert(`‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ "${routerName}" ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
            }
          }
          // ‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï
          else if (e.target.closest('.router-item-content')) {
            const routerId = e.target.closest('.router-item-content').dataset.routerId;
            const routerData = db.routers.find(r => r.id == routerId);
            if (routerData) {
              // ... (‡¶è‡¶á ‡¶Ö‡¶Ç‡¶∂‡¶ü‡¶ø ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ‡¶•‡¶æ‡¶ï‡¶¨‡ßá, ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶®‡ßá‡¶á)
              document.getElementById('modal-title').textContent = routerData.name;
              document.getElementById('modal-model').textContent = routerData.model;
              document.getElementById('modal-location').textContent = routerData.location;
              document.getElementById('modal-distance').textContent = routerData.distanceMeters || routerData
                .distance || 'N/A';
              document.getElementById('modal-ip').textContent = routerData.ip;
              document.getElementById('modal-mac-address').textContent = routerData.macAddress || 'N/A';
              document.getElementById('modal-power-spec').textContent = routerData.powerSpec || 'N/A';
              document.getElementById('modal-password').textContent = routerData.password || 'N/A';
              document.getElementById('modal-access-link').href = `http://${routerData.ip}`;

              const imageContainer = document.getElementById('modal-router-image-container');
              imageContainer.style.display = 'none';

              const editBtn = document.getElementById('modal-edit-router-btn');
              editBtn.onclick = () => {
                routerModal.classList.remove('active');
                document.getElementById('routerId').value = routerData.id;
                document.getElementById('routerName').value = routerData.name;
                document.getElementById('routerModel').value = routerData.model;
                document.getElementById('routerIp').value = routerData.ip;
                document.getElementById('routerDistanceFeet').value = routerData.distanceFeet || '';
                document.getElementById('routerDistanceMeters').value = routerData.distanceMeters || '';
                document.getElementById('routerPowerSpec').value = routerData.powerSpec || '';
                document.getElementById('routerPassword').value = routerData.password || '';
                document.getElementById('routerLocationSelect').value = routerData.location;
                setMacAddress('routerMacContainer', routerData.macAddress || '');
                formContainer.classList.add('active');
                toggleFormBtn.textContent = '‡¶´‡¶∞‡ßç‡¶Æ ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®';
                formContainer.scrollIntoView({
                  behavior: 'smooth'
                });
              };

              routerModal.classList.add('active');
            }
          }
        };

        modalCloseBtn.onclick = () => routerModal.classList.remove('active');
        routerModal.onclick = (e) => {
          if (e.target === routerModal) routerModal.classList.remove('active');
        };

        renderRouters();
      }

      document.querySelectorAll('.menu-item').forEach(item => {
        item.addEventListener('click', (e) => {
          e.preventDefault();
          switchPage(item.dataset.page);
        });
      });

      function populateDropdown(elementId, options, config = {}) {
        const {
          defaultValue,
          isBengali = true
        } = config;
        const select = document.getElementById(elementId);
        if (!select) return;
        const currentValue = select.value;
        select.innerHTML = '';
        options.forEach(opt => {
          const option = document.createElement('option');
          if (typeof opt === 'object' && opt.value !== undefined) {
            option.value = opt.value;
            option.textContent = opt.text;
          } else {
            option.value = opt;
            if (opt === 'other') {
              option.textContent = '‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø...';
            } else {
              option.textContent = isBengali ? toBengaliNumber(opt) : opt;
            }
          }
          select.appendChild(option);
        });
        if (defaultValue !== undefined) {
          select.value = defaultValue;
        } else if (currentValue) {
          select.value = currentValue;
        }
      }
      // ‚òÖ‚òÖ‚òÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ø‡¶≤ ‡¶∞‡¶ø‡¶Æ‡¶æ‡¶á‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (renderDashboard ‡¶è‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®) ‚òÖ‚òÖ‚òÖ

      function checkAndDisplayBillReminder() {
        const notificationCard = document.getElementById('bill-reminder-notification');
        const contentWrapper = document.getElementById('bill-reminder-content-wrapper');
        const viewDueBtn = document.getElementById('view-due-bills-btn');

        if (!notificationCard || !contentWrapper || !viewDueBtn) return;

        const today = new Date();
        const REMINDER_DELAY_DAYS = 10;

        const allDueBills = db.bills.filter(bill =>
          bill.status === 'unpaid' || bill.status === 'partially_paid'
        );

        const overdueBills = allDueBills.filter(bill => {
          if (!bill.createdAt) {
            // ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶¨‡¶ø‡¶≤, ‡¶Ø‡ßá‡¶ó‡ßÅ‡¶≤‡ßã‡¶§‡ßá createdAt ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶®‡ßá‡¶á, ‡¶∏‡ßá‡¶ó‡ßÅ‡¶≤‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶®‡¶ø‡ßü‡¶Æ ‡¶™‡ßç‡¶∞‡¶Ø‡ßã‡¶ú‡ßç‡¶Ø ‡¶π‡¶¨‡ßá
            return today.getDate() >= REMINDER_DELAY_DAYS;
          }

          const billCreationDate = new Date(bill.createdAt);
          const diffTime = Math.abs(today - billCreationDate);
          const billAgeInDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

          return billAgeInDays >= REMINDER_DELAY_DAYS;
        });

        if (overdueBills.length > 0) {
          const totalOverdueAmount = overdueBills.reduce((sum, bill) => sum + bill.remainingDue, 0);

          contentWrapper.innerHTML = `
            <h4 style="margin: 0 0 3px 0; color: #C53030; font-size: 13px; font-weight: 600;">‡¶¨‡¶ø‡¶≤ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶∞‡¶ø‡¶Æ‡¶æ‡¶á‡¶®‡ßç‡¶°‡¶æ‡¶∞</h4>
            <p style="margin: 0; color: #7B341E; font-size: 11px; line-height: 1.3;">
                <strong>${toBengaliNumber(overdueBills.length)} ‡¶ú‡¶®</strong> ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶¨‡¶ø‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶ø‡¶§ ‡¶∏‡¶Æ‡ßü‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§
                ‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ï‡ßá‡ßü‡¶æ: <strong>‡ß≥${toBengaliNumber(totalOverdueAmount.toFixed(2))}</strong>
            </p>
        `;

          viewDueBtn.onclick = () => {
            switchPage('billing');
            setTimeout(() => {
              const unpaidFilterBtn = document.querySelector('#billing .filter-btn[data-filter="unpaid"]');
              if (unpaidFilterBtn) unpaidFilterBtn.click();
            }, 100);
          };

          notificationCard.style.display = 'block';
        } else {
          notificationCard.style.display = 'none';
        }
      }

      function renderDashboard() {
        const currentMonth = new Date().getMonth();
        const currentYear = new Date().getFullYear();
        const monthBills = db.bills.filter(b => b.month == currentMonth && b.year == currentYear);

        const totalCustomers = db.customers.filter(c => c.isActive !== false).length;
        const totalBillAmount = monthBills.reduce((sum, bill) => sum + (bill.totalAmount || 0), 0);
        const totalPaid = monthBills.reduce((sum, bill) => sum + (bill.paidAmount || 0), 0);
        const totalUnpaid = totalBillAmount - totalPaid;

        document.getElementById('db-total-customers').textContent = toBengaliNumber(totalCustomers);
        document.getElementById('db-total-bill').textContent = `‡ß≥${toBengaliNumber(totalBillAmount.toFixed(2))}`;
        document.getElementById('db-total-paid').textContent = `‡ß≥${toBengaliNumber(totalPaid.toFixed(2))}`;
        document.getElementById('db-total-unpaid').textContent = `‡ß≥${toBengaliNumber(totalUnpaid.toFixed(2))}`;

        renderRecentActivities();
        checkAndDisplayBillReminder();
      }
      const customerForm = document.getElementById('customerForm');
      const customerIdInput = document.getElementById('customerId');
      const customerNameInput = document.getElementById('customerName');
      const customerPhoneInput = document.getElementById('customerPhone');
      const customerHouseInput = document.getElementById('customerHouse');
      const customerBillInput = document.getElementById('customerBill');
      const customBillGroup = document.getElementById('customBillGroup');
      const customBillAmountInput = document.getElementById('customBillAmount');
      const connectionDateInput = document.getElementById('connectionDate');
      const isFreeUserInput = document.getElementById('isFreeUser');
      const customerFormTitle = document.getElementById('customer-form-title');
      const customerSubmitBtn = document.getElementById('customer-submit-btn');
      const customerCancelBtn = document.getElementById('customer-cancel-btn');

      function initializeCustomerForm() {
        populateDropdown('customerHouse', db.locations, {
          isBengali: false
        });
        populateDropdown('customerBill', defaultBillAmounts);
        if (!customerIdInput.value) {
          connectionDateInput.valueAsDate = new Date();
        }
      }

      customerBillInput.addEventListener('change', () => {
        customBillGroup.classList.toggle('hidden', customerBillInput.value !== 'other');
      });

      function resetCustomerForm() {
        customerForm.reset();
        customerIdInput.value = '';
        customerFormTitle.textContent = '‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®';
        customerSubmitBtn.textContent = '‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®';
        connectionDateInput.valueAsDate = new Date();
        customBillGroup.classList.add('hidden');
        customerCancelBtn.style.display = 'none';
      }

      isFreeUserInput.addEventListener('change', () => {
        const billGroup = document.getElementById('customerBill').parentElement;
        billGroup.classList.toggle('hidden', isFreeUserInput.checked);
        if (isFreeUserInput.checked) {
          customerBillInput.required = false;
          customBillGroup.classList.add('hidden');
        } else {
          customerBillInput.required = true;
          customBillGroup.classList.toggle('hidden', customerBillInput.value !== 'other');
        }
      });

// ‡¶™‡ßÅ‡¶∞‡¶®‡ßã customerForm.addEventListener ‡¶¨‡ßç‡¶≤‡¶ï‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶¨‡¶∏‡¶æ‡¶®
customerForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const customerId = document.getElementById('customerId').value;
    const customerName = document.getElementById('customerName').value.trim();
    const isFree = document.getElementById('isFreeUser').checked;

    if (!customerId) {
        const existingCustomer = db.customers.find(c => c.name.toLowerCase() === customerName.toLowerCase());
        if (existingCustomer) {
            alert('‡¶è‡¶á ‡¶®‡¶æ‡¶Æ‡ßá ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶è‡¶ï‡¶ú‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶∞‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶®‡¶æ‡¶Æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
            return;
        }
    }

    let monthlyBill = 0;
    if (!isFree) {
        const billSelect = document.getElementById('customerBill');
        monthlyBill = billSelect.value === 'other' ?
            parseFloat(document.getElementById('customBillAmount').value) :
            parseFloat(billSelect.value);
    }
    const macAddress = getMacAddress('customerMacContainer');

    const customerData = {
        name: customerName,
        phone: document.getElementById('customerPhone').value,
        house: document.getElementById('customerHouse').value,
        monthlyBill,
        connectionDate: document.getElementById('connectionDate').value,
        isFree,
        macAddress,
        advanceBalance: 0,
        deactivationPending: false
    };

    try {
        if (customerId) {
            // ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
            const customerRef = doc(firestore, "customers", customerId);
            await updateDoc(customerRef, customerData);

            // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
            const index = db.customers.findIndex(c => c.id === customerId);
            if (index > -1) {
                customerData.id = customerId; // ‡¶Ü‡¶á‡¶°‡¶ø ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
                customerData.advanceBalance = db.customers[index].advanceBalance;
                db.customers[index] = customerData;
            }
            alert('‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');

        } else {
            // ‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
            const newId = Date.now().toString();
            customerData.id = newId;
            await setDoc(doc(firestore, "customers", newId), customerData);
            
            // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
            db.customers.push(customerData);
            
            alert('‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
            addActivity('customer_added', `${customerName} ‡¶®‡¶æ‡¶Æ‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, {
                customerName: customerName,
                location: customerData.house,
                amount: monthlyBill,
                isFree: isFree
            });
        }
        
        showBackupReminder();
        resetCustomerForm();
        switchPage('customers');

    } catch (error) {
        console.error("Firebase-‡¶è ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶∏‡ßá‡¶≠/‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ", error);
        alert("‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§");
    }
});


      customerCancelBtn.addEventListener('click', () => {
        resetCustomerForm();
        switchPage('customers');
      });

      // ‡¶è‡¶á ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡¶®‡ßã getCustomerStatus ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡ßá‡¶∞ ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ‡ßü ‡¶¨‡¶∏‡¶¨‡ßá

      function getCustomerStatus(customer) { // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá 'customer' ‡¶Ö‡¶¨‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡¶ü‡¶ø‡¶á ‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
        if (!customer) return {
          text: 'Unknown',
          class: '',
          sortOrder: 99
        };

        const currentMonth = new Date().getMonth();
        const currentYear = new Date().getFullYear();

        const currentBill = db.bills.find(b =>
          b.customerId === customer.id && // customer.id ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
          b.year === currentYear &&
          b.month === currentMonth
        );

        if (customer.isFree) {
          return {
            text: '‡¶´‡ßç‡¶∞‡¶ø',
            class: 'status-free',
            sortOrder: 4
          };
        }

        if (currentBill) {
          // --- ‡¶Ø‡¶¶‡¶ø ‡¶ö‡¶≤‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶¨‡¶ø‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá ‡¶•‡¶æ‡¶ï‡ßá ---
          if (currentBill.status === 'paid') {
            if (customer.advanceBalance > 0) {
              return {
                text: `‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏: ‡ß≥${toBengaliNumber(customer.advanceBalance.toFixed(2))}`,
                class: 'status-advance',
                sortOrder: 3
              };
            }
            return {
              text: 'Paid',
              class: 'status-paid',
              sortOrder: 5
            };
          }

          if (currentBill.status === 'partially_paid') {
            return {
              text: `‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ: ‡ß≥${toBengaliNumber(currentBill.remainingDue.toFixed(2))}`,
              class: 'status-unpaid',
              sortOrder: 2
            };
          }

          // ‡¶Ø‡¶¶‡¶ø ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ 'unpaid' ‡¶π‡ßü
          return {
            text: `‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ: ‡ß≥${toBengaliNumber(currentBill.remainingDue.toFixed(2))}`,
            class: 'status-unpaid',
            sortOrder: 1
          };

        } else {
          // --- ‡¶Ø‡¶¶‡¶ø ‡¶ö‡¶≤‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶¨‡¶ø‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶®‡¶æ ‡¶π‡ßü‡ßá ‡¶•‡¶æ‡¶ï‡ßá ---
          if (customer.advanceBalance > 0) {
            return {
              text: `‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏: ‡ß≥${toBengaliNumber(customer.advanceBalance.toFixed(2))}`,
              class: 'status-advance',
              sortOrder: 3
            };
          }

          // ‡¶¨‡¶ø‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡¶®‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏‡¶ì ‡¶®‡ßá‡¶á
          return {
            text: 'Pending',
            class: 'status-pending',
            sortOrder: 6
          };
        }
      }

      function renderCustomerListPage(searchTerm = '', filter = 'all') {
        const container = document.getElementById('customer-list-by-house');
        container.innerHTML = '';

        // ‡¶ß‡¶æ‡¶™ ‡ßß: ‡¶∏‡¶ï‡¶≤ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®‡ßã (‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶è‡¶ñ‡¶® ‡¶Ü‡¶∞ ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ)
        let customersToDisplay = db.customers;
        if (searchTerm) {
          const lowerCaseSearchTerm = searchTerm.toLowerCase();
          customersToDisplay = customersToDisplay.filter(c =>
            c.name.toLowerCase().includes(lowerCaseSearchTerm) ||
            (c.phone && c.phone.includes(searchTerm))
          );
        }

        // ‡¶Æ‡ßã‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ (‡¶∏‡¶ï‡¶≤ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï)
        document.getElementById('total-customer-count').textContent = toBengaliNumber(customersToDisplay.length);

        // ‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßã‡¶®‡ßã ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶®‡¶æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü
        if (customersToDisplay.length === 0) {
          container.innerHTML =
            '<p style="text-align:center; color:#718096; margin-top: 20px;">‡¶ï‡ßã‡¶®‡ßã ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>';
          return;
        }

        // ‡¶∏‡¶ï‡¶≤ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡¶ï‡ßá (‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶è‡¶¨‡¶Ç ‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º) ‡¶¨‡¶æ‡ßú‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ ‡¶ï‡¶∞‡¶æ
        const houseGroups = {};
        customersToDisplay.forEach(customer => {
          if (!houseGroups[customer.house]) {
            houseGroups[customer.house] = [];
          }
          houseGroups[customer.house].push(customer);
        });

        const sortedHouses = Object.keys(houseGroups).sort((a, b) => db.locations.indexOf(a) - db.locations.indexOf(
          b));

        // ‡¶¨‡¶æ‡ßú‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶§‡ßà‡¶∞‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶®
        sortedHouses.forEach(house => {
          let houseCustomers = houseGroups[house];
          if (houseCustomers.length === 0) return;

          houseCustomers = houseCustomers.map(customer => ({
              ...customer,
              statusInfo: getCustomerStatus(customer)
            }))
            .sort((a, b) => a.statusInfo.sortOrder - b.statusInfo.sortOrder);

          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML =
            `<h2>${house} (${toBengaliNumber(houseCustomers.length)} ‡¶ú‡¶®)</h2><div class="table-container"><table class="data-table"><thead><tr><th>‡¶®‡¶æ‡¶Æ</th><th>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶¨‡¶ø‡¶≤</th><th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th><th>‡¶è‡¶ï‡¶∂‡¶®</th></tr></thead><tbody></tbody></table></div>`;
          const tableBody = card.querySelector('tbody');

          houseCustomers.forEach(customer => {
            const row = document.createElement('tr');

            // ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ
            // ‚òÖ‚òÖ‚òÖ ‡¶Æ‡ßÇ‡¶≤ ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶®: ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶è‡¶ï‡¶∂‡¶® ‡¶¨‡¶æ‡¶ü‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‚òÖ‚òÖ‚òÖ
            // ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ
            let actionButtons;
            if (customer.isActive === false) {
              // ‡¶Ø‡¶¶‡¶ø ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶π‡ßü
              row.style.backgroundColor = '#FFF1F2';
              row.style.color = '#881337';
              actionButtons =
                `<button class="btn action-btn" style="background-color: #28a745;" onclick="reactivateCustomer('${customer.id}')">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®</button>`;
            } else {
              // ‡¶Ø‡¶¶‡¶ø ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶π‡ßü
              actionButtons = `
                    <button class="btn action-btn" style="background-color: #3182CE;" onclick="editCustomer('${customer.id}')">Edit</button>
                    <button class="btn btn-delete action-btn" onclick="deleteCustomer('${customer.id}')">Del</button>
                `;
            }

            row.innerHTML = `
                <td><a href="#" class="customer-name-link" onclick="openCustomerProfile('${customer.id}')">${customer.name}</a></td>
                <td>‡ß≥${toBengaliNumber(customer.monthlyBill.toFixed(2))}</td>
                <td class="${customer.statusInfo.class}">${customer.statusInfo.text}</td>
                <td>${actionButtons}</td>
            `;
            tableBody.appendChild(row);
          });
          container.appendChild(card);
        });
        const lastScrollPosition = sessionStorage.getItem('lastScrollPosition');
        if (lastScrollPosition) {
            setTimeout(() => {
                window.scrollTo(0, parseInt(lastScrollPosition, 10));
                sessionStorage.removeItem('lastScrollPosition');
            }, 100);
        }
      }

      document.getElementById('customer-search-input').addEventListener('input', (e) => renderCustomerListPage(e
        .target.value));

      window.editCustomer = (id) => {
          sessionStorage.setItem('lastScrollPosition', window.scrollY);
          
          customerToEditId = id;
          switchPage('add_customer');
      };

// ‡¶™‡ßÅ‡¶∞‡¶®‡ßã deleteCustomer ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶¨‡¶∏‡¶æ‡¶®
    window.deleteCustomer = async (id) => {
    if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶è‡¶á ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡¶ï‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶á ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø‡¶ì ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§')) {
        const customer = db.customers.find(c => c.id === id);
        const customerName = customer ? customer.name : '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï';

        try {
            // Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
            await deleteDoc(doc(firestore, "customers", id));

            // ‡¶è‡¶á ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡¶ø‡¶§ ‡¶∏‡¶¨ ‡¶¨‡¶ø‡¶≤ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ
            const billsToDelete = db.bills.filter(b => b.customerId === id);
            const batch = writeBatch(firestore);
            billsToDelete.forEach(bill => {
                const billRef = doc(firestore, "bills", bill.id);
                batch.delete(billRef);
            });
            await batch.commit(); // ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶¨ ‡¶¨‡¶ø‡¶≤ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ

            // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
            db.customers = db.customers.filter(c => c.id !== id);
            db.bills = db.bills.filter(b => b.customerId !== id);

            addActivity('customer_deleted', `‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${customerName}`, {
                customerName: customerName,
                customerId: id
            });

            alert(`‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï "${customerName}" ‡¶è‡¶¨‡¶Ç ‡¶§‡¶æ‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶¨‡¶ø‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
            
            // UI ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡¶æ
            renderCustomerListPage(document.getElementById('customer-search-input').value);
            renderDashboard();

        } catch (error) {
            console.error("Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ", error);
            alert("‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
        }
    }
};

      const generateBillsBtn = document.getElementById('generateBillsBtn');
      const deleteMonthBillsBtn = document.getElementById('delete-month-bills-btn');
      const billingListContainer = document.getElementById('billing-list-by-house');

      const adjustmentModal = document.getElementById('adjustmentModal');
      const adjustmentModalClose = document.getElementById('adjustment-modal-close');
      const adjustmentForm = document.getElementById('adjustmentForm');
      const adjustmentList = document.getElementById('adjustment-list');
      const adjustmentFormTitle = document.getElementById('adjustment-form-title');
      const adjustmentSubmitBtn = document.getElementById('adjustment-submit-btn');
      const adjustmentCancelBtn = document.getElementById('adjustment-cancel-btn');

      const ispEditModal = document.getElementById('ispEditModal');
      const ispEditModalClose = document.getElementById('isp-edit-modal-close');
      const ispEditForm = document.getElementById('ispEditForm');

      function initializeBillingForm() {
        const monthOptions = months.map((m, i) => ({
          value: i,
          text: m
        }));
        populateDropdown('generateYear', years, {
          defaultValue: new Date().getFullYear()
        });
        populateDropdown('generateMonth', monthOptions, {
          defaultValue: new Date().getMonth()
        });

        const customerOptions = [{
          value: 'all',
          text: '‡¶∏‡¶ï‡¶≤ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï'
        }].concat(
          db.customers.sort((a, b) => a.name.localeCompare(b.name)).map(c => ({
            value: c.id,
            text: `${c.name} (${c.house.split('‡¶É')[0]})`
          }))
        );
        populateDropdown('generateForCustomer', customerOptions, {
          defaultValue: 'all'
        });
      }

      function renderBillingPage() {
        initializeBillingForm();
        const year = document.getElementById('generateYear').value;
        const month = document.getElementById('generateMonth').value;
        const searchTerm = document.getElementById('billing-search-input').value;

        renderBillingTable(year, month, searchTerm, 'all');

        document.querySelectorAll('.payment-action-btn').forEach(button => {
          button.addEventListener('click', (event) => {
            const billId = event.target.getAttribute('data-bill-id');
            openPaymentModal(billId);
          });
        });
      }

      // ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡¶®‡ßã renderBillingTable ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡ßá‡¶∞ ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ‡ßü ‡¶¨‡¶∏‡¶¨‡ßá

      function renderBillingTable(year, month, searchTerm = '', filter = 'all') {
        billingListContainer.innerHTML = '';
        let monthBills = db.bills.filter(b => b.year == year && b.month == month);

        if (searchTerm) {
          monthBills = monthBills.filter(bill => {
            const customer = db.customers.find(c => c.id === bill.customerId);
            return customer && customer.name.toLowerCase().includes(searchTerm.toLowerCase());
          });
        }

        if (filter === 'unpaid') {
          monthBills = monthBills.filter(b => b.status !== 'paid');
        }
        // ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶Æ‡¶æ‡¶ù‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶¨‡ßá
        const statusPriority = {
          'unpaid': 1,
          'partially_paid': 2,
          'paid': 3
        };
        monthBills.sort((a, b) => (statusPriority[a.status] || 99) - (statusPriority[b.status] || 99));

        db.locations.forEach(house => {
          const houseBills = monthBills.filter(bill => {
            const customer = db.customers.find(c => c.id === bill.customerId);
            return customer && customer.house === house;
          });

          if (houseBills.length === 0) return;

          const unpaidCount = houseBills.filter(b => b.status !== 'paid').length;
          const unpaidText = unpaidCount > 0 ?
            `<span class="unpaid-count">(${toBengaliNumber(unpaidCount)} ‡¶ú‡¶® ‡¶¨‡¶ø‡¶≤ ‡¶¶‡ßá‡ßü‡¶®‡¶ø)</span>` : '';

          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML =
            `<h2>${house} ${unpaidText}</h2><div class="table-container"><table class="data-table"><thead><tr><th>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï</th><th>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶¨‡¶ø‡¶≤</th><th>‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ</th><th>‡¶è‡¶°‡¶≠‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏</th><th>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶≤</th><th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th><th>‡¶è‡¶ï‡¶∂‡¶®</th></tr></thead><tbody></tbody></table></div>`;
          const tableBody = card.querySelector('tbody');

          houseBills.forEach(bill => {
            const customer = db.customers.find(c => c.id === bill.customerId);
            if (!customer) return;

            const dueFromAdjustments = (bill.adjustments || []).filter(a => a.type === 'due').reduce((sum,
              a) => sum + a.amount, 0);
            const finalTotalAmount = bill.monthlyAmount + bill.dueAmount + dueFromAdjustments;

            let dueForDisplay = 0; // ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶Æ‡¶æ‡¶® ‡ß¶ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
            let statusText, statusClass;

            // ******************************************************
            // ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶¨‡¶ö‡ßá‡ßü‡ßá ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶≤‡¶ú‡¶ø‡¶ï‡¶ü‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá
            // ******************************************************
            if (bill.status === 'paid') {
              statusText = 'Paid';
              statusClass = 'status-paid';
              dueForDisplay = 0; // ‡¶Ø‡¶¶‡¶ø ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ "Paid" ‡¶π‡ßü, ‡¶¨‡¶ï‡ßá‡ßü‡¶æ ‡¶ï‡¶≤‡¶æ‡¶Æ‡ßá ‡¶∏‡¶¨‡¶∏‡¶Æ‡ßü ‡ß¶ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
            } else if (bill.status === 'partially_paid') {
              statusText = 'Partially Paid';
              statusClass = 'status-partially-paid';
              dueForDisplay = bill.remainingDue; // ‡¶Ü‡¶Ç‡¶∂‡¶ø‡¶ï ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶™‡¶∞ ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶ü‡¶æ‡¶ï‡¶æ‡¶ü‡¶æ‡¶á ‡¶¨‡¶ï‡ßá‡ßü‡¶æ
            } else { // Unpaid
              statusText = 'Unpaid';
              statusClass = 'status-unpaid';
              dueForDisplay = bill.dueAmount +
              dueFromAdjustments; // ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶¨‡¶ï‡ßá‡ßü‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ú‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶¨‡¶ï‡ßá‡ßü‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
            }

            const row = document.createElement('tr');
            row.innerHTML = `
                <td><a href="#" class="customer-name-link" onclick="openCustomerProfile('${customer.id}')">${customer.name}</a></td>
                <td>‡ß≥${toBengaliNumber(bill.monthlyAmount.toFixed(2))}</td>
                <td>‡ß≥${toBengaliNumber(dueForDisplay.toFixed(2))}</td>
                <td>‡ß≥${toBengaliNumber((customer.advanceBalance || 0).toFixed(2))}</td>
                <td><strong>‡ß≥${toBengaliNumber(finalTotalAmount.toFixed(2))}</strong></td>
                <td class="${statusClass}">${statusText}</td>
                <td>
                    <button class="btn btn-submit action-btn payment-action-btn" data-bill-id="${bill.id}">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü</button>
                    <button class="btn btn-submit action-btn" onclick="openAdjustmentModal('${bill.id}')">Adj</button>
                    <button class="btn btn-delete action-btn" onclick="deleteBill('${bill.id}')">Del</button>
                </td>
            `;
            tableBody.appendChild(row);
          });
          billingListContainer.appendChild(card);
        });

        // ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡ßü ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
        document.querySelectorAll('.payment-action-btn').forEach(button => {
          button.addEventListener('click', (event) => {
            const billId = event.target.getAttribute('data-bill-id');
            openPaymentModal(billId);
          });
        });
      }

      // --- ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ createBillForCustomer ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá, ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® ---

// ‡¶™‡ßÅ‡¶∞‡¶®‡ßã createBillForCustomer ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶¨‡¶∏‡¶æ‡¶®
    function createBillObjectForCustomer(customer, year, month) {
    if (customer.isFree) return null;

    const previousMonth = month === 0 ? 11 : month - 1;
    const yearForPrevious = month === 0 ? year - 1 : year;
    const lastBill = db.bills.find(b => b.customerId === customer.id && b.year == yearForPrevious && b.month == previousMonth);
    let dueFromPrevious = (lastBill && lastBill.status !== 'paid') ? (lastBill.remainingDue || 0) : 0;

    let monthlyAmount = customer.monthlyBill;
    let totalAmount = monthlyAmount + dueFromPrevious;
    let status = 'unpaid';
    let advanceUsed = 0;
    let paidAmount = 0;
    let remainingDue = totalAmount;
    let paymentHistoryForBill = [];

    if (customer.advanceBalance > 0) {
        const amountToUseFromAdvance = Math.min(customer.advanceBalance, totalAmount);
        advanceUsed = amountToUseFromAdvance;
        customer.advanceBalance -= amountToUseFromAdvance;
        paidAmount = amountToUseFromAdvance;
        remainingDue = totalAmount - amountToUseFromAdvance;
        paymentHistoryForBill.push({
            id: Date.now() + Math.random(),
            amount: amountToUseFromAdvance,
            date: new Date().toISOString(),
            source: 'advance',
            balanceAfter: remainingDue
        });
        status = remainingDue <= 0 ? 'paid' : 'partially_paid';
    }

    return {
        id: Date.now().toString() + customer.id,
        customerId: customer.id,
        year: parseInt(year),
        month: parseInt(month),
        createdAt: new Date().toISOString(),
        monthlyAmount: monthlyAmount,
        dueAmount: dueFromPrevious,
        totalAmount: totalAmount,
        status: status,
        paidAmount: paidAmount,
        remainingDue: remainingDue,
        adjustments: [],
        advanceUsed: advanceUsed,
        isPaid: status === 'paid',
        paymentHistory: paymentHistoryForBill,
        discount: 0
    };
}


// ‡¶™‡ßÅ‡¶∞‡¶®‡ßã generateBillsBtn.addEventListener ‡¶¨‡ßç‡¶≤‡¶ï‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶¨‡¶∏‡¶æ‡¶®
generateBillsBtn.addEventListener('click', async () => {
    const year = parseInt(document.getElementById('generateYear').value);
    const month = parseInt(document.getElementById('generateMonth').value);
    const customerId = document.getElementById('generateForCustomer').value;

    if (db.customers.length === 0) {
        alert('‡¶è‡¶á ‡¶Æ‡ßÅ‡¶π‡ßÇ‡¶∞‡ßç‡¶§‡ßá ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡ßá ‡¶ï‡ßã‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡ßá‡¶á ‡¶§‡¶æ‡¶á ‡¶¨‡¶ø‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ');
        return;
    }

    const billsToCreate = [];
    if (customerId === 'all') {
        const existingBilledCustomerIds = new Set(db.bills.filter(b => b.year === year && b.month === month).map(b => b.customerId));
        const customersToBill = db.customers.filter(customer => {
            const isActive = customer.isActive === undefined ? true : customer.isActive;
            if (!isActive || customer.isFree || existingBilledCustomerIds.has(customer.id)) {
                return false;
            }
            const connectionDate = new Date(customer.connectionDate);
            const today = new Date();
            const diffTime = Math.abs(today - connectionDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays > 30;
        });

        if (customersToBill.length === 0) {
            alert('‡¶è‡¶á ‡¶Æ‡ßÅ‡¶π‡ßÇ‡¶∞‡ßç‡¶§‡ßá ‡¶¨‡¶ø‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§');
            return;
        }
        customersToBill.forEach(customer => {
            const newBill = createBillObjectForCustomer(customer, year, month);
            if (newBill) billsToCreate.push(newBill);
        });

    } else {
        const customer = db.customers.find(c => c.id === customerId);
        if (customer) {
            // ... (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶∏‡¶¨ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶è‡¶ï‡¶á ‡¶•‡¶æ‡¶ï‡¶¨‡ßá)
            const existingBillIndex = db.bills.findIndex(b => b.customerId === customer.id && b.year === year && b.month === month);
            if (existingBillIndex > -1) {
                if (!confirm(`${customer.name}-‡¶è‡¶∞ ‡¶¨‡¶ø‡¶≤ ‡¶è‡¶á ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶õ‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`)) return;
                // ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶¨‡¶ø‡¶≤ Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡¶∞‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨, ‡¶Ü‡¶™‡¶æ‡¶§‡¶§ ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶∞‡¶æ‡¶ö‡ßç‡¶õ‡¶ø
                db.bills.splice(existingBillIndex, 1);
            }
            const newBill = createBillObjectForCustomer(customer, year, month);
            if (newBill) billsToCreate.push(newBill);
        }
    }

    if (billsToCreate.length > 0) {
        try {
            const batch = writeBatch(firestore);
            billsToCreate.forEach(bill => {
                const billRef = doc(firestore, "bills", bill.id);
                batch.set(billRef, bill);
            });
            await batch.commit();

            // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
            billsToCreate.forEach(bill => db.bills.push(bill));
            
            alert(`${toBengaliNumber(billsToCreate.length)} ‡¶ú‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶ø‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶è‡¶¨‡¶Ç Firebase-‡¶è ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
            addActivity('bill_created', `${toBengaliNumber(billsToCreate.length)} ‡¶ú‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶ø‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, { month, year, customerCount: billsToCreate.length });
            
            renderBillingPage();
            showBackupReminder();

        } catch (error) {
            console.error("Firebase-‡¶è ‡¶¨‡¶ø‡¶≤ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ", error);
            alert("‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§ ‡¶¨‡¶ø‡¶≤‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§");
        }
    }
});


      deleteMonthBillsBtn.addEventListener('click', () => {
        const year = parseInt(document.getElementById('generateYear').value);
        const month = parseInt(document.getElementById('generateMonth').value);
        const monthName = months[month];
        if (confirm(
            `‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ${monthName}, ${toBengaliNumber(year)}-‡¶è‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶¨‡¶ø‡¶≤ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶á ‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶´‡ßá‡¶∞‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§`
            )) {
          const deletedBills = db.bills.filter(b => b.year === year && b.month === month);
          const deletedCount = deletedBills.length;

          db.bills = db.bills.filter(b => b.year !== year || b.month !== month);

          // Add activity log for month bills deleted
          addActivity('month_bills_deleted',
            `‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∏‡¶¨ ‡¶¨‡¶ø‡¶≤ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${monthName} ${year} (${deletedCount} ‡¶ü‡¶ø ‡¶¨‡¶ø‡¶≤)`, {
              month: month,
              year: year,
              deletedCount: deletedCount
            });

          saveDb();
          alert(`${monthName}, ${toBengaliNumber(year)}-‡¶è‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶¨‡¶ø‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
          renderBillingPage();
          renderDashboard();
        }
      });

      window.toggleBillStatus = (billId) => {
        const bill = db.bills.find(b => b.id === billId);
        if (bill) {
          bill.isPaid = !bill.isPaid;
          saveDb();
          renderBillingPage();
          renderDashboard();
        }
      };

      function renderAdjustments(billId) {
        const bill = db.bills.find(b => b.id === billId);
        adjustmentList.innerHTML = '';
        if (!bill || !bill.adjustments || bill.adjustments.length === 0) {
          adjustmentList.innerHTML = '<li>‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ú‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</li>';
          return;
        }
        bill.adjustments.forEach(adj => {
          const li = document.createElement('li');
          const typeText = adj.type === 'due' ? '‡¶¨‡¶ï‡ßá‡ßü‡¶æ' : '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏';
          li.innerHTML = `
                    <span class="adjustment-info">${typeText}: ‡ß≥${toBengaliNumber(adj.amount)} (${adj.notes || 'N/A'})</span>
                    <div class="adjustment-actions">
                        <button class="btn action-btn" style="background-color: #3182CE;" onclick="editAdjustment('${bill.id}', '${adj.id}')">Edit</button>
                        <button class="btn btn-delete action-btn" onclick="deleteAdjustment('${bill.id}', '${adj.id}')">Del</button>
                    </div>
                `;
          adjustmentList.appendChild(li);
        });
      }

      window.openAdjustmentModal = (billId) => {
        const bill = db.bills.find(b => b.id === billId);
        const customer = db.customers.find(c => c.id === bill.customerId);
        if (bill && customer) {
          document.getElementById('adjustmentBillId').value = bill.id;
          document.getElementById('modal-customer-name-adj').textContent = customer.name;
          renderAdjustments(bill.id);
          resetAdjustmentForm();
          adjustmentModal.classList.add('active');
          overlay.style.display = 'block';
        }
      };

      function closeAdjustmentModal() {
        adjustmentModal.classList.remove('active');
        overlay.style.display = 'none';
      }
      adjustmentModalClose.addEventListener('click', closeAdjustmentModal);

      function resetAdjustmentForm() {
        adjustmentForm.reset();
        document.getElementById('adjustmentId').value = '';
        adjustmentFormTitle.textContent = '‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ú‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®';
        adjustmentSubmitBtn.textContent = '‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®';
        adjustmentCancelBtn.style.display = 'none';
      }
      adjustmentCancelBtn.addEventListener('click', resetAdjustmentForm);

      window.editAdjustment = (billId, adjId) => {
        const bill = db.bills.find(b => b.id === billId);
        const adj = bill.adjustments.find(a => a.id === adjId);
        if (adj) {
          document.getElementById('adjustmentId').value = adj.id;
          document.getElementById('adjustmentAmount').value = adj.amount;
          document.getElementById('adjustmentType').value = adj.type;
          document.getElementById('adjustmentNotes').value = adj.notes;
          adjustmentFormTitle.textContent = '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ú‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®';
          adjustmentSubmitBtn.textContent = '‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®';
          adjustmentCancelBtn.style.display = 'inline-block';
        }
      };

      window.deleteAdjustment = (billId, adjId) => {
        if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶è‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ú‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
          const bill = db.bills.find(b => b.id === billId);
          const adj = bill.adjustments.find(a => a.id === adjId);
          const customer = db.customers.find(c => c.id === bill.customerId);

          if (adj.type === 'advance') {
            customer.advanceBalance -= adj.amount;
          }

          bill.adjustments = bill.adjustments.filter(a => a.id !== adjId);

          // Add activity log for adjustment deleted
          const typeText = adj.type === 'due' ? '‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ' : '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏';
          addActivity('adjustment_deleted',
            `‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ú‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${customer.name} - ${typeText} ‡ß≥${adj.amount}`, {
              customerName: customer.name,
              adjustmentType: adj.type,
              amount: adj.amount,
              notes: adj.notes
            });

          recalculateBillTotal(billId);
          saveDb();
          renderAdjustments(billId);
          renderBillingPage();
        }
      };

      // ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡¶®‡ßã adjustmentForm.addEventListener ‡¶è‡¶∞ ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ‡ßü ‡¶¨‡¶∏‡¶¨‡ßá

// ‡¶™‡ßÅ‡¶∞‡¶®‡ßã adjustmentForm.addEventListener ‡¶¨‡ßç‡¶≤‡¶ï‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶¨‡¶∏‡¶æ‡¶®
adjustmentForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const billId = document.getElementById('adjustmentBillId').value;
    const adjId = document.getElementById('adjustmentId').value;
    const amount = parseFloat(document.getElementById('adjustmentAmount').value);
    const type = document.getElementById('adjustmentType').value;
    const notes = document.getElementById('adjustmentNotes').value;

    const billIndex = db.bills.findIndex(b => b.id === billId);
    if (billIndex === -1) {
        alert("‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶¨‡¶ø‡¶≤ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§");
        return;
    }
    const bill = { ...db.bills[billIndex] }; // Create a mutable copy

    const customerIndex = db.customers.findIndex(c => c.id === bill.customerId);
    if (customerIndex === -1) {
        alert("‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§");
        return;
    }
    const customer = { ...db.customers[customerIndex] }; // Create a mutable copy

    if (isNaN(amount) || amount <= 0) {
        alert("‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®‡•§");
        return;
    }

    if (!bill.adjustments) {
        bill.adjustments = [];
    }

    if (adjId) {
        const adjIndex = bill.adjustments.findIndex(a => a.id === adjId);
        if (adjIndex > -1) {
            const oldAdj = bill.adjustments[adjIndex];
            if (oldAdj.type === 'advance') {
                customer.advanceBalance -= oldAdj.amount;
            }
            bill.adjustments[adjIndex] = { ...oldAdj, amount, type, notes };
        }
    } else {
        bill.adjustments.push({
            id: Date.now().toString() + Math.random(),
            amount,
            type,
            notes
        });
    }

    if (type === 'advance') {
        customer.advanceBalance = (customer.advanceBalance || 0) + amount;
        addActivity('advance_deposit', `${customer.name}-‡¶è‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, { customerName: customer.name, amount, notes });
    } else {
        addActivity('due_adjustment', `${customer.name}-‡¶è‡¶∞ ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ ‡¶∏‡¶Æ‡¶®‡ßç‡¶¨‡¶Ø‡¶º ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, { customerName: customer.name, amount, notes });
    }

    // Recalculate bill and update status
    const updatedBill = recalculateBillObject(bill, customer);
    if (updatedBill.remainingDue <= 0) {
        updatedBill.status = 'paid';
        updatedBill.isPaid = true;
    } else if (updatedBill.paidAmount > 0) {
        updatedBill.status = 'partially_paid';
        updatedBill.isPaid = false;
    } else {
        updatedBill.status = 'unpaid';
        updatedBill.isPaid = false;
    }

    try {
        const batch = writeBatch(firestore);
        batch.set(doc(firestore, "bills", updatedBill.id), updatedBill);
        batch.set(doc(firestore, "customers", customer.id), customer);
        await batch.commit();

        // Update local db
        db.bills[billIndex] = updatedBill;
        db.customers[customerIndex] = customer;

        renderAdjustments(billId);
        renderBillingPage();
        renderCustomerListPage();
        resetAdjustmentForm();
        alert("‡¶∏‡¶Æ‡¶®‡ßç‡¶¨‡¶Ø‡¶º ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");

    } catch (error) {
        console.error("Firebase-‡¶è ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ú‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ", error);
        alert("‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ú‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§");
    }
});

      document.querySelectorAll('.note-tag').forEach(tag => {
        tag.addEventListener('click', () => {
          document.getElementById('adjustmentNotes').value = tag.dataset.note;
        });
      });

// ‡¶™‡ßÅ‡¶∞‡¶®‡ßã deleteBill ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶¨‡¶∏‡¶æ‡¶®
    window.deleteBill = async (billId) => {
    if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶è‡¶á ‡¶¨‡¶ø‡¶≤‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
        const billIndex = db.bills.findIndex(b => b.id === billId);
        if (billIndex > -1) {
            const bill = db.bills[billIndex];
            const customer = db.customers.find(c => c.id === bill.customerId);
            const customerName = customer ? customer.name : '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï';
            const monthName = months[bill.month];

            try {
                // Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡¶ø‡¶≤‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
                await deleteDoc(doc(firestore, "bills", billId));

                // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡¶ø‡¶≤‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ
                db.bills.splice(billIndex, 1);

                addActivity('bill_deleted', `‡¶¨‡¶ø‡¶≤ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${customerName} (${monthName} ${bill.year})`, {
                    customerName: customerName,
                    month: bill.month,
                    year: bill.year,
                    amount: bill.totalAmount
                });

                alert(`‡¶¨‡¶ø‡¶≤‡¶ü‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
                
                // UI ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡¶æ
                renderBillingPage();
                renderDashboard();

            } catch (error) {
                console.error("Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡¶ø‡¶≤ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ", error);
                alert("‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§ ‡¶¨‡¶ø‡¶≤‡¶ü‡¶ø ‡¶Æ‡ßã‡¶õ‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§");
            }
        }
    }
};


      // --- START: Payment Modal Functions ---

      // ‡¶è‡¶á ‡¶≠‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤‡¶ü‡¶ø ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ï‡¶∞‡¶¨‡ßá ‡¶ï‡ßã‡¶® ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá

      /**
       * ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤‡¶ü‡¶ø ‡¶ñ‡ßã‡¶≤‡ßá ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßÄ‡¶Ø‡¶º ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶è‡¶ü‡¶ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßá‡•§
       * @param {string} billId - ‡¶Ø‡ßá ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá ‡¶§‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø‡•§
       */
      function openPaymentModal(billId) {
        const bill = db.bills.find(b => b.id === billId);
        if (!bill) {
          alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶¨‡¶ø‡¶≤ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!');
          return;
        }

        const customer = db.customers.find(c => c.id === bill.customerId);
        if (!customer) {
          alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!');
          return;
        }

        currentPaymentBillId = billId;

        const totalBill = bill.totalAmount || 0;
        const discount = bill.discount || 0;
        const paidAmount = bill.paidAmount || 0;
        const finalBill = totalBill - discount;
        const dueAmount = Math.max(0, finalBill - paidAmount);
        const advanceAmount = customer.advanceBalance || 0;

        document.getElementById('payment-customer-name').textContent = customer.name;
        document.getElementById('payment-bill-month').textContent =
          `${months[bill.month]}, ${toBengaliNumber(bill.year)}`;
        document.getElementById('payment-bill-amount').textContent =
          `‡ß≥${toBengaliNumber(finalBill.toFixed(2))} (‡¶õ‡¶æ‡ßú: ‡ß≥${toBengaliNumber(discount.toFixed(2))})`;
        document.getElementById('payment-due-amount').textContent = `‡ß≥${toBengaliNumber(dueAmount.toFixed(2))}`;
        document.getElementById('payment-advance-amount').textContent =
          `‡ß≥${toBengaliNumber(advanceAmount.toFixed(2))}`;
        document.getElementById('payment-amount-input').value = '';
        document.getElementById('discount-amount-input').value = '';

        displayPaymentHistory(billId);

        document.getElementById('paymentModal').classList.add('active');
        document.getElementById('overlay').style.display = 'block';

        setTimeout(() => {
          document.getElementById('payment-amount-input').focus();
        }, 300);
      }

      function closePaymentModal() {
        const paymentModal = document.getElementById('paymentModal');
        const overlay = document.getElementById('overlay');

        if (paymentModal) {
          paymentModal.classList.remove('active');
        }
        if (overlay) {
          overlay.style.display = 'none';
        }

        currentPaymentBillId = null; // ‡¶¨‡¶ø‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ

        // ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶°‡¶ø‡¶∏‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡¶ï‡ßç‡¶∏ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
        const discountContent = document.getElementById('discount-section-content');
        const toggleDiscountBtn = document.getElementById('toggle-discount-section-btn');
        const discountInput = document.getElementById('discount-amount-input');

        if (discountContent) {
          discountContent.classList.remove('active'); // ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠
        }
        if (toggleDiscountBtn) {
          // ‡¶¨‡¶æ‡¶ü‡¶®‡¶ü‡¶ø‡¶ï‡ßá ‡¶§‡¶æ‡¶∞ ‡¶Ü‡¶∏‡¶≤ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡ßü ‡¶´‡¶ø‡¶∞‡¶ø‡ßü‡ßá ‡¶Ü‡¶®‡¶æ
          toggleDiscountBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" fill="currentColor" style="vertical-align: middle; margin-right: 5px;"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶õ‡¶æ‡ßú ‡¶¶‡¶ø‡¶®
        `;
        }
        if (discountInput) {
          discountInput.value = '';
        }
      }

      /**
       * ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶® ‡¶ï‡¶∞‡ßá‡•§
       * @param {string} billId - ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø‡•§
       */
      // --- ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ displayPaymentHistory ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá, ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ö‡ßÇ‡ßú‡¶æ‡¶®‡ßç‡¶§ ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® ---

      function displayPaymentHistory(billId) {
        const bill = db.bills.find(b => b.id === billId);
        const historyContainer = document.getElementById('payment-history-list');

        if (!bill || !bill.paymentHistory || !bill.paymentHistory.length) {
          historyContainer.innerHTML = '<div class="payment-history-empty">‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</div>';
          return;
        }

        // CSS ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ (‡¶ö‡ßÇ‡ßú‡¶æ‡¶®‡ßç‡¶§ ‡¶∏‡¶Ç‡¶∏‡ßç‡¶ï‡¶∞‡¶£)
        const styles = `
        .payment-history-item-final-v3 { background: #F7FAFC; border: 1px solid #E2E8F0; border-left: 4px solid var(--secondary-color); border-radius: 6px; padding: 8px 12px; margin-bottom: 6px; }
        .ph-source-final-v3 { font-size: 11px; font-weight: 600; color: var(--primary-color); margin-bottom: 3px; display: flex; align-items: center; gap: 5px; }
        .ph-amount-final-v3 { font-size: 18px; font-weight: 700; color: var(--paid-color); margin-bottom: 4px; }
        .ph-date-final-v3 { font-size: 10px; color: #718096; display: flex; align-items: center; gap: 5px; }
        .ph-status-line-final-v3 { margin-top: 5px; font-size: 11px; display: flex; flex-direction: column; gap: 4px; }
        .ph-status-line-final-v3 .due { font-style: italic; color: #718096; }
        .ph-status-line-final-v3 .final-payment { font-weight: 600; color: var(--paid-color); }
        .ph-status-line-final-v3 .new-advance, .ph-status-line-final-v3 .total-advance { font-weight: 600; color: var(--advance-color); }
    `;
        if (!document.getElementById('payment-history-styles-final-v3')) {
          const styleSheet = document.createElement("style");
          styleSheet.id = 'payment-history-styles-final-v3';
          styleSheet.innerText = styles;
          document.head.appendChild(styleSheet);
        }

        const sortedHistory = bill.paymentHistory.sort((a, b) => new Date(b.date) - new Date(a.date));

        let historyHTML = sortedHistory.map(payment => {
          const paymentDate = new Date(payment.date);
          const formattedDate = paymentDate.toLocaleDateString('bn-BD', {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          });

          let sourceText;
          if (payment.source === 'manual') sourceText = 'üë§ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶≤ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü';
          else if (payment.source === 'advance') sourceText = 'üí≥ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶Æ‡¶®‡ßç‡¶¨‡ßü';
          else if (payment.source === 'advance_deposit') sourceText = '‚ú® ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶ú‡¶Æ‡¶æ';
          else sourceText = '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶â‡ßé‡¶∏';

          let statusLinesHTML = '';

          // ‚òÖ‚òÖ‚òÖ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ö‡ßÇ‡ßú‡¶æ‡¶®‡ßç‡¶§ ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶® ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø ‚òÖ‚òÖ‚òÖ
          if (payment.isFinalPayment) {
            statusLinesHTML +=
              `<div class="final-payment">‚úÖ ‡¶¨‡¶ø‡¶≤‡¶ü‡¶ø ‡¶è‡¶á ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§</div>`;
            if (payment.newAdvance > 0) {
              statusLinesHTML +=
                `<div class="new-advance">‚ú® ‡¶è‡¶¨‡¶Ç ‡ß≥${toBengaliNumber(payment.newAdvance.toFixed(2))} ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§</div>`;
            }
          } else if (payment.source === 'advance_deposit') {
            const totalAdvance = Math.abs(payment.balanceAfter);
            if (payment.isFirstAdvance) {
              statusLinesHTML +=
                `<div class="new-advance">‚ú® ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶ú‡¶Æ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ‡ß≥${toBengaliNumber(totalAdvance.toFixed(2))}</div>`;
            } else {
              statusLinesHTML +=
                `<div class="total-advance">üìà ‡¶Æ‡ßã‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶è‡¶ñ‡¶®: ‡ß≥${toBengaliNumber(totalAdvance.toFixed(2))}</div>`;
            }
          } else if (payment.balanceAfter > 0) {
            statusLinesHTML +=
              `<div class="due">üìâ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶™‡¶∞ ‡¶¨‡¶ï‡ßá‡ßü‡¶æ: ‡ß≥${toBengaliNumber(payment.balanceAfter.toFixed(2))}</div>`;
          }

          return `
            <div class="payment-history-item-final-v3">
                <div class="ph-source-final-v3">${sourceText}</div>
                <div class="ph-amount-final-v3">‡ß≥${toBengaliNumber(payment.amount.toFixed(2))}</div>
                <div class="ph-date-final-v3">üóìÔ∏è ${formattedDate}</div>
                <div class="ph-status-line-final-v3">${statusLinesHTML}</div>
            </div>
        `;
        }).join('');

        historyContainer.innerHTML = historyHTML;
      }

      /**
       * ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶ì‡¶≠‡¶æ‡¶∞‡¶≤‡ßá ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßá‡•§
       */

      // --- END: Payment Modal Functions ---

      document.getElementById('generateYear').addEventListener('change', renderBillingPage);
      document.getElementById('generateMonth').addEventListener('change', renderBillingPage);
      document.getElementById('billing-search-input').addEventListener('input', renderBillingPage);
      document.querySelectorAll('#billing .filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelector('#billing .filter-btn.active').classList.remove('active');
          btn.classList.add('active');
          renderBillingPage();
        });
      });

      const ispBillForm = document.getElementById('ispBillForm');
      const ispHistoryTableBody = document.querySelector('#ispHistoryTable tbody');

      function initializeIspForm() {
        const monthOptions = months.map((m, i) => ({
          value: i,
          text: m
        }));
        populateDropdown('ispYear', years, {
          defaultValue: new Date().getFullYear()
        });
        populateDropdown('ispMonth', monthOptions, {
          defaultValue: new Date().getMonth()
        });
        document.getElementById('ispPayDate').valueAsDate = new Date();
      }

      function renderIspHistoryTable() {
        ispHistoryTableBody.innerHTML = '';
        db.ispPayments.sort((a, b) => new Date(b.payDate) - new Date(a.payDate)).forEach(p => {
          const row = document.createElement('tr');
          const payDate = new Date(p.payDate);
          const formattedDate =
            `${toBengaliNumber(payDate.getDate())} ${months[payDate.getMonth()]} ${toBengaliNumber(payDate.getFullYear())}`;
          row.innerHTML = `
                    <td>${months[p.month]} ${toBengaliNumber(p.year)}</td>
                    <td>‡ß≥${toBengaliNumber(p.amount)}</td>
                    <td>${formattedDate}</td>
                    <td>
                        <button class="btn action-btn" style="background-color: #3182CE;" onclick="openIspEditModal('${p.id}')">Edit</button>
                        <button class="btn btn-delete action-btn" onclick="window.deleteIspPayment('${p.id}')">Del</button>
                    </td>
                `;
          ispHistoryTableBody.appendChild(row);
        });
      }

      window.openIspEditModal = (id) => {
        const payment = db.ispPayments.find(p => p.id === id);
        if (payment) {
          document.getElementById("ispEditId").value = payment.id;
          document.getElementById("ispEditAmount").value = payment.amount;
          document.getElementById("ispEditPayDate").value = payment.payDate;
          populateDropdown("ispEditMonth", months.map((m, i) => ({
            value: i,
            text: m
          })), {
            defaultValue: payment.month
          });
          populateDropdown("ispEditYear", years, {
            defaultValue: payment.year
          });
          ispEditModal.classList.add("active");
          overlay.style.display = "block";
        }
      };
      ispEditModalClose.addEventListener('click', () => {
        ispEditModal.classList.remove('active');
        overlay.style.display = 'none';
      });
      ispEditForm.addEventListener("submit", e => {
        e.preventDefault();
        const id = document.getElementById("ispEditId").value;
        const payment = db.ispPayments.find(p => p.id === id);
        if (payment) {
          payment.amount = parseFloat(document.getElementById("ispEditAmount").value);
          payment.payDate = document.getElementById("ispEditPayDate").value;
          payment.month = parseInt(document.getElementById("ispEditMonth").value);
          payment.year = parseInt(document.getElementById("ispEditYear").value);
          saveDb();
          renderIspHistoryTable();
          ispEditModal.classList.remove("active");
          overlay.style.display = "none";
        }
      });

      window.deleteIspPayment = (id) => {
        if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶è‡¶á ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
          const payment = db.ispPayments.find(p => p.id === id);
          const monthName = ['‡¶ú‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø', '‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø', '‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö', '‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤', '‡¶Æ‡ßá', '‡¶ú‡ßÅ‡¶®', '‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á', '‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü',
            '‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞', '‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞', '‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞', '‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞'
          ][payment.month];

          db.ispPayments = db.ispPayments.filter(p => p.id !== id);

          // Add activity log for ISP payment deleted
          addActivity('isp_payment_deleted',
            `‡¶Ü‡¶á‡¶è‡¶∏‡¶™‡¶ø ‡¶¨‡¶ø‡¶≤ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${monthName} ${payment.year} - ‡ß≥${payment.amount}`, {
              month: payment.month,
              year: payment.year,
              amount: payment.amount
            });

          saveDb();
          renderIspHistoryTable();
        }
      };

      document.getElementById('delete-all-isp-history-btn').addEventListener('click', () => {
        if (confirm('‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶ï‡¶≤ ‡¶Ü‡¶á‡¶è‡¶∏‡¶™‡¶ø ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
          const deletedCount = db.ispPayments.length;
          db.ispPayments = [];

          // Add activity log for all ISP history deleted
          addActivity('all_isp_history_deleted',
            `‡¶∏‡¶ï‡¶≤ ‡¶Ü‡¶á‡¶è‡¶∏‡¶™‡¶ø ‡¶¨‡¶ø‡¶≤ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá (${deletedCount} ‡¶ü‡¶ø ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶°)`, {
              deletedCount: deletedCount
            });

          saveDb();
          renderIspHistoryTable();
        }
      });

      function renderIspBillPage() {
        initializeIspForm();
        renderIspHistoryTable();
      }

// ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ispBillForm.addEventListener ‡¶¨‡ßç‡¶≤‡¶ï‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶¨‡¶∏‡¶æ‡¶®
ispBillForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const year = parseInt(document.getElementById("ispYear").value);
    const month = parseInt(document.getElementById("ispMonth").value);
    const amount = parseFloat(document.getElementById("ispAmount").value);
    const payDate = document.getElementById("ispPayDate").value;

    const existingPayment = db.ispPayments.find(p => p.year === year && p.month === month);

    if (existingPayment) {
        alert(`‡¶è‡¶á ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ (${months[month]}, ${toBengaliNumber(year)}) ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶á‡¶è‡¶∏‡¶™‡¶ø ‡¶¨‡¶ø‡¶≤ ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
        return;
    }

    const payment = {
        id: Date.now().toString(),
        year: year,
        month: month,
        amount: amount,
        payDate: payDate
    };

    try {
        // Firebase-‡¶è ‡¶®‡¶§‡ßÅ‡¶® ISP ‡¶¨‡¶ø‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
        await setDoc(doc(firestore, "ispPayments", payment.id), payment);

        // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
        db.ispPayments.push(payment);
        
        alert("‡¶Ü‡¶á‡¶è‡¶∏‡¶™‡¶ø ‡¶¨‡¶ø‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶è‡¶¨‡¶Ç Firebase-‡¶è ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
        addActivity('isp_payment', `‡¶Ü‡¶á‡¶è‡¶∏‡¶™‡¶ø ‡¶¨‡¶ø‡¶≤ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, { month, year, amount });

        renderIspHistoryTable();
        ispBillForm.reset();
        initializeIspForm();

    } catch (error) {
        console.error("Firebase-‡¶è ISP ‡¶¨‡¶ø‡¶≤ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ", error);
        alert("‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§ ISP ‡¶¨‡¶ø‡¶≤ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§");
    }
});


      function initializeReportFilters() {
        const monthOptions = months.map((m, i) => ({
          value: i,
          text: m
        }));
        populateDropdown('reportYear', years, {
          defaultValue: new Date().getFullYear()
        });
        populateDropdown('reportMonth', monthOptions, {
          defaultValue: new Date().getMonth()
        });
      }

      function generateReport() {
        const year = document.getElementById('reportYear').value;
        const month = document.getElementById('reportMonth').value;
        const filteredBills = db.bills.filter(b => b.year == year && b.month == month);

        const totalRevenue = filteredBills.filter(b => b.isPaid).reduce((sum, b) => sum + b.monthlyAmount + b
          .dueAmount, 0);
        const totalDues = filteredBills.filter(b => !b.isPaid).reduce((sum, b) => sum + b.totalAmount, 0);
        const ispPaid = db.ispPayments.find(p => p.year == year && p.month == month)?.amount || 0;

        document.getElementById('total-revenue').textContent = `‡ß≥${toBengaliNumber(totalRevenue.toFixed(2))}`;
        document.getElementById('total-dues').textContent = `‡ß≥${toBengaliNumber(totalDues.toFixed(2))}`;
        document.getElementById('isp-paid-amount').textContent = `‡ß≥${toBengaliNumber(ispPaid.toFixed(2))}`;
        document.getElementById('net-income').textContent =
          `‡ß≥${toBengaliNumber((totalRevenue - ispPaid).toFixed(2))}`;

        const houseContainer = document.getElementById('house-reports-container');
        houseContainer.innerHTML = '';
        db.locations.forEach(houseName => {
          const houseBills = filteredBills.filter(b => {
            const customer = db.customers.find(c => c.id === b.customerId);
            return customer && customer.house === houseName;
          });
          const houseRevenue = houseBills.filter(b => b.isPaid).reduce((sum, b) => sum + b.monthlyAmount + b
            .dueAmount, 0);
          if (houseBills.length > 0) {
            const houseCard = document.createElement('div');
            houseCard.className = 'summary-item';
            houseCard.innerHTML =
              `<h3>${houseName}</h3><p>‡¶Ü‡¶Ø‡¶º: ‡ß≥${toBengaliNumber(houseRevenue.toFixed(2))}</p>`;
            houseContainer.appendChild(houseCard);
          }
        });
      }

      function generatePdfReport() {
          const year = document.getElementById('reportYear').value;
          const month = document.getElementById('reportMonth').value;
          const filteredBills = db.bills.filter(b => b.year == year && b.month == month);
      
          // Calculate all necessary values
          const totalRevenue = filteredBills.reduce((sum, bill) => {
              // Only count paid amounts for revenue
              return sum + (bill.paidAmount || 0);
          }, 0);
      
          const totalDues = filteredBills.reduce((sum, bill) => {
              // Sum of remaining dues for all non-paid bills
              return sum + (bill.remainingDue || 0);
          }, 0);
      
          const ispPaid = db.ispPayments.find(p => p.year == year && p.month == month)?.amount || 0;
          const netIncome = totalRevenue - ispPaid;
      
          const companyName = localStorage.getItem('websiteName') || 'Abid Network';
          const companyLogo = localStorage.getItem('websiteLogo') || 'https://i.ibb.co/Lz0dGqC/router-icon.png'; // Default logo
      
          // Generate HTML for house-wise revenue table
          const houseReportsHtml = db.locations.map(houseName => {
              const houseBills = filteredBills.filter(b => {
                  const customer = db.customers.find(c => c.id === b.customerId);
                  return customer && customer.house === houseName;
              });
              
              if (houseBills.length === 0) return '';
      
              const houseRevenue = houseBills.reduce((sum, bill) => sum + (bill.paidAmount || 0), 0);
              
              if (houseRevenue === 0) return ''; // Don't show houses with zero revenue for the month
      
              return `
                  <tr>
                      <td>${houseName}</td>
                      <td>‡ß≥${toBengaliNumber(houseRevenue.toFixed(2))}</td>
                  </tr>
              `;
          }).join('');
      
          // Generate the full PDF content with the new, final design
          const pdfContent = `
              <!DOCTYPE html>
              <html lang="bn">
              <head>
                  <meta charset="UTF-8">
                  <meta name="viewport" content="width=device-width, initial-scale=1.0">
                  <title>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü - ${companyName}</title>
                  <link rel="preconnect" href="https://fonts.googleapis.com">
                  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
                  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;600;700&display=swap" rel="stylesheet">
                  <style>
                      :root {
                          --primary-color: #4A5568; --secondary-color: #5A67D8; --text-color: #2D3748;
                          --border-color: #E2E8F0; --bg-light: #F7FAFC;
                      }
                      body {
                          font-family: 'Noto Sans Bengali', sans-serif; background-color: #eef2f7;
                          color: var(--text-color); margin: 0; padding: 20px;
                          -webkit-print-color-adjust: exact; print-color-adjust: exact;
                      }
                      .pdf-container {
                          max-width: 800px; margin: 0 auto; background: white;
                          border: 1px solid var(--border-color); box-shadow: 0 0 20px rgba(0,0,0,0.07);
                          border-radius: 8px; overflow: hidden;
                      }
                      .pdf-header {
                          padding: 20px 30px; display: flex; align-items: center; gap: 15px;
                          background-color: var(--bg-light); border-bottom: 1px solid var(--border-color);
                      }
                      .pdf-header .company-logo { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
                      .pdf-header .company-name { font-size: 24px; font-weight: 700; color: var(--text-color); margin: 0; }
                      .pdf-content { padding: 25px 30px; }
                      .report-title-bar {
                          display: flex; justify-content: space-between; align-items: baseline;
                          border-bottom: 2px solid var(--secondary-color); padding-bottom: 10px; margin-bottom: 20px;
                      }
                      .report-title-bar h2 { font-size: 18px; font-weight: 600; color: var(--primary-color); margin: 0; }
                      .report-title-bar .report-period { font-size: 15px; font-weight: 500; color: var(--secondary-color); }
                      .summary-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px; }
                      .summary-card {
                          display: flex; align-items: center; gap: 15px; background-color: var(--bg-light);
                          padding: 15px; border-radius: 6px; border-left: 4px solid;
                      }
                      .summary-card .icon { font-size: 24px; line-height: 1; }
                      .summary-card .info h3 { font-size: 13px; font-weight: 500; color: #718096; margin: 0 0 4px 0; }
                      .summary-card .info p { font-size: 18px; font-weight: 700; margin: 0; }
                      .summary-card.revenue { border-color: #38A169; color: #38A169; }
                      .summary-card.dues { border-color: #DD6B20; color: #DD6B20; }
                      .summary-card.isp { border-color: #E53E3E; color: #E53E3E; }
                      .summary-card.net { border-color: #3182CE; color: #3182CE; }
                      .house-table-container h2 { font-size: 16px; font-weight: 600; color: var(--primary-color); margin-bottom: 10px; }
                      table { width: 100%; border-collapse: collapse; }
                      th, td { border: 1px solid var(--border-color); padding: 10px 12px; font-size: 13px; text-align: left; }
                      th { background-color: var(--bg-light); font-weight: 600; }
                      td:last-child { text-align: right; font-weight: 600; }
                      .pdf-footer {
                          text-align: center; padding: 15px; font-size: 11px;
                          color: #A0AEC0; background-color: var(--bg-light); border-top: 1px solid var(--border-color);
                      }
                      @media (max-width: 600px) {
                          body { padding: 10px; }
                          .pdf-container { width: 100%; box-sizing: border-box; }
                          .pdf-header, .pdf-content { padding: 15px; }
                          .pdf-header .company-name { font-size: 18px; }
                          .report-title-bar { flex-direction: column; align-items: flex-start; gap: 5px; }
                          .summary-grid { gap: 10px; }
                          .summary-card { padding: 10px; gap: 10px; }
                          .summary-card .icon { font-size: 20px; }
                          .summary-card .info h3 { font-size: 11px; }
                          .summary-card .info p { font-size: 15px; }
                          th, td { padding: 8px; font-size: 12px; }
                      }
                      @media print {
                          body { padding: 0; margin: 0; background-color: white; }
                          .pdf-container { box-shadow: none; border: none; width: 100%; max-width: 100%; border-radius: 0; }
                          .summary-grid { grid-template-columns: repeat(2, 1fr) !important; }
                          @page { size: A4; margin: 15mm; }
                      }
                  </style>
              </head>
              <body>
                  <div class="pdf-container">
                      <header class="pdf-header">
                          <img src="${companyLogo}" alt="‡¶≤‡ßã‡¶ó‡ßã" class="company-logo">
                          <h1 class="company-name">${companyName}</h1>
                      </header>
                      <main class="pdf-content">
                          <div class="report-title-bar">
                              <h2>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶Ü‡¶∞‡ßç‡¶•‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h2>
                              <div class="report-period">${months[month]}, ${toBengaliNumber(year)}</div>
                          </div>
                          <div class="summary-grid">
                              <div class="summary-card revenue"><span class="icon">üí∞</span><div class="info"><h3>‡¶Æ‡ßã‡¶ü ‡¶Ü‡ßü</h3><p>‡ß≥${toBengaliNumber(totalRevenue.toFixed(2))}</p></div></div>
                              <div class="summary-card dues"><span class="icon">‚ö†Ô∏è</span><div class="info"><h3>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ï‡ßá‡ßü‡¶æ</h3><p>‡ß≥${toBengaliNumber(totalDues.toFixed(2))}</p></div></div>
                              <div class="summary-card isp"><span class="icon">üí∏</span><div class="info"><h3>‡¶Ü‡¶á‡¶è‡¶∏‡¶™‡¶ø ‡¶ñ‡¶∞‡¶ö</h3><p>(‚àí) ‡ß≥${toBengaliNumber(ispPaid.toFixed(2))}</p></div></div>
                              <div class="summary-card net"><span class="icon">üìà</span><div class="info"><h3>‡¶®‡¶ø‡¶ü ‡¶Ü‡ßü</h3><p>‡ß≥${toBengaliNumber(netIncome.toFixed(2))}</p></div></div>
                          </div>
                          <div class="house-table-container">
                              <h2>‡¶¨‡¶æ‡ßú‡¶ø ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶Ü‡ßü‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</h2>
                              <table>
                                  <thead><tr><th>‡¶¨‡¶æ‡ßú‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ</th><th>‡¶Ü‡ßü‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th></tr></thead>
                                  <tbody>${houseReportsHtml}</tbody>
                              </table>
                          </div>
                      </main>
                      <footer class="pdf-footer">
                          ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶ü‡¶ø ‡¶∏‡ßç‡¶¨‡ßü‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü: ${toBengaliNumber(new Date().toLocaleString('bn-BD'))}
                      </footer>
                  </div>
              </body>
              </html>
          `;
      
          // Create a new window and print the content
          const printWindow = window.open('', '_blank');
          printWindow.document.write(pdfContent);
          printWindow.document.close();
          printWindow.onload = () => {
              setTimeout(() => {
                  printWindow.print();
              }, 500); // Delay to ensure styles are loaded
          };
      }


      function renderReportPage() {
        initializeReportFilters();
        generateReport();
        populateCustomerBillingHistoryDropdown();
      }
      document.getElementById('reportYear').addEventListener('change', generateReport);
      document.getElementById('reportMonth').addEventListener('change', generateReport);
      document.getElementById('printReportPdfBtn').addEventListener('click', generatePdfReport);

      function populateCustomerBillingHistoryDropdown() {
        const customerOptions = [{
          value: '',
          text: '‡¶è‡¶ï‡¶ü‡¶ø ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®'
        }].concat(
          db.customers.sort((a, b) => a.name.localeCompare(b.name)).map(c => ({
            value: c.id,
            text: `${c.name} (${c.house.split('‡¶É')[0]})`
          }))
        );
        populateDropdown('customerBillingHistorySelect', customerOptions, {
          isBengali: false
        });
      }

      document.getElementById('downloadCustomerBillingHistoryBtn').addEventListener('click', () => {
        const customerId = document.getElementById('customerBillingHistorySelect').value;
        if (customerId) {
          generateCustomerBillingHistoryPdf(customerId);
        } else {
          alert('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
        }
      });

      function generateCustomerBillingHistoryPdf(customerId) {
        const customer = db.customers.find(c => c.id === customerId);
        if (!customer) {
            alert('‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§');
            return;
        }
    
        const customerBills = db.bills
            .filter(b => b.customerId === customerId)
            .sort((a, b) => new Date(b.year, b.month) - new Date(a.year, a.month)); // Sort by most recent first
    
        const companyName = localStorage.getItem('websiteName') || 'Abid Network';
        const companyLogo = localStorage.getItem('websiteLogo') || 'https://i.ibb.co/Lz0dGqC/router-icon.png';
    
        const billingHistoryHtml = customerBills.map(bill => {
            let statusClass, statusText;
            if (bill.status === 'paid') {
                statusClass = 'status-paid';
                statusText = '‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§';
            } else if (bill.status === 'partially_paid') {
                statusClass = 'status-partial';
                statusText = '‡¶Ü‡¶Ç‡¶∂‡¶ø‡¶ï';
            } else {
                statusClass = 'status-unpaid';
                statusText = '‡¶¨‡¶ï‡ßá‡ßü‡¶æ';
            }
    
            return `
                <tr>
                    <td>${months[bill.month]}, ${toBengaliNumber(bill.year)}</td>
                    <td>‡ß≥${toBengaliNumber(bill.totalAmount.toFixed(2))}</td>
                    <td>‡ß≥${toBengaliNumber(bill.paidAmount.toFixed(2))}</td>
                    <td>‡ß≥${toBengaliNumber(bill.remainingDue.toFixed(2))}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                </tr>
            `;
        }).join('');
    
        const pdfContent = `
            <!DOCTYPE html>
            <html lang="bn">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>${customer.name} - ‡¶¨‡¶ø‡¶≤‡¶ø‡¶Ç ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</title>
                <link rel="preconnect" href="https://fonts.googleapis.com">
                <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
                <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;600;700&display=swap" rel="stylesheet">
                <style>
                    :root {
                        --primary-color: #4A5568; --secondary-color: #5A67D8; --text-color: #2D3748;
                        --border-color: #E2E8F0; --bg-light: #F7FAFC; --paid-color: #38A169;
                        --unpaid-color: #DD6B20; --partial-color: #D69E2E;
                    }
                    body {
                        font-family: 'Noto Sans Bengali', sans-serif; background-color: #eef2f7;
                        color: var(--text-color); margin: 0; padding: 20px;
                        -webkit-print-color-adjust: exact; print-color-adjust: exact;
                    }
                    .pdf-container {
                        max-width: 800px; margin: 0 auto; background: white;
                        border: 1px solid var(--border-color); box-shadow: 0 0 20px rgba(0,0,0,0.07);
                        border-radius: 8px; overflow: hidden;
                    }
                    .pdf-header {
                        padding: 20px 30px; display: flex; align-items: center; gap: 15px;
                        background-color: var(--bg-light); border-bottom: 1px solid var(--border-color);
                    }
                    .pdf-header .company-logo { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
                    .pdf-header .company-name { font-size: 24px; font-weight: 700; color: var(--text-color); margin: 0; }
                    .pdf-content { padding: 25px 30px; }
                    .customer-info-card {
                        background-color: var(--bg-light); border: 1px solid var(--border-color);
                        border-left: 5px solid var(--secondary-color); border-radius: 8px;
                        padding: 20px; margin-bottom: 25px;
                    }
                    .customer-info-card .customer-name { font-size: 22px; font-weight: 700; color: var(--primary-color); margin: 0 0 10px 0; }
                    .customer-info-card .info-grid {
                        display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                        gap: 8px; font-size: 13px;
                    }
                    .customer-info-card .info-item { color: #718096; }
                    .customer-info-card .info-item strong { color: var(--text-color); font-weight: 600; }
                    .history-table-container h2 { font-size: 16px; font-weight: 600; color: var(--primary-color); margin-bottom: 10px; }
                    .table-wrapper { overflow-x: auto; }
                    table { width: 100%; border-collapse: collapse; }
                    th, td {
                        border: 1px solid var(--border-color); padding: 10px 12px;
                        font-size: 13px; text-align: left; vertical-align: middle; white-space: nowrap;
                    }
                    th { background-color: var(--bg-light); font-weight: 600; }
                    .status-badge {
                        display: inline-block; padding: 3px 10px; border-radius: 15px;
                        font-size: 11px; font-weight: 600; color: white; text-align: center;
                    }
                    .status-paid { background-color: var(--paid-color); }
                    .status-unpaid { background-color: var(--unpaid-color); }
                    .status-partial { background-color: var(--partial-color); }
                    .pdf-footer {
                        text-align: center; padding: 15px; font-size: 11px;
                        color: #A0AEC0; background-color: var(--bg-light); border-top: 1px solid var(--border-color);
                    }
                    @media (max-width: 600px) {
                        body { padding: 10px; }
                        .pdf-header, .pdf-content { padding: 15px; }
                        .pdf-header .company-name { font-size: 20px; }
                        .customer-info-card .customer-name { font-size: 18px; }
                        .customer-info-card .info-grid { grid-template-columns: 1fr; }
                        th, td { padding: 8px; font-size: 12px; }
                    }
                    @media print {
                        body { padding: 0; margin: 0; background-color: white; }
                        .pdf-container { box-shadow: none; border: none; width: 100%; max-width: 100%; border-radius: 0; }
                        .table-wrapper { overflow-x: visible; }
                        @page { size: A4; margin: 15mm; }
                    }
                </style>
            </head>
            <body>
                <div class="pdf-container">
                    <header class="pdf-header">
                        <img src="${companyLogo}" alt="‡¶≤‡ßã‡¶ó‡ßã" class="company-logo">
                        <h1 class="company-name">${companyName}</h1>
                    </header>
                    <main class="pdf-content">
                        <div class="customer-info-card">
                            <h2 class="customer-name">${customer.name}</h2>
                            <div class="info-grid">
                                <div class="info-item">‡¶´‡ßã‡¶®: <strong>${customer.phone || 'N/A'}</strong></div>
                                <div class="info-item">‡¶¨‡¶æ‡ßú‡¶ø: <strong>${customer.house}</strong></div>
                                <div class="info-item">‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶¨‡¶ø‡¶≤: <strong>‡ß≥${toBengaliNumber(customer.monthlyBill.toFixed(2))}</strong></div>
                                <div class="info-item">‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: <strong>${toBengaliNumber(new Date(customer.connectionDate).toLocaleDateString('bn-BD'))}</strong></div>
                            </div>
                        </div>
                        <div class="history-table-container">
                            <h2>‡¶¨‡¶ø‡¶≤‡¶ø‡¶Ç ‡¶è‡¶¨‡¶Ç ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h2>
                            <div class="table-wrapper">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>‡¶Æ‡¶æ‡¶∏/‡¶¨‡¶õ‡¶∞</th>
                                            <th>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶≤</th>
                                            <th>‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§</th>
                                            <th>‡¶¨‡¶ï‡ßá‡ßü‡¶æ</th>
                                            <th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th>
                                        </tr>
                                    </thead>
                                    <tbody>${billingHistoryHtml}</tbody>
                                </table>
                            </div>
                        </div>
                    </main>
                    <footer class="pdf-footer">
                        ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶ü‡¶ø ‡¶∏‡ßç‡¶¨‡ßü‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü: ${toBengaliNumber(new Date().toLocaleString('bn-BD'))}
                    </footer>
                </div>
            </body>
            </html>
        `;
    
        const printWindow = window.open('', '_blank');
        printWindow.document.write(pdfContent);
        printWindow.document.close();
        printWindow.onload = () => {
            setTimeout(() => {
                printWindow.print();
            }, 500);
        };
    }

      function renderSettingsPage() {
        // Website customization functionality
        const websiteNameInput = document.getElementById('websiteName');
        const websiteLogoInput = document.getElementById('websiteLogo');
        const updateNameBtn = document.getElementById('updateWebsiteNameBtn');
        const updateLogoBtn = document.getElementById('updateWebsiteLogoBtn');

        // Load current website name
        const currentName = localStorage.getItem('websiteName') || 'Abid Network';
        websiteNameInput.value = currentName;

        // Update website name
        updateNameBtn.addEventListener('click', () => {
          const newName = websiteNameInput.value.trim();
          if (newName) {
            localStorage.setItem('websiteName', newName);

            // Update header title
            const headerTitle = document.querySelector('.header-title span');
            if (headerTitle) {
              headerTitle.textContent = newName;
            }

            // Update sidebar title
            const sidebarTitle = document.querySelector('.sidebar-header span');
            if (sidebarTitle) {
              sidebarTitle.textContent = newName;
            }

            // Update page title
            document.title = newName;

            alert('‡¶ì‡¶Ø‡¶º‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
          } else {
            alert('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡ßà‡¶ß ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§');
          }
        });

        // Update website logo
        updateLogoBtn.addEventListener('click', () => {
          const logoFile = websiteLogoInput.files[0];
          if (logoFile) {
            const reader = new FileReader();
            reader.onload = (e) => {
              const logoDataUrl = e.target.result;
              localStorage.setItem('websiteLogo', logoDataUrl);

              // Update header logo
              const headerLogo = document.querySelector('.header-title img');
              if (headerLogo) {
                headerLogo.src = logoDataUrl;
              }

              // Update sidebar logo
              const sidebarLogo = document.querySelector('.sidebar-header img');
              if (sidebarLogo) {
                sidebarLogo.src = logoDataUrl;
              }

              alert('‡¶ì‡¶Ø‡¶º‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü‡ßá‡¶∞ ‡¶≤‡ßã‡¶ó‡ßã ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
            };
            reader.readAsDataURL(logoFile);
          } else {
            alert('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
          }
        });

        const locationList = document.getElementById('locationList');
        const locationForm = document.getElementById('locationForm');
        const locationEditModal = document.getElementById('locationEditModal');
        const locationEditForm = document.getElementById('locationEditForm');
        const locationEditModalClose = document.getElementById('location-edit-modal-close');

        function renderLocations() {
          locationList.innerHTML = '';
          db.locations.forEach(loc => {
            const li = document.createElement('li');
            li.innerHTML = `
                        <span class="location-name">${loc}</span>
                        <div class="actions">
                            <button class="btn action-btn" style="background-color: #3182CE;" onclick="openLocationEditModal('${loc}')">Edit</button>
                            <button class="btn btn-delete action-btn" onclick="deleteLocation('${loc}')">Del</button>
                        </div>
                    `;
            locationList.appendChild(li);
          });
        }

// ‡¶™‡ßÅ‡¶∞‡¶®‡ßã locationForm.addEventListener ‡¶¨‡ßç‡¶≤‡¶ï‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶¨‡¶∏‡¶æ‡¶®
locationForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const newLocationInput = document.getElementById('newLocationName');
    const newLocation = newLocationInput.value.trim();

    if (newLocation && !db.locations.includes(newLocation)) {
        const locationData = {
            id: Date.now().toString(),
            name: newLocation
        };

        try {
            // Firebase-‡¶è ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
            await setDoc(doc(firestore, "locations", locationData.id), locationData);

            // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
            db.locations.push(newLocation); // ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∞‡ßá ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶æ‡¶ï‡¶ö‡¶æ‡¶∞ ‡¶¨‡¶ú‡¶æ‡ßü ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
            
            addActivity('location_added', `‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶æ‡¶°‡¶º‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${newLocation}`, {
                locationName: newLocation
            });

            renderLocations();
            newLocationInput.value = '';
            alert("‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");

        } catch (error) {
            console.error("Firebase-‡¶è ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ", error);
            alert("‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§");
        }
    } else {
        alert('‡¶è‡¶á ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®‡¶ü‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶®‡¶æ‡¶Æ‡¶ü‡¶ø ‡¶ñ‡¶æ‡¶≤‡¶ø‡•§');
    }
});


        window.openLocationEditModal = (oldName) => {
          document.getElementById('locationEditOldName').value = oldName;
          document.getElementById('locationEditNewName').value = oldName;
          locationEditModal.classList.add('active');
          overlay.style.display = 'block';
        };

        locationEditForm.addEventListener('submit', e => {
          e.preventDefault();
          const oldName = document.getElementById('locationEditOldName').value;
          const newName = document.getElementById('locationEditNewName').value.trim();
          if (newName && oldName !== newName && !db.locations.includes(newName)) {
            db.customers.forEach(c => {
              if (c.house === oldName) c.house = newName;
            });
            db.routers.forEach(r => {
              if (r.location === oldName) r.location = newName;
            });
            const index = db.locations.indexOf(oldName);
            if (index > -1) db.locations[index] = newName;
            saveDb();
            renderLocations();
            locationEditModal.classList.remove('active');
            overlay.style.display = 'none';
          } else {
            alert('‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡¶æ‡¶Æ ‡¶ñ‡¶æ‡¶≤‡¶ø, ‡¶è‡¶ï‡¶á ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶Æ‡¶æ‡¶®‡•§');
          }
        });

        locationEditModalClose.addEventListener('click', () => {
          locationEditModal.classList.remove('active');
          overlay.style.display = 'none';
        });

// ‡¶™‡ßÅ‡¶∞‡¶®‡ßã deleteLocation ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶¨‡¶∏‡¶æ‡¶®
window.deleteLocation = async (locName) => {
    if (defaultLocations.includes(locName)) {
        alert('‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§');
        return;
    }
    if (confirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá "${locName}" ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`)) {
        try {
            // Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®‡¶ü‡¶ø ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ
            const q = query(collection(firestore, "locations"), where("name", "==", locName));
            const querySnapshot = await getDocs(q);
            
            if (!querySnapshot.empty) {
                const docToDelete = querySnapshot.docs[0];
                await deleteDoc(doc(firestore, "locations", docToDelete.id));

                // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶•‡ßá‡¶ï‡ßá ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ
                db.locations = db.locations.filter(l => l !== locName);

                addActivity('location_deleted', `‡¶¨‡¶æ‡¶°‡¶º‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${locName}`, {
                    locationName: locName
                });

                renderLocations();
                alert(`"${locName}" ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®‡¶ü‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
            } else {
                alert("‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶è‡¶á ‡¶®‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§");
            }
        } catch (error) {
            console.error("Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ", error);
            alert("‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®‡¶ü‡¶ø ‡¶Æ‡ßã‡¶õ‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§");
        }
    }
};


        renderLocations();
      }

      const exportBtn = document.getElementById('export-data-btn');
      const importBtn = document.getElementById('import-data-btn');
      const importInput = document.getElementById('import-file-input');
      const resetBtn = document.getElementById('reset-app-btn');

      // ‡¶™‡ßÅ‡¶∞‡¶®‡ßã exportBtn.addEventListener ‡¶¨‡ßç‡¶≤‡¶ï‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶¨‡¶∏‡¶æ‡¶®

      exportBtn.addEventListener('click', () => {
        const fullBackupData = {
          db: db,
          activities: loadActivities()
        };
        const dataStr = JSON.stringify(fullBackupData, null, 2);
        const dataBlob = new Blob([dataStr], {
          type: 'application/json'
        });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        const fileName = `abid_network_full_backup_${new Date().toISOString().split('T')[0]}.json`;
        link.href = url;
        link.download = fileName;
        link.click();
        URL.revokeObjectURL(url);

        // ======================================================
        // ‡¶°‡ßá‡¶ü‡¶æ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶ó
        // ======================================================
        addActivity('data_backup', '‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡ßá‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', {
          fileName: fileName
        });
        // ======================================================

        const now = new Date();
        const bengaliDate = now.toLocaleDateString('bn-BD', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
        localStorage.setItem('lastExportDate', bengaliDate);
        updateLastExportDate();
        hideBackupReminder();
        renderDashboard(); // ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶ó ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
      });

      importBtn.addEventListener('click', () => importInput.click());
      // ‡¶™‡ßÅ‡¶∞‡¶®‡ßã importInput.addEventListener ‡¶¨‡ßç‡¶≤‡¶ï‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶¨‡¶∏‡¶æ‡¶®

      importInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const importedData = JSON.parse(e.target.result);
            let dbToLoad, activitiesToLoad = [];

            if (importedData.db && importedData.activities) {
              dbToLoad = importedData.db;
              activitiesToLoad = importedData.activities;
            } else if (importedData.customers && importedData.bills) {
              dbToLoad = importedData;
            } else {
              alert('‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø‡¶∞ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶¨‡ßã‡¶ù‡¶æ ‡¶Ø‡¶æ‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ‡•§ ‡¶è‡¶ü‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Ö‡¶¨‡ßà‡¶ß ‡¶´‡¶æ‡¶á‡¶≤‡•§');
              event.target.value = '';
              return;
            }

            if (confirm(
                '‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶è‡¶á ‡¶°‡ßá‡¶ü‡¶æ ‡¶á‡¶Æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡¶ï‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶°‡ßá‡¶ü‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§'
                )) {
              db = migrateDb(dbToLoad);
              saveDb();
              saveActivities(activitiesToLoad);

              // ======================================================
              // ‡¶°‡ßá‡¶ü‡¶æ ‡¶á‡¶Æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶ó
              // ======================================================
              addActivity('data_import', '‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡ßÅ‡¶®‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', {
                fileName: file.name
              });
              // ======================================================

              alert('‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶á‡¶Æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§');
              location.reload();
            }
          } catch (err) {
            console.error("Import failed:", err);
            alert('‡¶≠‡ßÅ‡¶≤ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶¨‡¶æ ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶™‡ßú‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§');
          } finally {
            event.target.value = '';
          }
        };
        reader.readAsText(file);
      });

// ‡¶™‡ßÅ‡¶∞‡¶®‡ßã resetBtn.addEventListener ‡¶¨‡ßç‡¶≤‡¶ï‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶¨‡¶∏‡¶æ‡¶®
resetBtn.addEventListener('click', async () => {
    if (confirm('‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶á ‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶´‡ßá‡¶∞‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§')) {
        
        const collectionsToDelete = ["customers", "bills", "ispPayments", "routers", "locations"];
        
        try {
            const batch = writeBatch(firestore);
            
            for (const collectionName of collectionsToDelete) {
                const q = query(collection(firestore, collectionName));
                const querySnapshot = await getDocs(q);
                querySnapshot.forEach((doc) => {
                    batch.delete(doc.ref);
                });
            }
            
            await batch.commit();

            // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú‡ßá‡¶∞ ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ
            localStorage.removeItem(LAST_PAGE_KEY);
            localStorage.removeItem(ACTIVITY_STORAGE_KEY);
            localStorage.removeItem('lastExportDate');
            localStorage.removeItem('websiteName');
            localStorage.removeItem('websiteLogo');

            alert('‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶∏‡¶ï‡¶≤ ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§');
            location.reload();

        } catch (error) {
            console.error("Firebase ‡¶°‡ßá‡¶ü‡¶æ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ", error);
            alert("‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§ ‡¶°‡ßá‡¶ü‡¶æ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§");
        }
    }
});

      const loadMoreBtn = document.getElementById('load-more-activities-btn');
      if (loadMoreBtn) {
        loadMoreBtn.addEventListener('click', () => {
          renderRecentActivities(true);
        });
      }

      function setFooterYear() {
        const yearSpan = document.getElementById('footer-year');
        if (yearSpan) {
          yearSpan.textContent = toBengaliNumber(new Date().getFullYear());
        }
      }

      // Customer Profile Modal Logic (UPDATED for v4.1)
      const customerProfileModal = document.getElementById('customerProfileModal');
      const customerProfileModalClose = document.getElementById('customer-profile-modal-close');

      // ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ö‡ßÇ‡ßú‡¶æ‡¶®‡ßç‡¶§ ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡¶®‡ßã getCustomerFinancialStatus ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡ßá‡¶∞ ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ‡ßü ‡¶¨‡¶∏‡¶¨‡ßá

      function getCustomerFinancialStatus(customerId) {
        const customer = db.customers.find(c => c.id === customerId);
        if (customer.isFree) {
            return {
                icon: '‚≠ê',
                text: '‡¶´‡ßç‡¶∞‡¶ø ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï',
                color: '#319795'
            };
        }
        if (!customer) return null;

        const isActive = customer.isActive === undefined ? true : customer.isActive;
        if (!isActive) {
          let inactiveText = '‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º';
          if (customer.advanceBalance > 0) {
            inactiveText += ` (‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏: ‡ß≥${toBengaliNumber(customer.advanceBalance.toFixed(2))})`;
          }
          return {
            icon: '‚ö†Ô∏è',
            text: inactiveText,
            color: '#E53E3E'
          };
        }

        const currentMonth = new Date().getMonth();
        const currentYear = new Date().getFullYear();

        const currentBill = db.bills.find(b =>
          b.customerId === customerId &&
          b.year === currentYear &&
          b.month === currentMonth
        );

        if (currentBill) {
          if (currentBill.status === 'paid') {
            if (customer.advanceBalance > 0) {
              return {
                icon: '‚ú®',
                text: `‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏: ‡ß≥${toBengaliNumber(customer.advanceBalance.toFixed(2))}`,
                color: '#3182CE'
              };
            }
            return {
              icon: '‚úÖ',
              text: '‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§',
              color: '#38A169'
            };
          }

          const dueFromAdjustments = (currentBill.adjustments || [])
            .filter(adj => adj.type === 'due')
            .reduce((sum, adj) => sum + adj.amount, 0);

          const totalPreviousDue = (currentBill.dueAmount || 0) + dueFromAdjustments;

          if (totalPreviousDue > 0 && currentBill.paidAmount === 0) {
            return {
              icon: '‚ùó',
              text: `‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ: ‡ß≥${toBengaliNumber(totalPreviousDue.toFixed(2))}`,
              color: '#DD6B20'
            };
          }

          if (currentBill.paidAmount > 0 && currentBill.remainingDue > 0) {
            return {
              icon: '‚è≥',
              text: `‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ: ‡ß≥${toBengaliNumber(currentBill.remainingDue.toFixed(2))}`,
              color: '#DD6B20'
            };
          }

          return {
            icon: 'üìÑ',
            text: '‡¶¨‡¶ø‡¶≤ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§',
            color: '#4A5568'
          };

        } else {
          if (customer.advanceBalance > 0) {
            return {
              icon: '‚ú®',
              text: `‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏: ‡ß≥${toBengaliNumber(customer.advanceBalance.toFixed(2))}`,
              color: '#3182CE'
            };
          }
          return {
            icon: 'üóìÔ∏è',
            text: '‡¶¨‡¶ø‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡¶®‡¶ø',
            color: '#718096'
          };
        }
      }

      window.openCustomerProfile = (customerId) => {
        const customer = db.customers.find(c => c.id === customerId);
        if (!customer) return;

        document.getElementById("profile-customer-name").textContent = customer.name;
        document.getElementById("profile-phone").textContent = customer.phone || 'N/A';
        document.getElementById("profile-house").textContent = customer.house;
        document.getElementById("profile-bill").textContent = customer.isFree ? '‡¶™‡ßç‡¶∞‡¶Ø‡ßã‡¶ú‡ßç‡¶Ø ‡¶®‡ßü' : `‡ß≥${toBengaliNumber(customer.monthlyBill.toFixed(2))}`;
        document.getElementById("profile-connection-date").textContent = toBengaliNumber(new Date(customer
          .connectionDate).toLocaleDateString('bn-BD'));
        document.getElementById("profile-mac").textContent = customer.macAddress || 'N/A';

        const financialStatus = getCustomerFinancialStatus(customerId);
        const statusContainer = document.getElementById('profile-status-container');
        const statusIcon = document.getElementById('profile-status-icon');
        const statusText = document.getElementById('profile-status-text');

        if (financialStatus) {
          statusIcon.textContent = financialStatus.icon;
          statusText.textContent = financialStatus.text;
          statusText.style.color = financialStatus.color;
          statusContainer.style.display = 'flex';
        } else {
          statusContainer.style.display = 'none';
        }

        const billingHistoryContainer = document.getElementById('profile-billing-history');
        billingHistoryContainer.innerHTML = '';
        const customerBills = db.bills.filter(b => b.customerId === customerId)
          .sort((a, b) => new Date(b.year, b.month) - new Date(a.year, a.month));

        if (customerBills.length === 0) {
          billingHistoryContainer.innerHTML =
            '<li style="text-align: center; padding: 10px; font-size: 12px; color: #6c757d;">‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§</li>';
        } else {
          customerBills.forEach(bill => {
            const li = document.createElement('li');
            let statusClass, statusText, dueText = '';

            const totalBillAmount = bill.monthlyAmount + (bill.dueAmount || 0) +
              ((bill.adjustments || []).filter(a => a.type === 'due').reduce((sum, a) => sum + a.amount, 0));

            if (bill.status === 'paid') {
              statusClass = 'status-paid';
              statusText = '‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§';
            } else if (bill.status === 'partially_paid') {
              statusClass = 'status-partially-paid';
              statusText = '‡¶Ü‡¶Ç‡¶∂‡¶ø‡¶ï';
              if (bill.remainingDue > 0) {
                dueText =
                `<span class="due">‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ: ‡ß≥${toBengaliNumber(bill.remainingDue.toFixed(2))}</span>`;
              }
            } else {
              statusClass = 'status-unpaid';
              statusText = '‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ';
            }

            li.className = `billing-history-item ${statusClass}`;
            li.innerHTML = `
                <div class="item-info">
                    <span class="month">${months[bill.month]}, ${toBengaliNumber(bill.year)}</span>
                    <span class="details">‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶≤: ‡ß≥${toBengaliNumber(totalBillAmount.toFixed(2))}</span>
                </div>
                <div class="item-status">
                    <span class="status">${statusText}</span>
                    ${dueText}
                </div>
            `;
            billingHistoryContainer.appendChild(li);
          });
        }

        const actionButtonContainer = document.getElementById('profile-action-buttons');
        const isActive = customer.isActive === undefined ? true : customer.isActive;

        if (isActive) {
          actionButtonContainer.innerHTML =
            `<button class="simple-status-btn btn-is-active" onclick="deactivateCustomer('${customer.id}')"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg><span>‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</span></button>`;
        } else {
          actionButtonContainer.innerHTML =
            `<button class="simple-status-btn btn-is-inactive" onclick="reactivateCustomer('${customer.id}')"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"/></svg><span>‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</span></button>`;
        }

        const customerProfileModal = document.getElementById('customerProfileModal');
        customerProfileModal.classList.add('active');
        document.getElementById('overlay').style.display = 'block';
      };

      window.deactivateCustomer = function(customerId) {
        const customer = db.customers.find(c => c.id === customerId);
        if (!customer) return;

        const currentMonth = new Date().getMonth();
        const currentYear = new Date().getFullYear();

        const currentBill = db.bills.find(b =>
          b.customerId === customerId &&
          b.year === currentYear &&
          b.month === currentMonth
        );

        if (currentBill && currentBill.status !== 'paid') {
          if (confirm(
              `‡¶è‡¶á ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶ö‡¶≤‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶¨‡¶ø‡¶≤ (${months[currentMonth]}) ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶õ‡ßá‡•§\n\n‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶ö‡¶æ‡¶® ‡¶Ø‡ßá ‡¶¨‡¶ø‡¶≤‡¶ü‡¶ø ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶π‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶ï?`
              )) {
            customer.deactivationPending = true;
            saveDb();
            alert(
              `‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß‡¶ü‡¶ø ‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§\n${customer.name}-‡¶è‡¶∞ ‡¶¨‡¶ø‡¶≤ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó‡¶ü‡¶ø ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶π‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§`
              );
            closeCustomerProfile();
            renderCustomerListPage();
          }
        } else {
          if (confirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ${customer.name}-‡¶è‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`)) {
            customer.isActive = false;
            customer.deactivationPending = false;
            saveDb();
            alert(`${customer.name}-‡¶è‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
            closeCustomerProfile();
            renderCustomerListPage();
          }
        }
      }

      window.reactivateCustomer = function(customerId) {
        const customer = db.customers.find(c => c.id === customerId);
        if (customer) {
          customer.isActive = true;
          saveDb();
          alert(`${customer.name}-‡¶è‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡¶Ø‡¶º ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
          closeCustomerProfile();
          renderCustomerListPage();
        }
      }

      function closeCustomerProfile() {
        const customerProfileModal = document.getElementById('customerProfileModal');
        const overlay = document.getElementById('overlay');
        if (customerProfileModal) {
          customerProfileModal.classList.remove('active');
        }
        if (overlay) {
          overlay.style.display = 'none';
        }
      }

      customerProfileModalClose.addEventListener('click', () => {
        customerProfileModal.classList.remove('active');
        overlay.style.display = 'none';
      });

      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          sidebar.classList.remove('active');
          customerProfileModal.classList.remove('active');
          ispEditModal.classList.remove('active');
          adjustmentModal.classList.remove('active');
          locationEditModal.classList.remove('active');
          overlay.style.display = 'none';
        }
      });

      loadDb();
      setFooterYear();

// Load saved website customizations
const savedName = localStorage.getItem('websiteName');
const savedLogo = localStorage.getItem('websiteLogo');

if (savedName) {
    document.getElementById("header-company-name").textContent = savedName;
    document.getElementById("sidebar-company-name").textContent = savedName;
    document.title = savedName;
}

// ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶§‡¶ñ‡¶®‡¶á ‡¶≤‡ßã‡¶ó‡ßã ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßã, ‡¶Ø‡¶ñ‡¶® localStorage-‡¶è ‡¶ï‡ßã‡¶®‡ßã ‡¶°‡ßá‡¶ü‡¶æ ‡¶•‡¶æ‡¶ï‡ßá
if (savedLogo) {
    const headerLogoImg = document.getElementById("header-company-logo");
    headerLogoImg.src = savedLogo;
    headerLogoImg.style.display = "inline-block"; // Make sure it's visible
    const sidebarLogoImg = document.getElementById("sidebar-company-logo");
    sidebarLogoImg.src = savedLogo;
    sidebarLogoImg.style.display = "inline-block"; // Make sure it's visible
}
// else ‡¶¨‡ßç‡¶≤‡¶ï‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá, ‡¶§‡¶æ‡¶á localStorage-‡¶è ‡¶≤‡ßã‡¶ó‡ßã ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶á ‡¶π‡¶¨‡ßá ‡¶®‡¶æ

const lastPage = localStorage.getItem(LAST_PAGE_KEY) || 'dashboard';
switchPage(lastPage, true);
      // --- ‡¶è‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® ---

      function submitPayment() {
        const receivedAmountInput = document.getElementById('payment-amount-input');
        const receivedAmount = parseFloat(receivedAmountInput.value);

        if (isNaN(receivedAmount) || receivedAmount <= 0) {
          alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡ßà‡¶ß ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!');
          return;
        }

        if (!currentPaymentBillId) {
          alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶¨‡¶ø‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!');
          return;
        }

        const paymentResult = logPayment(currentPaymentBillId, receivedAmount);

        if (paymentResult.success) {
          alert(paymentResult.message); // ‚òÖ‚òÖ‚òÖ ‡¶è‡¶ï‡¶ü‡¶ø‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶∏‡¶Æ‡¶®‡ßç‡¶¨‡¶ø‡¶§ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‚òÖ‚òÖ‚òÖ
        } else {
          alert(`‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá: ${paymentResult.message}`);
        }

        closePaymentModal();
        renderBillingPage();
        renderDashboard();
      }

      /**
       * ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶ì‡¶≠‡¶æ‡¶∞‡¶≤‡ßá ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßá‡•§
       */

      // --- ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ recalculateBillTotal ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá, ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® ---

      function recalculateBillTotal(billId) {
        const bill = db.bills.find(b => b.id === billId);
        if (!bill) return;

        const customer = db.customers.find(c => c.id === bill.customerId);
        if (!customer) return;

        const dueFromAdjustments = (bill.adjustments || []).filter(a => a.type === 'due').reduce((sum, a) => sum + a
          .amount, 0);
        const grossTotalBill = bill.monthlyAmount + bill.dueAmount + dueFromAdjustments;
        const discount = bill.discount || 0;
        const netTotalBill = grossTotalBill - discount;

        bill.paidAmount = (bill.paymentHistory || []).reduce((sum, p) => sum + p.amount, 0);

        let remainingDue = netTotalBill - bill.paidAmount;

        if (remainingDue > 0 && (customer.advanceBalance || 0) > 0) {
          const amountToUseFromAdvance = Math.min(remainingDue, customer.advanceBalance);

          customer.advanceBalance -= amountToUseFromAdvance;
          bill.paidAmount += amountToUseFromAdvance;
          bill.advanceUsed = (bill.advanceUsed || 0) + amountToUseFromAdvance;

          if (!bill.paymentHistory) {
            bill.paymentHistory = [];
          }
          bill.paymentHistory.push({
            id: Date.now() + Math.random(),
            amount: amountToUseFromAdvance,
            date: new Date().toISOString(),
            source: 'advance',
            balanceAfter: remainingDue - amountToUseFromAdvance
          });

          remainingDue -= amountToUseFromAdvance;
        }

        if (remainingDue < 0) {
          const newAdvance = Math.abs(remainingDue);
          customer.advanceBalance = (customer.advanceBalance || 0) + newAdvance;
          remainingDue = 0;
        }

        bill.totalAmount = grossTotalBill;
        bill.remainingDue = remainingDue;

        if (bill.remainingDue <= 0) {
          bill.status = 'paid';
          bill.isPaid = true;
        } else if (bill.paidAmount > 0) {
          bill.status = 'partially_paid';
          bill.isPaid = false;
        } else {
          bill.status = 'unpaid';
          bill.isPaid = false;
        }
      }

      // ‚òÖ‚òÖ‚òÖ ‡¶°‡¶ø‡¶∏‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‚òÖ‚òÖ‚òÖ
      // ‚òÖ‚òÖ‚òÖ apply-discount-btn ‡¶è‡¶∞ ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡ßü‡ßá ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® ‚òÖ‚òÖ‚òÖ

      const applyDiscountBtn = document.getElementById('apply-discount-btn');
      if (applyDiscountBtn) {
        applyDiscountBtn.addEventListener('click', () => {
          const discountAmountInput = document.getElementById('discount-amount-input');
          const discountAmount = parseFloat(discountAmountInput.value);

          if (isNaN(discountAmount) || discountAmount <= 0) { // ‡¶è‡¶ñ‡¶® ‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶õ‡¶æ‡ßú ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ
            alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡ßà‡¶ß ‡¶õ‡¶æ‡ßú‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!');
            return;
          }

          if (!currentPaymentBillId) {
            alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶¨‡¶ø‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!');
            return;
          }

          const bill = db.bills.find(b => b.id === currentPaymentBillId);
          if (!bill) {
            alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶¨‡¶ø‡¶≤ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø!');
            return;
          }

          const customer = db.customers.find(c => c.id === bill.customerId);
          if (!customer) return;

          const totalBill = bill.totalAmount || 0;
          const paidAmount = bill.paidAmount || 0;
          const maxDiscount = totalBill - paidAmount;

          if (discountAmount > maxDiscount) {
            alert(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ß≥${toBengaliNumber(maxDiscount.toFixed(2))} ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶õ‡¶æ‡ßú ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§`);
            return;
          }

          bill.discount = (bill.discount || 0) + discountAmount;
          recalculateBillTotal(bill.id);
          saveDb();

          alert(`‡ß≥${toBengaliNumber(discountAmount.toFixed(2))} ‡¶õ‡¶æ‡ßú ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);

          // ‚òÖ‚òÖ‚òÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶Ö‡¶Ç‡¶∂: ‡¶õ‡¶æ‡ßú‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶≤‡¶ó ‡¶§‡ßà‡¶∞‡¶ø ‚òÖ‚òÖ‚òÖ
          addActivity('discount_applied',
            `${customer.name}-‡¶ï‡ßá ‡ß≥${toBengaliNumber(discountAmount.toFixed(2))} ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶õ‡¶æ‡ßú ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, {
              customerName: customer.name,
              amount: discountAmount,
              month: bill.month,
              year: bill.year
            });
          // ‚òÖ‚òÖ‚òÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡¶Ç‡¶∂‡ßá‡¶∞ ‡¶∂‡ßá‡¶∑ ‚òÖ‚òÖ‚òÖ

          // ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
          openPaymentModal(bill.id);
          discountAmountInput.value = ''; // ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶¨‡¶ï‡ßç‡¶∏ ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶ï‡¶∞‡¶æ
        });
      }

      // --- ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ logPayment ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá, ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ö‡ßÇ‡ßú‡¶æ‡¶®‡ßç‡¶§ ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® ---

// ‡¶™‡ßÅ‡¶∞‡¶®‡ßã logPayment ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶¨‡¶∏‡¶æ‡¶®
    async function logPayment(billId, receivedAmount) {
    const billIndex = db.bills.findIndex(b => b.id === billId);
    if (billIndex === -1) return { success: false, message: '‡¶¨‡¶ø‡¶≤ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§' };

    const bill = { ...db.bills[billIndex] }; // Create a mutable copy
    const customerIndex = db.customers.findIndex(c => c.id === bill.customerId);
    if (customerIndex === -1) return { success: false, message: '‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§' };
    
    const customer = { ...db.customers[customerIndex] }; // Create a mutable copy

    if (!bill.paymentHistory) bill.paymentHistory = [];

    const dueBeforeThisPayment = bill.remainingDue > 0 ? bill.remainingDue : 0;

    if (dueBeforeThisPayment <= 0) {
        customer.advanceBalance = (customer.advanceBalance || 0) + receivedAmount;
        bill.paymentHistory.push({
            id: Date.now() + Math.random(),
            amount: receivedAmount,
            date: new Date().toISOString(),
            source: 'advance_deposit',
            balanceAfter: -customer.advanceBalance,
            isFirstAdvance: (customer.advanceBalance === receivedAmount)
        });
        
        try {
            const batch = writeBatch(firestore);
            batch.set(doc(firestore, "customers", customer.id), customer);
            batch.set(doc(firestore, "bills", bill.id), bill);
            await batch.commit();

            db.customers[customerIndex] = customer;
            db.bills[billIndex] = bill;

            addActivity('advance_deposit', `${customer.name}-‡¶è‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, { customerName: customer.name, amount: receivedAmount });
            return { success: true, message: `‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡ß≥${toBengaliNumber(receivedAmount)} ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏ ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§` };
        } catch (error) {
            return { success: false, message: 'Firebase-‡¶è ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§' };
        }
    }

    const balanceAfterPayment = dueBeforeThisPayment - receivedAmount;
    let isFinalPayment = false;
    let newAdvanceFromThisPayment = 0;

    if (balanceAfterPayment <= 0) {
        isFinalPayment = true;
        if (balanceAfterPayment < 0) {
            newAdvanceFromThisPayment = Math.abs(balanceAfterPayment);
        }
    }

    bill.paymentHistory.push({
        id: Date.now() + Math.random(),
        amount: receivedAmount,
        date: new Date().toISOString(),
        source: 'manual',
        balanceAfter: balanceAfterPayment,
        isFinalPayment: isFinalPayment,
        newAdvance: newAdvanceFromThisPayment
    });
    
    bill.paidAmount = (bill.paidAmount || 0) + receivedAmount;
    
    // Recalculate bill status based on the new payment
    const updatedBill = recalculateBillObject(bill, customer);
    const updatedCustomer = { ...customer }; // Customer might be updated in recalculate
    if(updatedBill.remainingDue < 0) {
        updatedCustomer.advanceBalance = (updatedCustomer.advanceBalance || 0) + Math.abs(updatedBill.remainingDue);
        updatedBill.remainingDue = 0;
    }
    if (updatedBill.remainingDue <= 0) {
        updatedBill.status = 'paid';
        updatedBill.isPaid = true;
    } else {
        updatedBill.status = 'partially_paid';
        updatedBill.isPaid = false;
    }

    let finalMessage = "‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§";
    if (updatedBill.status === 'paid' && updatedCustomer.deactivationPending === true) {
        updatedCustomer.isActive = false;
        updatedCustomer.deactivationPending = false;
        finalMessage = `‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá ‡¶è‡¶¨‡¶Ç ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï "${updatedCustomer.name}"-‡¶ï‡ßá ‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`;
        addActivity('customer_deactivated_auto', `‡¶¨‡¶ø‡¶≤ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡ßá‡¶∞ ‡¶™‡¶∞ ${updatedCustomer.name} ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`, { customerName: updatedCustomer.name });
    }

    try {
        const batch = writeBatch(firestore);
        batch.set(doc(firestore, "bills", updatedBill.id), updatedBill);
        batch.set(doc(firestore, "customers", updatedCustomer.id), updatedCustomer);
        await batch.commit();

        db.bills[billIndex] = updatedBill;
        db.customers[customerIndex] = updatedCustomer;

        // Add activity logs
        if (updatedBill.status === 'paid') {
            addActivity('bill_status_paid', `${updatedCustomer.name}-‡¶è‡¶∞ ‡¶¨‡¶ø‡¶≤ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, { customerName: updatedCustomer.name, amount: receivedAmount, month: updatedBill.month, year: updatedBill.year });
        } else {
            addActivity('payment_history', `${updatedCustomer.name}-‡¶è‡¶∞ ‡¶¨‡¶ø‡¶≤ ‡¶Ü‡¶Ç‡¶∂‡¶ø‡¶ï ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, { customerName: updatedCustomer.name, amount: receivedAmount, remainingDue: updatedBill.remainingDue, month: updatedBill.month, year: updatedBill.year });
        }

        return { success: true, message: finalMessage };

    } catch (error) {
        console.error("Firebase-‡¶è ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ", error);
        return { success: false, message: '‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§' };
    }
}

// ‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡¶§‡ßÅ‡¶® Helper ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
function recalculateBillObject(bill, customer) {
    const billCopy = { ...bill };
    const dueFromAdjustments = (billCopy.adjustments || []).filter(a => a.type === 'due').reduce((sum, a) => sum + a.amount, 0);
    const grossTotalBill = billCopy.monthlyAmount + billCopy.dueAmount + dueFromAdjustments;
    const discount = billCopy.discount || 0;
    const netTotalBill = grossTotalBill - discount;
    billCopy.paidAmount = (billCopy.paymentHistory || []).reduce((sum, p) => sum + p.amount, 0);
    billCopy.remainingDue = netTotalBill - billCopy.paidAmount;
    return billCopy;
}


      // ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡¶ó‡ßÅ‡¶≤‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
      const submitPaymentBtn = document.getElementById('submit-payment-btn');
      const closeModalBtn = document.querySelector('.payment-modal-close');
      const cancelModalBtn = document.querySelector('.payment-btn-cancel');

      if (submitPaymentBtn) {
        submitPaymentBtn.addEventListener('click', submitPayment);
      }
      if (closeModalBtn) {
        closeModalBtn.addEventListener('click', closePaymentModal);
      }
      if (cancelModalBtn) {
        cancelModalBtn.addEventListener('click', closePaymentModal);
      }
      const clearActivityLogBtn = document.getElementById('clear-activity-log-btn');

      if (clearActivityLogBtn) {
        clearActivityLogBtn.addEventListener('click', () => {
          if (confirm(
              '‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶ï‡¶≤ ‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ‡ßá‡¶∞ ‡¶≤‡¶ó ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶á ‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶´‡ßá‡¶∞‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§')) {

            const ACTIVITY_STORAGE_KEY = 'abidNetworkActivities_v1';
            localStorage.removeItem(ACTIVITY_STORAGE_KEY);

            const activitiesContainer = document.getElementById('recent-activities');
            const noActivitiesDiv = document.getElementById('no-activities');
            const loadMoreBtnContainer = document.getElementById('activity-loader');

            if (activitiesContainer) {
              activitiesContainer.innerHTML = '';
              activitiesContainer.style.display = 'none';
            }
            if (noActivitiesDiv) {
              noActivitiesDiv.style.display = 'block';
            }
            if (loadMoreBtnContainer) {
              loadMoreBtnContainer.style.display = 'none';
            }
            renderRecentActivities();

            alert('‡¶∏‡¶ï‡¶≤ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ‡ßá‡¶∞ ‡¶≤‡¶ó ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§');
          }
        });
      }

      // Initialize version management
      initializeVersionManagement();

      function setupMacInput(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;

        container.innerHTML = '';
        container.style.position = 'relative';

        const realInput = document.createElement('input');
        realInput.type = 'text';
        realInput.maxLength = 17;
        realInput.placeholder = 'XX:XX:XX:XX:XX:XX';

        // ‚òÖ‚òÖ‚òÖ ‡¶Æ‡ßÇ‡¶≤ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®: ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶Ü‡¶á‡¶°‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶õ‡¶ø ‚òÖ‚òÖ‚òÖ
        realInput.id = containerId + '-real-input'; // ‡¶Ø‡ßá‡¶Æ‡¶®: 'customerMacContainer-real-input'

        realInput.style.width = '100%';
        realInput.style.border = '1px solid #ccc';
        realInput.style.padding = '8px';
        realInput.style.letterSpacing = '3px';
        realInput.style.fontFamily = 'monospace';
        realInput.style.fontSize = '16px';
        realInput.style.boxSizing = 'border-box';

        container.appendChild(realInput);

        const formatMacAddress = (e) => {
          let value = realInput.value;
          let cleanValue = value.replace(/[^a-fA-F0-9]/g, '').toUpperCase();
          let formattedValue = '';
          for (let i = 0; i < cleanValue.length; i++) {
            if (i > 0 && i % 2 === 0) {
              formattedValue += ':';
            }
            formattedValue += cleanValue[i];
          }
          realInput.value = formattedValue;
        };

        realInput.addEventListener('input', formatMacAddress);

        realInput.addEventListener('paste', (e) => {
          setTimeout(() => {
            formatMacAddress(e);
          }, 0);
        });
      }

      const macStyle = document.createElement('style');
      macStyle.textContent = `
    .mac-input-container { display: flex; align-items: center; gap: 5px; }
    .mac-input-box {
        width: 15%; height: 32px; text-align: center;
        font-family: 'Courier New', monospace; font-size: 14px;
        font-weight: 600; text-transform: uppercase;
        border: 1px solid #CBD5E0; border-radius: 5px; padding: 0;
    }
    .mac-input-box:focus {
        border-color: var(--secondary-color); outline: none;
        box-shadow: 0 0 5px rgba(90, 103, 216, 0.3);
    }
    .mac-separator { font-size: 16px; font-weight: bold; color: #A0AEC0; }
`;
      document.head.appendChild(macStyle);

    });

    function getMacAddress(containerId) {
      const realInput = document.getElementById(containerId + '-real-input');
      if (realInput && realInput.value.length === 17) {
        return realInput.value.toUpperCase();
      }
      return '';
    }

    function setMacAddress(containerId, mac) {
      const realInput = document.getElementById(containerId + '-real-input');
      if (realInput) {
        realInput.value = mac || '';
      }
    }

    // Version Management System
    function initializeVersionManagement() {
      updateSystemVersion();
      updateLastUpdateDate();
    }

    function updateSystemVersion() {
      const currentVersion = "v4.3.0";
      const versionElement = document.getElementById('system-version');
      if (versionElement) {
        versionElement.textContent = currentVersion;
      }
    }

    function updateLastUpdateDate() {
      const lastUpdateString = "‡ß¶‡ßØ ‡¶Ü‡¶ó‡¶∑‡ßç‡¶ü ‡ß®‡ß¶‡ß®‡ß´";
      const dateElement = document.getElementById('last-update-date');
      if (dateElement) {
        dateElement.textContent = lastUpdateString;
      }
    }

    function showChangeLog() {
      const changeLogModal = document.getElementById("changeLogModal");
      const overlay = document.getElementById("overlay");
      if (!changeLogModal) {
        createChangeLogModal();
      }
      document.getElementById("changeLogModal").classList.add("active");
      overlay.style.display = "block";
    }

    function createChangeLogModal() {
      const modalHTML = `
        <div class="modal" id="changeLogModal">
            <div class="modal-content" style="max-width: 700px; max-height: 80vh; overflow-y: auto;">
                <div class="modal-header">
                    <h2 style="color: var(--secondary-color); display: flex; align-items: center; gap: 10px;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                            <path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>
                        </svg>
                        Change Log
                    </h2>
                    <button class="modal-close" id="changeLogModalCloseBtn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="changelog-content">
                        <div class="version-block">
                            <h3 style="color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 5px;">v4.2.0 - ‡ß®‡ß™ ‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á ‡ß®‡ß¶‡ß®‡ß´</h3>
                            <div class="change-category">
                                <h4 style="color: #28a745;">‚ú® ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞</h4>
                                <ul>
                                    <li>‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶≠‡¶æ‡¶∞‡ßç‡¶∏‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</li>
                                    <li>‡¶∂‡ßá‡¶∑ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶®</li>
                                    <li>Change Log ‡¶¨‡¶æ‡¶ü‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡¶™‡¶Ü‡¶™ ‡¶â‡¶á‡¶®‡ßç‡¶°‡ßã ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</li>
                                    <li>‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</li>
                                </ul>
                            </div>
                            <div class="change-category">
                                <h4 style="color: #17a2b8;">üîß ‡¶â‡¶®‡ßç‡¶®‡¶§‡¶ø</h4>
                                <ul>
                                    <li>About ‡¶™‡ßá‡¶á‡¶ú‡ßá‡¶∞ UI/UX ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</li>
                                    <li>‡¶≠‡¶æ‡¶∞‡ßç‡¶∏‡¶® ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶®‡ßÄ ‡¶Ü‡¶∞‡¶ì ‡¶Ü‡¶ï‡¶∞‡ßç‡¶∑‡¶£‡ßÄ‡¶Ø‡¶º ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</li>
                                    <li>Change Log ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</li>
                                </ul>
                            </div>
                        </div>

                        <div class="version-block">
                            <h3 style="color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 5px;">v4.1.0 - ‡¶ú‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø ‡ß®‡ß¶‡ß®‡ß´</h3>
                            <div class="change-category">
                                <h4 style="color: #28a745;">‚ú® ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞</h4>
                                <ul>
                                    <li>About ‡¶™‡ßá‡¶á‡¶ú ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</li>
                                    <li>‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶®‡ßÄ</li>
                                    <li>‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶ï‡¶∂‡¶®</li>
                                    <li>‡¶°‡ßá‡¶≠‡¶≤‡¶™‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ü‡¶ø‡¶Æ‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø</li>
                                </ul>
                            </div>
                            <div class="change-category">
                                <h4 style="color: #17a2b8;">üîß ‡¶â‡¶®‡ßç‡¶®‡¶§‡¶ø</h4>
                                <ul>
                                    <li>‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶Æ‡ßá‡¶®‡ßÅ‡¶§‡ßá About ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶Ø‡ßã‡¶ó</li>
                                    <li>‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏‡¶ø‡¶≠ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶ï‡¶∞‡¶æ</li>
                                </ul>
                            </div>
                        </div>

                        <div class="version-block">
                            <h3 style="color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 5px;">v4.0.0 - ‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞ ‡ß®‡ß¶‡ß®‡ß™</h3>
                            <div class="change-category">
                                <h4 style="color: #28a745;">‚ú® ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞</h4>
                                <ul>
                                    <li>‡¶∞‡¶æ‡¶â‡¶ü‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</li>
                                    <li>‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶¨‡¶ø‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</li>
                                    <li>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</li>
                                    <li>‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶∂‡¶®</li>
                                </ul>
                            </div>
                            <div class="change-category">
                                <h4 style="color: #ffc107;">üêõ ‡¶¨‡¶æ‡¶ó ‡¶´‡¶ø‡¶ï‡ßç‡¶∏</h4>
                                <ul>
                                    <li>‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶®</li>
                                    <li>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏‡¶ø‡¶≠‡¶®‡ßá‡¶∏ ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶ï‡¶∞‡¶æ</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>`;

      document.body.insertAdjacentHTML("beforeend", modalHTML);

      // Add event listener for close button
      document.getElementById("changeLogModalCloseBtn").addEventListener("click", closeChangeLogModal);

      // Add CSS for changelog
      const style = document.createElement("style");
      style.textContent = `
            .changelog-content {
                font-family: 'Noto Sans Bengali', sans-serif;
            }
            .version-block {
                margin-bottom: 30px;
                padding: 20px;
                border: 1px solid #e0e0e0;
                border-radius: 8px;
                background: #fafafa;
            }
            .version-block h3 {
                margin-top: 0;
                margin-bottom: 15px;
            }
            .change-category {
                margin-bottom: 15px;
            }
            .change-category h4 {
                margin-bottom: 8px;
                font-size: 16px;
            }
            .change-category ul {
                margin: 0;
                padding-left: 20px;
            }
            .change-category li {
                margin-bottom: 5px;
                line-height: 1.5;
            }
        `;
      document.head.appendChild(style);
    }

    function closeChangeLogModal() {
      document.getElementById("changeLogModal").classList.remove("active");
      document.getElementById("overlay").style.display = "none";
    }

    // Backup reminder functions
    function showBackupReminder() {
      const notification = document.getElementById('backup-reminder-notification');
      if (notification) {
        notification.style.display = 'block';
      }

      // Also show on dashboard
      const dashboardNotification = document.getElementById('dashboard-backup-reminder-notification');
      if (dashboardNotification) {
        dashboardNotification.style.display = 'block';
      }
    }

    function hideBackupReminder() {
      const notification = document.getElementById('backup-reminder-notification');
      if (notification) {
        notification.style.display = 'none';
      }
    }

    function hideDashboardBackupReminder() {
      const dashboardNotification = document.getElementById('dashboard-backup-reminder-notification');
      if (dashboardNotification) {
        dashboardNotification.style.display = 'none';
      }

      // Also hide the settings page notification
      const settingsNotification = document.getElementById('backup-reminder-notification');
      if (settingsNotification) {
        settingsNotification.style.display = 'none';
      }
    }

    function updateLastExportDate() {
      const lastExportDate = localStorage.getItem('lastExportDate') || '‡¶ï‡¶ñ‡¶®‡ßã ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø';
      const dateElement = document.getElementById('last-export-date');
      if (dateElement) {
        dateElement.textContent = lastExportDate;
      }
    }

  </script>

  <!-- Payment Modal -->
  <div id="paymentModal" class="payment-modal">
    <div class="payment-modal-content">
      <div class="payment-modal-header">
        <h2>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ú‡¶Æ‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
        <button class="payment-modal-close">&times;</button>
      </div>
      <div class="payment-modal-body">
        <div class="payment-info">
          <h4>‡¶¨‡¶ø‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø</h4>
          <p><strong>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï:</strong> <span id="payment-customer-name"></span></p>
          <p><strong>‡¶Æ‡¶æ‡¶∏:</strong> <span id="payment-bill-month"></span></p>
          <p><strong>‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:</strong> <span id="payment-bill-amount"></span></p>
          <p><strong>‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ:</strong> <span id="payment-due-amount"></span></p>
          <p><strong>‡¶è‡¶°‡¶≠‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏:</strong> <span id="payment-advance-amount"></span></p>
        </div>
        <div class="payment-amount-input">
          <label for="payment-amount-input">‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§ ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡ß≥)</label>
          <input type="number" id="payment-amount-input" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" min="0" step="0.01">
        </div>

        <!-- Payment History Section -->
        <div class="payment-history-section">
          <div class="payment-history-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
              <path
                d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z" />
            </svg>
            ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏
          </div>
          <div class="payment-history-list" id="payment-history-list">
            <div class="payment-history-empty">‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</div>
          </div>
        </div>
      </div>
      <!-- ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶π‡¶ú ‡¶°‡¶ø‡¶∏‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
      <!-- ‡¶ö‡ßÇ‡ßú‡¶æ‡¶®‡ßç‡¶§ ‡¶®‡ßç‡¶Ø‡¶æ‡¶∞‡ßã, ‡¶¨‡¶ï‡ßç‡¶∏-‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞-‡¶Ö‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶á‡¶®‡¶° ‡¶°‡¶ø‡¶∏‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
      <div class="discount-section"
        style="margin-bottom: 20px; padding: 8px 12px; border: 1px solid #E2E8F0; border-radius: 8px; background-color: #F7FAFC;">
        <div style="display: flex; gap: 10px; align-items: center; justify-content: center;">
          <!-- ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶è‡¶á ‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® -->

          <!-- ‡¶¨‡¶æ‡¶Æ ‡¶™‡¶æ‡¶∂‡ßá‡¶∞ ‡¶≤‡ßá‡¶¨‡ßá‡¶≤ (‡¶Ü‡¶á‡¶ï‡¶® ‡¶∏‡¶π) -->
          <label for="discount-amount-input"
            style="font-size: 13px; font-weight: 500; color: #4A5568; margin: 0; white-space: nowrap; display: flex; align-items: center; gap: 6px;">
            <span style="font-size: 16px; line-height: 1;">üè∑Ô∏è</span>
            <span>‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶õ‡¶æ‡ßú (‡ß≥):</span>
          </label>

          <!-- ‡¶°‡¶æ‡¶® ‡¶™‡¶æ‡¶∂‡ßá‡¶∞ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶æ‡¶ü‡¶® -->
          <div style="display: flex; align-items: center; gap: 8px;">
            <!-- ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶´‡¶ø‡¶≤‡ßç‡¶° -->
            <input type="number" id="discount-amount-input" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£"
              style="width: 80px; padding: 6px 8px; border: 1px solid #CBD5E0; border-radius: 6px; font-size: 13px; text-align: center; box-sizing: border-box; outline: none;">

            <!-- ‡¶¨‡¶æ‡¶ü‡¶® -->
            <button id="apply-discount-btn" class="btn"
              style="background-color: #DD6B20; padding: 6px 12px; font-size: 12px; white-space: nowrap; border-radius: 6px;">
              ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ó
            </button>
          </div>

        </div>
      </div>

      <div class="payment-buttons">
        <button class="payment-btn payment-btn-cancel">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
        <button class="payment-btn payment-btn-submit" id="submit-payment-btn">‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
      </div>
    </div>
  </div>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, getDocs, doc, setDoc, deleteDoc, writeBatch } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBYJUlfOUth0JfOGLF2ospRvMbis2sb_Mc",
    authDomain: "abidnetworkapp.firebaseapp.com",
    projectId: "abidnetworkapp",
    storageBucket: "abidnetworkapp.appspot.com",
    messagingSenderId: "822608480878",
    appId: "1:822608480878:web:5dcafa4d07839e5173f47f"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  // Initialize Cloud Firestore and get a reference to the service
  const firestore = getFirestore(app);
</script>
</body>

</html>
